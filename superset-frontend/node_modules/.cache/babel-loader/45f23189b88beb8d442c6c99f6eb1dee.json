{"ast":null,"code":"import \"core-js/modules/es.regexp.to-string\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { Alert } from 'react-bootstrap';\n\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from '../logger/LogUtils';\nimport Loading from '../components/Loading';\nimport RefreshChartOverlay from '../components/RefreshChartOverlay';\nimport ErrorMessageWithStackTrace from '../components/ErrorMessage/ErrorMessageWithStackTrace';\nimport ErrorBoundary from '../components/ErrorBoundary';\nimport ChartRenderer from './ChartRenderer';\nimport './chart.less';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object.isRequired,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queryResponse: PropTypes.object,\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func };\n\n\nconst BLANK = {};\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null };\n\n\nclass Chart extends React.PureComponent {\n  constructor(props) {var _context;\n    super(props);\n    this.handleRenderContainerFailure = _bindInstanceProperty(_context = this.handleRenderContainerFailure).call(_context,\n    this);\n\n  }\n\n  componentDidMount() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    if (this.props.chartId > 0 && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)) {\n      // Load saved chart with a GET request\n      this.props.actions.getSavedChart(\n      this.props.formData,\n      false,\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId);\n\n    } else {\n      // Create chart with POST request\n      this.props.actions.postChartFormData(\n      this.props.formData,\n      false,\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId);\n\n    }\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    console.warn(error); // eslint-disable-line\n    actions.chartRenderingFailed(\n    error.toString(),\n    chartId,\n    info ? info.componentStack : null);\n\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime });\n\n  }\n\n  renderErrorMessage() {var _queryResponse$errors;\n    const { chartAlert, chartStackTrace, queryResponse } = this.props;\n    return (\n      ___EmotionJSX(ErrorMessageWithStackTrace, {\n        error: queryResponse === null || queryResponse === void 0 ? void 0 : (_queryResponse$errors = queryResponse.errors) === null || _queryResponse$errors === void 0 ? void 0 : _queryResponse$errors[0],\n        message: chartAlert,\n        link: queryResponse ? queryResponse.link : null,\n        stackTrace: chartStackTrace, __source: { fileName: _jsxFileName, lineNumber: 144 }, __self: this }));\n\n\n  }\n\n  render() {\n    const {\n      width,\n      height,\n      chartAlert,\n      chartStatus,\n      errorMessage,\n      onQuery,\n      refreshOverlayVisible } =\n    this.props;\n\n    const isLoading = chartStatus === 'loading';\n\n    // this allows <Loading /> to be positioned in the middle of the chart\n    const containerStyles = isLoading ? { height, width } : null;\n    const isFaded = refreshOverlayVisible && !errorMessage;\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return this.renderErrorMessage();\n    }\n    if (errorMessage) {\n      return ___EmotionJSX(Alert, { bsStyle: \"warning\", __source: { fileName: _jsxFileName, lineNumber: 174 }, __self: this }, errorMessage);\n    }\n    return (\n      ___EmotionJSX(ErrorBoundary, {\n        onError: this.handleRenderContainerFailure,\n        showMessage: false, __source: { fileName: _jsxFileName, lineNumber: 177 }, __self: this },\n\n      ___EmotionJSX(\"div\", {\n        className: \"chart-container \" + (isLoading ? 'is-loading' : ''),\n        style: containerStyles, __source: { fileName: _jsxFileName, lineNumber: 181 }, __self: this },\n\n      isLoading && ___EmotionJSX(Loading, { size: 50, __source: { fileName: _jsxFileName, lineNumber: 185 }, __self: this }),\n\n      !isLoading && !chartAlert && isFaded &&\n      ___EmotionJSX(RefreshChartOverlay, {\n        width: width,\n        height: height,\n        onQuery: onQuery, __source: { fileName: _jsxFileName, lineNumber: 188 }, __self: this }),\n\n\n      ___EmotionJSX(\"div\", { className: \"slice_container \" + (isFaded ? ' faded' : ''), __source: { fileName: _jsxFileName, lineNumber: 194 }, __self: this },\n      ___EmotionJSX(ChartRenderer, _extends({}, this.props, { __source: { fileName: _jsxFileName, lineNumber: 195 }, __self: this }))))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;const _default =\n\nChart;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(BLANK, \"BLANK\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(Chart, \"Chart\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx"],"names":["PropTypes","React","Alert","isFeatureEnabled","FeatureFlag","Logger","LOG_ACTIONS_RENDER_CHART","Loading","RefreshChartOverlay","ErrorMessageWithStackTrace","ErrorBoundary","ChartRenderer","propTypes","annotationData","object","actions","chartId","number","isRequired","datasource","dashboardId","initialValues","formData","height","width","setControlValue","func","timeout","vizType","string","triggerRender","bool","chartAlert","chartStatus","chartStackTrace","queryResponse","triggerQuery","refreshOverlayVisible","errorMessage","node","addFilter","onQuery","onFilterMenuOpen","onFilterMenuClose","BLANK","defaultProps","Chart","PureComponent","constructor","props","handleRenderContainerFailure","componentDidMount","runQuery","componentDidUpdate","CLIENT_CACHE","getSavedChart","postChartFormData","error","info","console","warn","chartRenderingFailed","toString","componentStack","logEvent","slice_id","has_err","error_details","start_offset","renderStartTime","ts","Date","getTime","duration","getTimestamp","renderErrorMessage","errors","link","render","isLoading","containerStyles","isFaded","renderContainerStartTime"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { Alert } from 'react-bootstrap';\n\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from '../logger/LogUtils';\nimport Loading from '../components/Loading';\nimport RefreshChartOverlay from '../components/RefreshChartOverlay';\nimport ErrorMessageWithStackTrace from '../components/ErrorMessage/ErrorMessageWithStackTrace';\nimport ErrorBoundary from '../components/ErrorBoundary';\nimport ChartRenderer from './ChartRenderer';\nimport './chart.less';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object.isRequired,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queryResponse: PropTypes.object,\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n};\n\nconst BLANK = {};\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null,\n};\n\nclass Chart extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleRenderContainerFailure = this.handleRenderContainerFailure.bind(\n      this,\n    );\n  }\n\n  componentDidMount() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    if (this.props.chartId > 0 && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)) {\n      // Load saved chart with a GET request\n      this.props.actions.getSavedChart(\n        this.props.formData,\n        false,\n        this.props.timeout,\n        this.props.chartId,\n        this.props.dashboardId,\n      );\n    } else {\n      // Create chart with POST request\n      this.props.actions.postChartFormData(\n        this.props.formData,\n        false,\n        this.props.timeout,\n        this.props.chartId,\n        this.props.dashboardId,\n      );\n    }\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    console.warn(error); // eslint-disable-line\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime,\n    });\n  }\n\n  renderErrorMessage() {\n    const { chartAlert, chartStackTrace, queryResponse } = this.props;\n    return (\n      <ErrorMessageWithStackTrace\n        error={queryResponse?.errors?.[0]}\n        message={chartAlert}\n        link={queryResponse ? queryResponse.link : null}\n        stackTrace={chartStackTrace}\n      />\n    );\n  }\n\n  render() {\n    const {\n      width,\n      height,\n      chartAlert,\n      chartStatus,\n      errorMessage,\n      onQuery,\n      refreshOverlayVisible,\n    } = this.props;\n\n    const isLoading = chartStatus === 'loading';\n\n    // this allows <Loading /> to be positioned in the middle of the chart\n    const containerStyles = isLoading ? { height, width } : null;\n    const isFaded = refreshOverlayVisible && !errorMessage;\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return this.renderErrorMessage();\n    }\n    if (errorMessage) {\n      return <Alert bsStyle=\"warning\">{errorMessage}</Alert>;\n    }\n    return (\n      <ErrorBoundary\n        onError={this.handleRenderContainerFailure}\n        showMessage={false}\n      >\n        <div\n          className={`chart-container ${isLoading ? 'is-loading' : ''}`}\n          style={containerStyles}\n        >\n          {isLoading && <Loading size={50} />}\n\n          {!isLoading && !chartAlert && isFaded && (\n            <RefreshChartOverlay\n              width={width}\n              height={height}\n              onQuery={onQuery}\n            />\n          )}\n          <div className={`slice_container ${isFaded ? ' faded' : ''}`}>\n            <ChartRenderer {...this.props} />\n          </div>\n        </div>\n      </ErrorBoundary>\n    );\n  }\n}\n\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;\n\nexport default Chart;\n"]},"metadata":{},"sourceType":"module"}