{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _setTimeout from \"@babel/runtime-corejs3/core-js-stable/set-timeout\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Tabs as BootstrapTabs, Tab as BootstrapTab } from 'react-bootstrap';\n\nimport DragDroppable from '../dnd/DragDroppable';\nimport DragHandle from '../dnd/DragHandle';\nimport DashboardComponent from '../../containers/DashboardComponent';\nimport DeleteComponentButton from '../DeleteComponentButton';\nimport HoverMenu from '../menu/HoverMenu';\nimport findTabIndexByComponentId from '../../util/findTabIndexByComponentId';\nimport getDirectPathToTabIndex from '../../util/getDirectPathToTabIndex';\nimport getLeafComponentIdFromPath from '../../util/getLeafComponentIdFromPath';\nimport { componentShape } from '../../util/propShapes';\nimport { NEW_TAB_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\nimport { RENDER_TAB, RENDER_TAB_CONTENT } from './Tab';\nimport { TAB_TYPE } from '../../util/componentTypes';\nimport { LOG_ACTIONS_SELECT_DASHBOARD_TAB } from '../../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst NEW_TAB_INDEX = -1;\nconst MAX_TAB_COUNT = 10;\n\nconst propTypes = {\n  id: PropTypes.string.isRequired,\n  parentId: PropTypes.string.isRequired,\n  component: componentShape.isRequired,\n  parentComponent: componentShape.isRequired,\n  index: PropTypes.number.isRequired,\n  depth: PropTypes.number.isRequired,\n  renderTabContent: PropTypes.bool, // whether to render tabs + content or just tabs\n  editMode: PropTypes.bool.isRequired,\n  renderHoverMenu: PropTypes.bool,\n  logEvent: PropTypes.func.isRequired,\n  directPathToChild: PropTypes.arrayOf(PropTypes.string),\n\n  // grid related\n  availableColumnCount: PropTypes.number,\n  columnWidth: PropTypes.number,\n  onResizeStart: PropTypes.func,\n  onResize: PropTypes.func,\n  onResizeStop: PropTypes.func,\n\n  // dnd\n  createComponent: PropTypes.func.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  onChangeTab: PropTypes.func.isRequired,\n  deleteComponent: PropTypes.func.isRequired,\n  updateComponents: PropTypes.func.isRequired };\n\n\nconst defaultProps = {\n  children: null,\n  renderTabContent: true,\n  renderHoverMenu: true,\n  availableColumnCount: 0,\n  columnWidth: 0,\n  directPathToChild: [],\n  onResizeStart() {},\n  onResize() {},\n  onResizeStop() {} };\n\n\nclass Tabs extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    const tabIndex = Math.max(\n    0,\n    findTabIndexByComponentId({\n      currentComponent: props.component,\n      directPathToChild: props.directPathToChild }));\n\n\n\n    this.state = {\n      tabIndex };\n\n    this.handleClickTab = _bindInstanceProperty(_context = this.handleClickTab).call(_context, this);\n    this.handleDeleteComponent = _bindInstanceProperty(_context2 = this.handleDeleteComponent).call(_context2, this);\n    this.handleDeleteTab = _bindInstanceProperty(_context3 = this.handleDeleteTab).call(_context3, this);\n    this.handleDropOnTab = _bindInstanceProperty(_context4 = this.handleDropOnTab).call(_context4, this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const maxIndex = Math.max(0, nextProps.component.children.length - 1);\n    if (this.state.tabIndex > maxIndex) {\n      this.setState(() => ({ tabIndex: maxIndex }));\n    }\n\n    if (nextProps.isComponentVisible) {\n      const nextFocusComponent = getLeafComponentIdFromPath(\n      nextProps.directPathToChild);\n\n      const currentFocusComponent = getLeafComponentIdFromPath(\n      this.props.directPathToChild);\n\n\n      if (nextFocusComponent !== currentFocusComponent) {\n        const nextTabIndex = findTabIndexByComponentId({\n          currentComponent: nextProps.component,\n          directPathToChild: nextProps.directPathToChild });\n\n\n        // make sure nextFocusComponent is under this tabs component\n        if (nextTabIndex > -1 && nextTabIndex !== this.state.tabIndex) {\n          this.setState(() => ({ tabIndex: nextTabIndex }));\n        }\n      }\n    }\n  }\n\n  handleClickTab(tabIndex, ev) {\n    if (ev) {\n      const target = ev.target;\n      // special handler for clicking on anchor link icon (or whitespace nearby):\n      // will show short link popover but do not change tab\n      if (target && target.classList.contains('short-link-trigger')) {\n        return;\n      }\n    }\n\n    const { component, createComponent } = this.props;\n\n    if (tabIndex === NEW_TAB_INDEX) {\n      createComponent({\n        destination: {\n          id: component.id,\n          type: component.type,\n          index: component.children.length },\n\n        dragging: {\n          id: NEW_TAB_ID,\n          type: TAB_TYPE } });\n\n\n    } else if (tabIndex !== this.state.tabIndex) {\n      const pathToTabIndex = getDirectPathToTabIndex(component, tabIndex);\n      const targetTabId = pathToTabIndex[pathToTabIndex.length - 1];\n      this.props.logEvent(LOG_ACTIONS_SELECT_DASHBOARD_TAB, {\n        target_id: targetTabId,\n        index: tabIndex });\n\n\n      this.props.onChangeTab({ pathToTabIndex });\n    }\n  }\n\n  handleDeleteComponent() {\n    const { deleteComponent, id, parentId } = this.props;\n    deleteComponent(id, parentId);\n  }\n\n  handleDeleteTab(tabIndex) {\n    this.handleClickTab(Math.max(0, tabIndex - 1));\n  }\n\n  handleDropOnTab(dropResult) {\n    const { component } = this.props;\n\n    // Ensure dropped tab is visible\n    const { destination } = dropResult;\n    if (destination) {var _context5;\n      const dropTabIndex =\n      destination.id === component.id ?\n      destination.index // dropped ON tabs\n      : _indexOfInstanceProperty(_context5 = component.children).call(_context5, destination.id); // dropped IN tab\n\n      if (dropTabIndex > -1) {\n        _setTimeout(() => {\n          this.handleClickTab(dropTabIndex);\n        }, 30);\n      }\n    }\n  }\n\n  render() {\n    const {\n      depth,\n      component: tabsComponent,\n      parentComponent,\n      index,\n      availableColumnCount,\n      columnWidth,\n      onResizeStart,\n      onResize,\n      onResizeStop,\n      handleComponentDrop,\n      renderTabContent,\n      renderHoverMenu,\n      isComponentVisible: isCurrentTabVisible,\n      editMode } =\n    this.props;\n\n    const { tabIndex: selectedTabIndex } = this.state;\n    const { children: tabIds } = tabsComponent;\n\n    return (\n      ___EmotionJSX(DragDroppable, {\n        component: tabsComponent,\n        parentComponent: parentComponent,\n        orientation: \"row\",\n        index: index,\n        depth: depth,\n        onDrop: handleComponentDrop,\n        editMode: editMode, __source: { fileName: _jsxFileName, lineNumber: 214 }, __self: this },\n\n      ({\n        dropIndicatorProps: tabsDropIndicatorProps,\n        dragSourceRef: tabsDragSourceRef }) =>\n\n      ___EmotionJSX(\"div\", { className: \"dashboard-component dashboard-component-tabs\", __source: { fileName: _jsxFileName, lineNumber: 227 }, __self: this },\n      editMode && renderHoverMenu &&\n      ___EmotionJSX(HoverMenu, { innerRef: tabsDragSourceRef, position: \"left\", __source: { fileName: _jsxFileName, lineNumber: 229 }, __self: this },\n      ___EmotionJSX(DragHandle, { position: \"left\", __source: { fileName: _jsxFileName, lineNumber: 230 }, __self: this }),\n      ___EmotionJSX(DeleteComponentButton, { onDelete: this.handleDeleteComponent, __source: { fileName: _jsxFileName, lineNumber: 231 }, __self: this })),\n\n\n\n      ___EmotionJSX(BootstrapTabs, {\n        id: tabsComponent.id,\n        activeKey: selectedTabIndex,\n        onSelect: this.handleClickTab,\n        animation: true,\n        mountOnEnter: true,\n        unmountOnExit: false, __source: { fileName: _jsxFileName, lineNumber: 235 }, __self: this },\n\n      _mapInstanceProperty(tabIds).call(tabIds, (tabId, tabIndex) =>\n      // react-bootstrap doesn't render a Tab if we move this to its own Tab.jsx so we\n      // use `renderType` to indicate what the DashboardComponent should render. This\n      // prevents us from passing the entire dashboard component lookup to render Tabs.jsx\n      ___EmotionJSX(BootstrapTab, {\n        key: tabId,\n        eventKey: tabIndex,\n        title:\n        ___EmotionJSX(DashboardComponent, {\n          id: tabId,\n          parentId: tabsComponent.id,\n          depth: depth,\n          index: tabIndex,\n          renderType: RENDER_TAB,\n          availableColumnCount: availableColumnCount,\n          columnWidth: columnWidth,\n          onDropOnTab: this.handleDropOnTab,\n          onDeleteTab: this.handleDeleteTab, __source: { fileName: _jsxFileName, lineNumber: 251 }, __self: this }), __source: { fileName: _jsxFileName, lineNumber: 247 }, __self: this },\n\n\n\n      renderTabContent &&\n      ___EmotionJSX(DashboardComponent, {\n        id: tabId,\n        parentId: tabsComponent.id,\n        depth: depth // see isValidChild.js for why tabs don't increment child depth\n        , index: tabIndex,\n        renderType: RENDER_TAB_CONTENT,\n        availableColumnCount: availableColumnCount,\n        columnWidth: columnWidth,\n        onResizeStart: onResizeStart,\n        onResize: onResize,\n        onResizeStop: onResizeStop,\n        onDropOnTab: this.handleDropOnTab,\n        isComponentVisible:\n        selectedTabIndex === tabIndex && isCurrentTabVisible, __source: { fileName: _jsxFileName, lineNumber: 265 }, __self: this }))),\n\n\n\n\n\n\n      editMode && tabIds.length < MAX_TAB_COUNT &&\n      ___EmotionJSX(BootstrapTab, {\n        eventKey: NEW_TAB_INDEX,\n        title: ___EmotionJSX(\"div\", { className: \"fa fa-plus\", __source: { fileName: _jsxFileName, lineNumber: 288 }, __self: this }), __source: { fileName: _jsxFileName, lineNumber: 286 }, __self: this })),\n\n\n\n\n\n      tabsDropIndicatorProps &&\n      parentComponent.id !== DASHBOARD_ROOT_ID &&\n      ___EmotionJSX(\"div\", _extends({}, tabsDropIndicatorProps, { __source: { fileName: _jsxFileName, lineNumber: 296 }, __self: this })))));\n\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nTabs.propTypes = propTypes;\nTabs.defaultProps = defaultProps;const _default =\n\nTabs;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(NEW_TAB_INDEX, \"NEW_TAB_INDEX\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(MAX_TAB_COUNT, \"MAX_TAB_COUNT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(Tabs, \"Tabs\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx"],"names":["React","PropTypes","Tabs","BootstrapTabs","Tab","BootstrapTab","DragDroppable","DragHandle","DashboardComponent","DeleteComponentButton","HoverMenu","findTabIndexByComponentId","getDirectPathToTabIndex","getLeafComponentIdFromPath","componentShape","NEW_TAB_ID","DASHBOARD_ROOT_ID","RENDER_TAB","RENDER_TAB_CONTENT","TAB_TYPE","LOG_ACTIONS_SELECT_DASHBOARD_TAB","NEW_TAB_INDEX","MAX_TAB_COUNT","propTypes","id","string","isRequired","parentId","component","parentComponent","index","number","depth","renderTabContent","bool","editMode","renderHoverMenu","logEvent","func","directPathToChild","arrayOf","availableColumnCount","columnWidth","onResizeStart","onResize","onResizeStop","createComponent","handleComponentDrop","onChangeTab","deleteComponent","updateComponents","defaultProps","children","PureComponent","constructor","props","tabIndex","Math","max","currentComponent","state","handleClickTab","handleDeleteComponent","handleDeleteTab","handleDropOnTab","UNSAFE_componentWillReceiveProps","nextProps","maxIndex","length","setState","isComponentVisible","nextFocusComponent","currentFocusComponent","nextTabIndex","ev","target","classList","contains","destination","type","dragging","pathToTabIndex","targetTabId","target_id","dropResult","dropTabIndex","render","tabsComponent","isCurrentTabVisible","selectedTabIndex","tabIds","dropIndicatorProps","tabsDropIndicatorProps","dragSourceRef","tabsDragSourceRef","tabId"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Tabs as BootstrapTabs, Tab as BootstrapTab } from 'react-bootstrap';\n\nimport DragDroppable from '../dnd/DragDroppable';\nimport DragHandle from '../dnd/DragHandle';\nimport DashboardComponent from '../../containers/DashboardComponent';\nimport DeleteComponentButton from '../DeleteComponentButton';\nimport HoverMenu from '../menu/HoverMenu';\nimport findTabIndexByComponentId from '../../util/findTabIndexByComponentId';\nimport getDirectPathToTabIndex from '../../util/getDirectPathToTabIndex';\nimport getLeafComponentIdFromPath from '../../util/getLeafComponentIdFromPath';\nimport { componentShape } from '../../util/propShapes';\nimport { NEW_TAB_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\nimport { RENDER_TAB, RENDER_TAB_CONTENT } from './Tab';\nimport { TAB_TYPE } from '../../util/componentTypes';\nimport { LOG_ACTIONS_SELECT_DASHBOARD_TAB } from '../../../logger/LogUtils';\n\nconst NEW_TAB_INDEX = -1;\nconst MAX_TAB_COUNT = 10;\n\nconst propTypes = {\n  id: PropTypes.string.isRequired,\n  parentId: PropTypes.string.isRequired,\n  component: componentShape.isRequired,\n  parentComponent: componentShape.isRequired,\n  index: PropTypes.number.isRequired,\n  depth: PropTypes.number.isRequired,\n  renderTabContent: PropTypes.bool, // whether to render tabs + content or just tabs\n  editMode: PropTypes.bool.isRequired,\n  renderHoverMenu: PropTypes.bool,\n  logEvent: PropTypes.func.isRequired,\n  directPathToChild: PropTypes.arrayOf(PropTypes.string),\n\n  // grid related\n  availableColumnCount: PropTypes.number,\n  columnWidth: PropTypes.number,\n  onResizeStart: PropTypes.func,\n  onResize: PropTypes.func,\n  onResizeStop: PropTypes.func,\n\n  // dnd\n  createComponent: PropTypes.func.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  onChangeTab: PropTypes.func.isRequired,\n  deleteComponent: PropTypes.func.isRequired,\n  updateComponents: PropTypes.func.isRequired,\n};\n\nconst defaultProps = {\n  children: null,\n  renderTabContent: true,\n  renderHoverMenu: true,\n  availableColumnCount: 0,\n  columnWidth: 0,\n  directPathToChild: [],\n  onResizeStart() {},\n  onResize() {},\n  onResizeStop() {},\n};\n\nclass Tabs extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const tabIndex = Math.max(\n      0,\n      findTabIndexByComponentId({\n        currentComponent: props.component,\n        directPathToChild: props.directPathToChild,\n      }),\n    );\n\n    this.state = {\n      tabIndex,\n    };\n    this.handleClickTab = this.handleClickTab.bind(this);\n    this.handleDeleteComponent = this.handleDeleteComponent.bind(this);\n    this.handleDeleteTab = this.handleDeleteTab.bind(this);\n    this.handleDropOnTab = this.handleDropOnTab.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const maxIndex = Math.max(0, nextProps.component.children.length - 1);\n    if (this.state.tabIndex > maxIndex) {\n      this.setState(() => ({ tabIndex: maxIndex }));\n    }\n\n    if (nextProps.isComponentVisible) {\n      const nextFocusComponent = getLeafComponentIdFromPath(\n        nextProps.directPathToChild,\n      );\n      const currentFocusComponent = getLeafComponentIdFromPath(\n        this.props.directPathToChild,\n      );\n\n      if (nextFocusComponent !== currentFocusComponent) {\n        const nextTabIndex = findTabIndexByComponentId({\n          currentComponent: nextProps.component,\n          directPathToChild: nextProps.directPathToChild,\n        });\n\n        // make sure nextFocusComponent is under this tabs component\n        if (nextTabIndex > -1 && nextTabIndex !== this.state.tabIndex) {\n          this.setState(() => ({ tabIndex: nextTabIndex }));\n        }\n      }\n    }\n  }\n\n  handleClickTab(tabIndex, ev) {\n    if (ev) {\n      const target = ev.target;\n      // special handler for clicking on anchor link icon (or whitespace nearby):\n      // will show short link popover but do not change tab\n      if (target && target.classList.contains('short-link-trigger')) {\n        return;\n      }\n    }\n\n    const { component, createComponent } = this.props;\n\n    if (tabIndex === NEW_TAB_INDEX) {\n      createComponent({\n        destination: {\n          id: component.id,\n          type: component.type,\n          index: component.children.length,\n        },\n        dragging: {\n          id: NEW_TAB_ID,\n          type: TAB_TYPE,\n        },\n      });\n    } else if (tabIndex !== this.state.tabIndex) {\n      const pathToTabIndex = getDirectPathToTabIndex(component, tabIndex);\n      const targetTabId = pathToTabIndex[pathToTabIndex.length - 1];\n      this.props.logEvent(LOG_ACTIONS_SELECT_DASHBOARD_TAB, {\n        target_id: targetTabId,\n        index: tabIndex,\n      });\n\n      this.props.onChangeTab({ pathToTabIndex });\n    }\n  }\n\n  handleDeleteComponent() {\n    const { deleteComponent, id, parentId } = this.props;\n    deleteComponent(id, parentId);\n  }\n\n  handleDeleteTab(tabIndex) {\n    this.handleClickTab(Math.max(0, tabIndex - 1));\n  }\n\n  handleDropOnTab(dropResult) {\n    const { component } = this.props;\n\n    // Ensure dropped tab is visible\n    const { destination } = dropResult;\n    if (destination) {\n      const dropTabIndex =\n        destination.id === component.id\n          ? destination.index // dropped ON tabs\n          : component.children.indexOf(destination.id); // dropped IN tab\n\n      if (dropTabIndex > -1) {\n        setTimeout(() => {\n          this.handleClickTab(dropTabIndex);\n        }, 30);\n      }\n    }\n  }\n\n  render() {\n    const {\n      depth,\n      component: tabsComponent,\n      parentComponent,\n      index,\n      availableColumnCount,\n      columnWidth,\n      onResizeStart,\n      onResize,\n      onResizeStop,\n      handleComponentDrop,\n      renderTabContent,\n      renderHoverMenu,\n      isComponentVisible: isCurrentTabVisible,\n      editMode,\n    } = this.props;\n\n    const { tabIndex: selectedTabIndex } = this.state;\n    const { children: tabIds } = tabsComponent;\n\n    return (\n      <DragDroppable\n        component={tabsComponent}\n        parentComponent={parentComponent}\n        orientation=\"row\"\n        index={index}\n        depth={depth}\n        onDrop={handleComponentDrop}\n        editMode={editMode}\n      >\n        {({\n          dropIndicatorProps: tabsDropIndicatorProps,\n          dragSourceRef: tabsDragSourceRef,\n        }) => (\n          <div className=\"dashboard-component dashboard-component-tabs\">\n            {editMode && renderHoverMenu && (\n              <HoverMenu innerRef={tabsDragSourceRef} position=\"left\">\n                <DragHandle position=\"left\" />\n                <DeleteComponentButton onDelete={this.handleDeleteComponent} />\n              </HoverMenu>\n            )}\n\n            <BootstrapTabs\n              id={tabsComponent.id}\n              activeKey={selectedTabIndex}\n              onSelect={this.handleClickTab}\n              animation\n              mountOnEnter\n              unmountOnExit={false}\n            >\n              {tabIds.map((tabId, tabIndex) => (\n                // react-bootstrap doesn't render a Tab if we move this to its own Tab.jsx so we\n                // use `renderType` to indicate what the DashboardComponent should render. This\n                // prevents us from passing the entire dashboard component lookup to render Tabs.jsx\n                <BootstrapTab\n                  key={tabId}\n                  eventKey={tabIndex}\n                  title={\n                    <DashboardComponent\n                      id={tabId}\n                      parentId={tabsComponent.id}\n                      depth={depth}\n                      index={tabIndex}\n                      renderType={RENDER_TAB}\n                      availableColumnCount={availableColumnCount}\n                      columnWidth={columnWidth}\n                      onDropOnTab={this.handleDropOnTab}\n                      onDeleteTab={this.handleDeleteTab}\n                    />\n                  }\n                >\n                  {renderTabContent && (\n                    <DashboardComponent\n                      id={tabId}\n                      parentId={tabsComponent.id}\n                      depth={depth} // see isValidChild.js for why tabs don't increment child depth\n                      index={tabIndex}\n                      renderType={RENDER_TAB_CONTENT}\n                      availableColumnCount={availableColumnCount}\n                      columnWidth={columnWidth}\n                      onResizeStart={onResizeStart}\n                      onResize={onResize}\n                      onResizeStop={onResizeStop}\n                      onDropOnTab={this.handleDropOnTab}\n                      isComponentVisible={\n                        selectedTabIndex === tabIndex && isCurrentTabVisible\n                      }\n                    />\n                  )}\n                </BootstrapTab>\n              ))}\n\n              {editMode && tabIds.length < MAX_TAB_COUNT && (\n                <BootstrapTab\n                  eventKey={NEW_TAB_INDEX}\n                  title={<div className=\"fa fa-plus\" />}\n                />\n              )}\n            </BootstrapTabs>\n\n            {/* don't indicate that a drop on root is allowed when tabs already exist */}\n            {tabsDropIndicatorProps &&\n              parentComponent.id !== DASHBOARD_ROOT_ID && (\n                <div {...tabsDropIndicatorProps} />\n              )}\n          </div>\n        )}\n      </DragDroppable>\n    );\n  }\n}\n\nTabs.propTypes = propTypes;\nTabs.defaultProps = defaultProps;\n\nexport default Tabs;\n"]},"metadata":{},"sourceType":"module"}