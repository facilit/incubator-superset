{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _reverseInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reverse\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _sortInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/sort\";import _reduceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reduce\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _parseInt from \"@babel/runtime-corejs3/core-js-stable/parse-int\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Mustache from 'mustache';\nimport { scaleLinear } from 'd3-scale';\nimport { Table, Thead, Th, Tr, Td } from 'reactable-arc';\nimport { formatNumber } from '@superset-ui/number-format';\nimport { formatTime } from '@superset-ui/time-format';\nimport moment from 'moment';\nimport {\nInfoTooltipWithTrigger,\nMetricOption } from\n'@superset-ui/chart-controls';\n\nimport FormattedNumber from './FormattedNumber';\nimport SparklineCell from './SparklineCell';\nimport './TimeTable.less';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst ACCESSIBLE_COLOR_BOUNDS = ['#ca0020', '#0571b0'];\n\nfunction colorFromBounds(value, bounds, colorBounds = ACCESSIBLE_COLOR_BOUNDS) {\n  if (bounds) {\n    const [min, max] = bounds;\n    const [minColor, maxColor] = colorBounds;\n    if (min !== null && max !== null) {\n      const colorScale = scaleLinear().\n      domain([min, (max + min) / 2, max]).\n      range([minColor, 'grey', maxColor]);\n      return colorScale(value);\n    } else if (min !== null) {\n      return value >= min ? maxColor : minColor;\n    } else if (max !== null) {\n      return value < max ? maxColor : minColor;\n    }\n  }\n  return null;\n}\n\nconst propTypes = {\n  className: PropTypes.string,\n  height: PropTypes.number,\n  // Example\n  // {'2018-04-14 00:00:00': { 'SUM(metric_value)': 80031779.40047 }}\n  data: PropTypes.objectOf(PropTypes.objectOf(PropTypes.number)).isRequired,\n  columnConfigs: PropTypes.arrayOf(\n  PropTypes.shape({\n    colType: PropTypes.string,\n    comparisonType: PropTypes.string,\n    d3format: PropTypes.string,\n    key: PropTypes.string,\n    label: PropTypes.string,\n    timeLag: PropTypes.number })).\n\n  isRequired,\n  rows: PropTypes.arrayOf(\n  PropTypes.oneOfType([\n  PropTypes.shape({\n    label: PropTypes.string }),\n\n  PropTypes.shape({\n    metric_name: PropTypes.string })])).\n\n\n  isRequired,\n  rowType: PropTypes.oneOf(['column', 'metric']).isRequired,\n  url: PropTypes.string };\n\nconst defaultProps = {\n  className: '',\n  height: undefined,\n  url: '' };\n\n\nclass TimeTable extends React.PureComponent {\n  renderLeftCell(row) {\n    const { rowType, url } = this.props;\n    const context = { metric: row };\n    const fullUrl = url ? Mustache.render(url, context) : null;\n\n    if (rowType === 'column') {\n      const column = row;\n      if (fullUrl) {\n        return (\n          ___EmotionJSX(\"a\", { href: fullUrl, rel: \"noopener noreferrer\", target: \"_blank\" },\n          column.label));\n\n\n      }\n      return column.label;\n    }\n\n    const metric = row;\n    return (\n      ___EmotionJSX(MetricOption, {\n        metric: metric,\n        url: fullUrl,\n        showFormula: false,\n        openInNewWindow: true }));\n\n\n  }\n\n  renderSparklineCell(valueField, column, entries) {\n    let sparkData;\n    if (column.timeRatio) {\n      // Period ratio sparkline\n      sparkData = [];\n      for (let i = column.timeRatio; i < entries.length; i++) {\n        const prevData = entries[i - column.timeRatio][valueField];\n        if (prevData && prevData !== 0) {\n          sparkData.push(entries[i][valueField] / prevData);\n        } else {\n          sparkData.push(null);\n        }\n      }\n    } else {\n      sparkData = _mapInstanceProperty(entries).call(entries, d => d[valueField]);\n    }\n\n    return (\n      ___EmotionJSX(Td, {\n        column: column.key,\n        key: column.key,\n        value: sparkData[sparkData.length - 1] },\n\n      ___EmotionJSX(SparklineCell, {\n        width: _parseInt(column.width, 10) || 300,\n        height: _parseInt(column.height, 10) || 50,\n        data: sparkData,\n        ariaLabel: \"spark-\" + valueField,\n        numberFormat: column.d3format,\n        yAxisBounds: column.yAxisBounds,\n        showYAxis: column.showYAxis,\n        renderTooltip: ({ index }) =>\n        ___EmotionJSX(\"div\", null,\n        ___EmotionJSX(\"strong\", null, formatNumber(column.d3format, sparkData[index])),\n        ___EmotionJSX(\"div\", null,\n        formatTime(\n        column.dateFormat,\n        moment.utc(entries[index].time).toDate()))) })));\n\n\n\n\n\n\n\n  }\n\n  renderValueCell(valueField, column, reversedEntries) {\n    const recent = reversedEntries[0][valueField];\n    let v;\n    let errorMsg;\n    if (column.colType === 'time') {\n      // Time lag ratio\n      const timeLag = column.timeLag || 0;\n      const totalLag = _Object$keys(reversedEntries).length;\n      if (timeLag >= totalLag) {\n        errorMsg = \"The time lag set at \" + timeLag + \" is too large for the length of data at \" + reversedEntries.length + \". No data available.\";\n      } else {\n        v = reversedEntries[timeLag][valueField];\n      }\n      if (column.comparisonType === 'diff') {\n        v = recent - v;\n      } else if (column.comparisonType === 'perc') {\n        v = recent / v;\n      } else if (column.comparisonType === 'perc_change') {\n        v = recent / v - 1;\n      }\n      v = v || 0;\n    } else if (column.colType === 'contrib') {var _context, _context2;\n      // contribution to column total\n      v =\n      recent /\n      _reduceInstanceProperty(_context = _mapInstanceProperty(_context2 = _Object$keys(reversedEntries[0])).call(_context2,\n      k => k !== 'time' ? reversedEntries[0][k] : null)).call(_context,\n      (a, b) => a + b);\n    } else if (column.colType === 'avg') {var _context3;\n      // Average over the last {timeLag}\n      v =\n      _reduceInstanceProperty(_context3 = _mapInstanceProperty(reversedEntries).call(reversedEntries,\n      (k, i) => i < column.timeLag ? k[valueField] : 0)).call(_context3,\n      (a, b) => a + b) / column.timeLag;\n    }\n\n    const color = colorFromBounds(v, column.bounds);\n\n    return (\n      ___EmotionJSX(Td, {\n        column: column.key,\n        key: column.key,\n        value: v,\n        style:\n        color && {\n          boxShadow: \"inset 0px -2.5px 0px 0px \" + color,\n          borderRight: '2px solid #fff' } },\n\n\n\n      errorMsg ?\n      ___EmotionJSX(\"div\", null, errorMsg) :\n\n      ___EmotionJSX(\"div\", { style: { color } },\n      ___EmotionJSX(FormattedNumber, { num: v, format: column.d3format }))));\n\n\n\n\n  }\n\n  renderRow(row, entries, reversedEntries) {\n    const { columnConfigs } = this.props;\n    const valueField = row.label || row.metric_name;\n    const leftCell = this.renderLeftCell(row);\n\n    return (\n      ___EmotionJSX(Tr, { key: leftCell },\n      ___EmotionJSX(Td, { column: \"metric\", data: leftCell },\n      leftCell),\n\n      _mapInstanceProperty(columnConfigs).call(columnConfigs, (c) =>\n      c.colType === 'spark' ?\n      this.renderSparklineCell(valueField, c, entries) :\n      this.renderValueCell(valueField, c, reversedEntries))));\n\n\n\n  }\n\n  render() {var _context4, _context5, _context6;\n    const {\n      className,\n      height,\n      data,\n      columnConfigs,\n      rowType,\n      rows } =\n    this.props;\n\n    const entries = _mapInstanceProperty(_context4 = _sortInstanceProperty(_context5 = _Object$keys(data)).call(_context5)).call(_context4,\n\n    time => _Object$assign({}, data[time], { time }));\n    const reversedEntries = _reverseInstanceProperty(_context6 = _concatInstanceProperty(entries).call(entries)).call(_context6);\n\n    const defaultSort =\n    rowType === 'column' && columnConfigs.length ?\n    {\n      column: columnConfigs[0].key,\n      direction: 'desc' } :\n\n    false;\n\n    return (\n      ___EmotionJSX(\"div\", { className: \"time-table \" + className, style: { height } },\n      ___EmotionJSX(Table, {\n        className: \"table table-no-hover\",\n        defaultSort: defaultSort,\n        sortBy: defaultSort,\n        sortable: _mapInstanceProperty(columnConfigs).call(columnConfigs, c => c.key) },\n\n      ___EmotionJSX(Thead, null,\n      ___EmotionJSX(Th, { column: \"metric\" }, \"Metric\"),\n      _mapInstanceProperty(columnConfigs).call(columnConfigs, (c, i) =>\n      ___EmotionJSX(Th, {\n        key: c.key,\n        column: c.key,\n        width: c.colType === 'spark' ? '1%' : null },\n\n      c.label, ' ',\n      c.tooltip &&\n      ___EmotionJSX(InfoTooltipWithTrigger, {\n        tooltip: c.tooltip,\n        label: \"tt-col-\" + i,\n        placement: \"top\" })))),\n\n\n\n\n\n      _mapInstanceProperty(rows).call(rows, row => this.renderRow(row, entries, reversedEntries)))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nTimeTable.propTypes = propTypes;\nTimeTable.defaultProps = defaultProps;const _default =\n\nTimeTable;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ACCESSIBLE_COLOR_BOUNDS, \"ACCESSIBLE_COLOR_BOUNDS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/visualizations/TimeTable/TimeTable.jsx\");reactHotLoader.register(colorFromBounds, \"colorFromBounds\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/visualizations/TimeTable/TimeTable.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/visualizations/TimeTable/TimeTable.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/visualizations/TimeTable/TimeTable.jsx\");reactHotLoader.register(TimeTable, \"TimeTable\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/visualizations/TimeTable/TimeTable.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/visualizations/TimeTable/TimeTable.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}