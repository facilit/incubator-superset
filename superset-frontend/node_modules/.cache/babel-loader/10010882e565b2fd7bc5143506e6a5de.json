{"ast":null,"code":"import \"core-js/modules/es.symbol.description\";import \"core-js/modules/es.promise\";import \"core-js/modules/es.string.replace\";import \"core-js/modules/web.dom-collections.iterator\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Button, Modal, Row, Col, FormControl, FormGroup } from 'react-bootstrap';\n// @ts-ignore\nimport Dialog from 'react-bootstrap-dialog';\nimport { AsyncSelect } from 'src/components/Select';\nimport rison from 'rison';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient } from '@superset-ui/connection';\nimport getClientErrorObject from '../../utils/getClientErrorObject';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nexport default function PropertiesModalWrapper({ show, onHide, animation, slice, onSave }) {\n  // The wrapper is a separate component so that hooks only run when the modal opens\n  return ___EmotionJSX(Modal, { show: show, onHide: onHide, animation: animation, bsSize: \"large\" },\n  ___EmotionJSX(PropertiesModal, { slice: slice, onHide: onHide, onSave: onSave }));\n\n}\nfunction PropertiesModal({ slice, onHide, onSave }) {\n  const [submitting, setSubmitting] = useState(false);\n  const errorDialog = useRef(null);\n  // values of form inputs\n  const [name, setName] = useState(slice.slice_name || '');\n  const [description, setDescription] = useState(slice.description || '');\n  const [cacheTimeout, setCacheTimeout] = useState(slice.cache_timeout != null ? slice.cache_timeout : '');\n  const [owners, setOwners] = useState(null);\n  function showError({ error, statusText }) {\n    errorDialog.current.show({\n      title: 'Error',\n      bsSize: 'medium',\n      bsStyle: 'danger',\n      actions: [Dialog.DefaultAction('Ok', () => {}, 'btn-danger')],\n      body: error || statusText || t('An error has occurred') });\n\n  }\n  async function fetchChartData() {\n    try {var _context;\n      const response = await SupersetClient.get({\n        endpoint: \"/api/v1/chart/\" + slice.slice_id });\n\n      const chart = response.json.result;\n      setOwners(_mapInstanceProperty(_context = chart.owners).call(_context, owner => ({\n        value: owner.id,\n        label: owner.first_name + \" \" + owner.last_name })));\n\n    }\n    catch (response) {\n      const clientError = await getClientErrorObject(response);\n      showError(clientError);\n    }\n  }\n  // get the owners of this slice\n  useEffect(() => {\n    fetchChartData();\n  }, []);\n  const loadOptions = (input = '') => {\n    const query = rison.encode({\n      filter: input });\n\n    return SupersetClient.get({\n      endpoint: \"/api/v1/chart/related/owners?q=\" + query }).\n    then(response => {\n      const { result } = response.json;\n      return _mapInstanceProperty(result).call(result, item => ({\n        value: item.value,\n        label: item.text }));\n\n    }, badResponse => {\n      getClientErrorObject(badResponse).then(showError);\n      return [];\n    });\n  };\n  const onSubmit = async event => {\n    event.stopPropagation();\n    event.preventDefault();\n    setSubmitting(true);\n    const payload = {\n      slice_name: name || null,\n      description: description || null,\n      cache_timeout: cacheTimeout || null };\n\n    if (owners) {\n      payload.owners = _mapInstanceProperty(owners).call(owners, o => o.value);\n    }\n    try {\n      const res = await SupersetClient.put({\n        endpoint: \"/api/v1/chart/\" + slice.slice_id,\n        headers: { 'Content-Type': 'application/json' },\n        body: _JSON$stringify(payload) });\n\n      // update the redux state\n      const updatedChart = _Object$assign({},\n      res.json.result, {\n        id: slice.slice_id });\n\n      onSave(updatedChart);\n      onHide();\n    }\n    catch (res) {\n      const clientError = await getClientErrorObject(res);\n      showError(clientError);\n    }\n    setSubmitting(false);\n  };\n  return ___EmotionJSX(\"form\", { onSubmit: onSubmit },\n  ___EmotionJSX(Modal.Header, { closeButton: true },\n  ___EmotionJSX(Modal.Title, null, \"Edit Chart Properties\")),\n\n  ___EmotionJSX(Modal.Body, null,\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { md: 6 },\n  ___EmotionJSX(\"h3\", null, t('Basic Information')),\n  ___EmotionJSX(FormGroup, null,\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"name\" },\n  t('Name')),\n\n  ___EmotionJSX(FormControl, { name: \"name\", type: \"text\", bsSize: \"sm\", value: name\n    // @ts-ignore\n    , onChange: event => setName(event.target.value) })),\n\n  ___EmotionJSX(FormGroup, null,\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"description\" },\n  t('Description')),\n\n  ___EmotionJSX(FormControl, { name: \"description\", type: \"text\", componentClass: \"textarea\", bsSize: \"sm\", value: description\n    // @ts-ignore\n    , onChange: event => setDescription(event.target.value), style: { maxWidth: '100%' } }),\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('The description can be displayed as widget headers in the dashboard view. Supports markdown.')))),\n\n\n\n  ___EmotionJSX(Col, { md: 6 },\n  ___EmotionJSX(\"h3\", null, t('Configuration')),\n  ___EmotionJSX(FormGroup, null,\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"cacheTimeout\" },\n  t('Cache Timeout')),\n\n  ___EmotionJSX(FormControl, { name: \"cacheTimeout\", type: \"text\", bsSize: \"sm\", value: cacheTimeout\n    // @ts-ignore\n    , onChange: event => setCacheTimeout(event.target.value.replace(/[^0-9]/, '')) }),\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('Duration (in seconds) of the caching timeout for this chart. Note this defaults to the datasource/table timeout if undefined.'))),\n\n\n  ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Access')),\n  ___EmotionJSX(FormGroup, null,\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"owners\" },\n  t('Owners')),\n\n  ___EmotionJSX(AsyncSelect, { isMulti: true, name: \"owners\", value: owners || [], loadOptions: loadOptions, defaultOptions: true // load options on render\n    , cacheOptions: true, onChange: setOwners, disabled: !owners, filterOption: null // options are filtered at the api\n  }),\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('A list of users who can alter the chart. Searchable by name or username.')))))),\n\n\n\n\n\n  ___EmotionJSX(Modal.Footer, null,\n  ___EmotionJSX(Button, { type: \"submit\", bsSize: \"sm\", bsStyle: \"primary\", className: \"m-r-5\", disabled: !owners || submitting },\n  t('Save')),\n\n  ___EmotionJSX(Button, { type: \"button\", bsSize: \"sm\", onClick: onHide },\n  t('Cancel')),\n\n  ___EmotionJSX(Dialog, { ref: errorDialog })));\n\n\n}__signature__(PropertiesModal, \"useState{[submitting, setSubmitting](false)}\\nuseRef{errorDialog}\\nuseState{[name, setName](slice.slice_name || '')}\\nuseState{[description, setDescription](slice.description || '')}\\nuseState{[cacheTimeout, setCacheTimeout](slice.cache_timeout != null ? slice.cache_timeout : '')}\\nuseState{[owners, setOwners](null)}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(PropertiesModalWrapper, \"PropertiesModalWrapper\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/PropertiesModal.tsx\");reactHotLoader.register(PropertiesModal, \"PropertiesModal\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/PropertiesModal.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}