{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _isEmpty from \"lodash/isEmpty\";import _isEqual from \"lodash/isEqual\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Table, Tr, Td, Thead, Th } from 'reactable-arc';\n\nimport { getChartControlPanelRegistry } from '@superset-ui/chart';\nimport getControlsForVizType from 'src/utils/getControlsForVizType';\nimport { t } from '@superset-ui/translation';\nimport TooltipWrapper from './TooltipWrapper';\nimport ModalTrigger from './ModalTrigger';\nimport { safeStringify } from '../utils/safeStringify';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  origFormData: PropTypes.object.isRequired,\n  currentFormData: PropTypes.object.isRequired };\n\n\nfunction alterForComparison(value) {\n  // Considering `[]`, `{}`, `null` and `undefined` as identical\n  // for this purpose\n  if (value === undefined || value === null || value === '') {\n    return null;\n  } else if (typeof value === 'object') {\n    if (_Array$isArray(value) && value.length === 0) {\n      return null;\n    }\n    const keys = _Object$keys(value);\n    if (keys && keys.length === 0) {\n      return null;\n    }\n  }\n  return value;\n}\n\nexport default class AlteredSliceTag extends React.Component {\n  constructor(props) {\n    super(props);\n    const diffs = this.getDiffs(props);\n\n    const controlsMap = getControlsForVizType(this.props.origFormData.viz_type);\n\n    this.state = { diffs, hasDiffs: !_isEmpty(diffs), controlsMap };\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    // Update differences if need be\n    if (_isEqual(this.props, newProps)) {\n      return;\n    }\n    const diffs = this.getDiffs(newProps);\n    this.setState({ diffs, hasDiffs: !_isEmpty(diffs) });\n  }\n\n  getDiffs(props) {\n    // Returns all properties that differ in the\n    // current form data and the saved form data\n    const ofd = props.origFormData;\n    const cfd = props.currentFormData;\n\n    const fdKeys = _Object$keys(cfd);\n    const diffs = {};\n    for (const fdKey of fdKeys) {var _context;\n      // Ignore values that are undefined/nonexisting in either\n      if (!ofd[fdKey] && !cfd[fdKey]) {\n        continue;\n      }\n      // Ignore obsolete legacy filters\n      if (_includesInstanceProperty(_context = ['filters', 'having', 'having_filters', 'where']).call(_context, fdKey)) {\n        continue;\n      }\n      if (!this.isEqualish(ofd[fdKey], cfd[fdKey])) {\n        diffs[fdKey] = { before: ofd[fdKey], after: cfd[fdKey] };\n      }\n    }\n    return diffs;\n  }\n\n  isEqualish(val1, val2) {\n    return _isEqual(alterForComparison(val1), alterForComparison(val2));\n  }\n\n  formatValue(value, key) {\n    // Format display value based on the control type\n    // or the value type\n    if (value === undefined) {\n      return 'N/A';\n    } else if (value === null) {\n      return 'null';\n    } else if (\n    this.state.controlsMap[key] &&\n    this.state.controlsMap[key].type === 'AdhocFilterControl')\n    {\n      if (!value.length) {\n        return '[]';\n      }\n      return _mapInstanceProperty(value).call(value,\n      v => {\n        const filterVal =\n        v.comparator && v.comparator.constructor === Array ? \"[\" +\n        v.comparator.join(', ') + \"]\" :\n        v.comparator;\n        return v.subject + \" \" + v.operator + \" \" + filterVal;\n      }).\n      join(', ');\n    } else if (\n    this.state.controlsMap[key] &&\n    this.state.controlsMap[key].type === 'BoundsControl')\n    {\n      return \"Min: \" + value[0] + \", Max: \" + value[1];\n    } else if (\n    this.state.controlsMap[key] &&\n    this.state.controlsMap[key].type === 'CollectionControl')\n    {\n      return _mapInstanceProperty(value).call(value, v => safeStringify(v)).join(', ');\n    } else if (typeof value === 'boolean') {\n      return value ? 'true' : 'false';\n    } else if (value.constructor === Array) {\n      return value.length ? value.join(', ') : '[]';\n    } else if (typeof value === 'string' || typeof value === 'number') {\n      return value;\n    }\n    return safeStringify(value);\n  }\n\n  renderRows() {\n    const diffs = this.state.diffs;\n    const rows = [];\n    for (const key in diffs) {\n      rows.push(\n      ___EmotionJSX(Tr, { key: key },\n      ___EmotionJSX(Td, {\n        column: \"control\",\n        data:\n        this.state.controlsMap[key] &&\n        this.state.controlsMap[key].label ||\n        key }),\n\n\n      ___EmotionJSX(Td, { column: \"before\" }, this.formatValue(diffs[key].before, key)),\n      ___EmotionJSX(Td, { column: \"after\" }, this.formatValue(diffs[key].after, key))));\n\n\n    }\n    return rows;\n  }\n\n  renderModalBody() {\n    return (\n      ___EmotionJSX(Table, { className: \"table\", sortable: true },\n      ___EmotionJSX(Thead, null,\n      ___EmotionJSX(Th, { column: \"control\" }, \"Control\"),\n      ___EmotionJSX(Th, { column: \"before\" }, \"Before\"),\n      ___EmotionJSX(Th, { column: \"after\" }, \"After\")),\n\n      this.renderRows()));\n\n\n  }\n\n  renderTriggerNode() {\n    return (\n      ___EmotionJSX(TooltipWrapper, { label: \"difference\", tooltip: t('Click to see difference') },\n      ___EmotionJSX(\"span\", {\n        className: \"label label-warning m-l-5\",\n        style: { fontSize: '12px' } },\n\n      t('Altered'))));\n\n\n\n  }\n\n  render() {\n    // Return nothing if there are no differences\n    if (!this.state.hasDiffs) {\n      return null;\n    }\n    // Render the label-warning 'Altered' tag which the user may\n    // click to open a modal containing a table summarizing the\n    // differences in the slice\n    return (\n      ___EmotionJSX(ModalTrigger, {\n        animation: true,\n        triggerNode: this.renderTriggerNode(),\n        modalTitle: t('Chart changes'),\n        bsSize: \"large\",\n        modalBody: this.renderModalBody() }));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nAlteredSliceTag.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/components/AlteredSliceTag.jsx\");reactHotLoader.register(alterForComparison, \"alterForComparison\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/components/AlteredSliceTag.jsx\");reactHotLoader.register(AlteredSliceTag, \"AlteredSliceTag\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/components/AlteredSliceTag.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}