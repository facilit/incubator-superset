{"ast":null,"code":"import \"core-js/modules/es.string.split\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport PropTypes from 'prop-types';\nimport SyntaxHighlighter, {\nregisterLanguage } from\n'react-syntax-highlighter/light';\nimport htmlSyntax from 'react-syntax-highlighter/languages/hljs/htmlbars';\nimport markdownSyntax from 'react-syntax-highlighter/languages/hljs/markdown';\nimport sqlSyntax from 'react-syntax-highlighter/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/languages/hljs/json';\nimport github from 'react-syntax-highlighter/styles/hljs/github';\nimport {\nDropdownButton,\nMenuItem,\nRow,\nCol,\nFormControl } from\n'react-bootstrap';\nimport { Table } from 'reactable-arc';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient } from '@superset-ui/connection';\n\nimport getClientErrorObject from '../../utils/getClientErrorObject';\nimport CopyToClipboard from './../../components/CopyToClipboard';\nimport { getChartDataRequest } from '../../chart/chartAction';\n\nimport Loading from '../../components/Loading';\nimport ModalTrigger from './../../components/ModalTrigger';\nimport Button from '../../components/Button';\nimport RowCountLabel from './RowCountLabel';\nimport { prepareCopyToClipboardTabularData } from '../../utils/common';\nimport PropertiesModal from './PropertiesModal';\nimport { sliceUpdated } from '../actions/exploreActions';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nregisterLanguage('markdown', markdownSyntax);\nregisterLanguage('html', htmlSyntax);\nregisterLanguage('sql', sqlSyntax);\nregisterLanguage('json', jsonSyntax);\n\nconst propTypes = {\n  onOpenInEditor: PropTypes.func,\n  animation: PropTypes.bool,\n  queryResponse: PropTypes.object,\n  chartStatus: PropTypes.string,\n  latestQueryFormData: PropTypes.object.isRequired,\n  slice: PropTypes.object };\n\nconst defaultProps = {\n  animation: true };\n\n\nexport class DisplayQueryButton extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    const { datasource } = props.latestQueryFormData;\n    this.state = {\n      language: null,\n      query: null,\n      data: null,\n      isLoading: false,\n      error: null,\n      filterText: '',\n      sqlSupported: datasource && datasource.split('__')[1] === 'table',\n      isPropertiesModalOpen: false };\n\n    this.beforeOpen = _bindInstanceProperty(_context = this.beforeOpen).call(_context, this);\n    this.changeFilterText = _bindInstanceProperty(_context2 = this.changeFilterText).call(_context2, this);\n    this.openPropertiesModal = _bindInstanceProperty(_context3 = this.openPropertiesModal).call(_context3, this);\n    this.closePropertiesModal = _bindInstanceProperty(_context4 = this.closePropertiesModal).call(_context4, this);\n  }\n  beforeOpen(resultType) {\n    this.setState({ isLoading: true });\n\n    getChartDataRequest({\n      formData: this.props.latestQueryFormData,\n      resultFormat: 'json',\n      resultType }).\n\n    then(response => {\n      // Currently displaying of only first query is supported\n      const result = response.result[0];\n      this.setState({\n        language: result.language,\n        query: result.query,\n        data: result.data,\n        isLoading: false,\n        error: null });\n\n    }).\n    catch(response => {\n      getClientErrorObject(response).then(({ error, statusText }) => {\n        this.setState({\n          error: error || statusText || t('Sorry, An error occurred'),\n          isLoading: false });\n\n      });\n    });\n  }\n  changeFilterText(event) {\n    this.setState({ filterText: event.target.value });\n  }\n  redirectSQLLab() {\n    this.props.onOpenInEditor(this.props.latestQueryFormData);\n  }\n  openPropertiesModal() {\n    this.setState({ isPropertiesModalOpen: true });\n  }\n  closePropertiesModal() {\n    this.setState({ isPropertiesModalOpen: false });\n  }\n  renderQueryModalBody() {\n    if (this.state.isLoading) {\n      return ___EmotionJSX(Loading, null);\n    } else if (this.state.error) {\n      return ___EmotionJSX(\"pre\", null, this.state.error);\n    } else if (this.state.query) {\n      return (\n        ___EmotionJSX(\"div\", null,\n        ___EmotionJSX(CopyToClipboard, {\n          text: this.state.query,\n          shouldShowText: false,\n          copyNode:\n          ___EmotionJSX(Button, { style: { position: 'absolute', right: 20 } },\n          ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\" })) }),\n\n\n\n        ___EmotionJSX(SyntaxHighlighter, { language: this.state.language, style: github },\n        this.state.query)));\n\n\n\n    }\n    return null;\n  }\n  renderResultsModalBody() {\n    if (this.state.isLoading) {\n      return ___EmotionJSX(Loading, null);\n    } else if (this.state.error) {\n      return ___EmotionJSX(\"pre\", null, this.state.error);\n    } else if (this.state.data) {\n      if (this.state.data.length === 0) {\n        return 'No data';\n      }\n      return this.renderDataTable(this.state.data);\n    }\n    return null;\n  }\n  renderDataTable(data) {\n    return (\n      ___EmotionJSX(\"div\", { style: { overflow: 'auto' } },\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 9 },\n      ___EmotionJSX(RowCountLabel, {\n        rowcount: data.length,\n        suffix: t('rows retrieved') }),\n\n      ___EmotionJSX(CopyToClipboard, {\n        text: prepareCopyToClipboardTabularData(data),\n        wrapped: false,\n        copyNode:\n        ___EmotionJSX(Button, { style: { padding: '2px 10px', fontSize: '11px' } },\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\" })) })),\n\n\n\n\n      ___EmotionJSX(Col, { md: 3 },\n      ___EmotionJSX(FormControl, {\n        placeholder: t('Search'),\n        bsSize: \"sm\",\n        value: this.state.filterText,\n        onChange: this.changeFilterText,\n        style: { paddingBottom: '5px' } }))),\n\n\n\n      ___EmotionJSX(Table, {\n        className: \"table table-condensed\",\n        sortable: true,\n        data: data,\n        hideFilterInput: true,\n        filterBy: this.state.filterText,\n        filterable: data.length ? _Object$keys(data[0]) : null,\n        noDataText: t('No data') })));\n\n\n\n  }\n  renderSamplesModalBody() {\n    if (this.state.isLoading) {\n      return (\n        ___EmotionJSX(\"img\", {\n          className: \"loading\",\n          alt: \"Loading...\",\n          src: \"/static/assets/images/loading.gif\" }));\n\n\n    } else if (this.state.error) {\n      return ___EmotionJSX(\"pre\", null, this.state.error);\n    } else if (this.state.data) {\n      return this.renderDataTable(this.state.data);\n    }\n    return null;\n  }\n  render() {var _context5;\n    const { animation, slice } = this.props;\n    return (\n      ___EmotionJSX(DropdownButton, {\n        noCaret: true,\n        title:\n        ___EmotionJSX(\"span\", null,\n        ___EmotionJSX(\"i\", { className: \"fa fa-bars\" }), \"\\xA0\"),\n\n\n\n        bsSize: \"sm\",\n        pullRight: true,\n        id: \"query\" },\n\n      slice &&\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(MenuItem, { onClick: this.openPropertiesModal },\n      t('Edit properties')),\n\n      ___EmotionJSX(PropertiesModal, {\n        slice: slice,\n        show: this.state.isPropertiesModalOpen,\n        onHide: this.closePropertiesModal,\n        onSave: this.props.sliceUpdated,\n        animation: animation })),\n\n\n\n      ___EmotionJSX(ModalTrigger, {\n        isMenuItem: true,\n        animation: animation,\n        triggerNode: ___EmotionJSX(\"span\", null, t('View query')),\n        modalTitle: t('View query'),\n        bsSize: \"large\",\n        beforeOpen: () => this.beforeOpen('query'),\n        modalBody: this.renderQueryModalBody() }),\n\n      ___EmotionJSX(ModalTrigger, {\n        isMenuItem: true,\n        animation: animation,\n        triggerNode: ___EmotionJSX(\"span\", null, t('View results')),\n        modalTitle: t('View results'),\n        bsSize: \"large\",\n        beforeOpen: () => this.beforeOpen('results'),\n        modalBody: this.renderResultsModalBody() }),\n\n      ___EmotionJSX(ModalTrigger, {\n        isMenuItem: true,\n        animation: animation,\n        triggerNode: ___EmotionJSX(\"span\", null, t('View samples')),\n        modalTitle: t('View samples'),\n        bsSize: \"large\",\n        beforeOpen: () => this.beforeOpen('samples'),\n        modalBody: this.renderSamplesModalBody() }),\n\n      this.state.sqlSupported &&\n      ___EmotionJSX(MenuItem, { eventKey: \"3\", onClick: _bindInstanceProperty(_context5 = this.redirectSQLLab).call(_context5, this) },\n      t('Run in SQL Lab'))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nDisplayQueryButton.propTypes = propTypes;\nDisplayQueryButton.defaultProps = defaultProps;\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({ sliceUpdated }, dispatch);\n}const _default =\n\nconnect(null, mapDispatchToProps)(DisplayQueryButton);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(DisplayQueryButton, \"DisplayQueryButton\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}