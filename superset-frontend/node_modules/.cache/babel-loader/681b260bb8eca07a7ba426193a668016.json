{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _sortInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/sort\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _findIndexInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find-index\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */\n/* eslint-env browser */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { DropdownButton, MenuItem } from 'react-bootstrap';\nimport { CellMeasurer, CellMeasurerCache, List } from 'react-virtualized';\nimport SearchInput, { createFilter } from 'react-search-input';\nimport { t } from '@superset-ui/translation';\n\nimport AddSliceCard from './AddSliceCard';\nimport AddSliceDragPreview from './dnd/AddSliceDragPreview';\nimport DragDroppable from './dnd/DragDroppable';\nimport Loading from '../../components/Loading';\nimport { CHART_TYPE, NEW_COMPONENT_SOURCE_TYPE } from '../util/componentTypes';\nimport { NEW_CHART_ID, NEW_COMPONENTS_SOURCE_ID } from '../util/constants';\nimport { slicePropShape } from '../util/propShapes';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  fetchAllSlices: PropTypes.func.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  slices: PropTypes.objectOf(slicePropShape).isRequired,\n  lastUpdated: PropTypes.number.isRequired,\n  errorMessage: PropTypes.string,\n  userId: PropTypes.string.isRequired,\n  selectedSliceIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n  editMode: PropTypes.bool,\n  height: PropTypes.number };\n\n\nconst defaultProps = {\n  selectedSliceIds: [],\n  editMode: false,\n  errorMessage: '',\n  height: window.innerHeight };\n\n\nconst KEYS_TO_FILTERS = ['slice_name', 'viz_type', 'datasource_name'];\nconst KEYS_TO_SORT = [\n{ key: 'slice_name', label: 'Name' },\n{ key: 'viz_type', label: 'Vis type' },\n{ key: 'datasource_name', label: 'Datasource' },\n{ key: 'changed_on', label: 'Recent' }];\n\n\nconst MARGIN_BOTTOM = 16;\nconst SIDEPANE_HEADER_HEIGHT = 55;\nconst SLICE_ADDER_CONTROL_HEIGHT = 64;\nconst DEFAULT_CELL_HEIGHT = 136;\n\nconst cache = new CellMeasurerCache({\n  defaultHeight: DEFAULT_CELL_HEIGHT,\n  fixedWidth: true });\n\n\nclass SliceAdder extends React.Component {\n  static sortByComparator(attr) {\n    const desc = attr === 'changed_on' ? -1 : 1;\n\n    return (a, b) => {\n      if (a[attr] < b[attr]) {\n        return -1 * desc;\n      } else if (a[attr] > b[attr]) {\n        return 1 * desc;\n      }\n      return 0;\n    };\n  }\n\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      filteredSlices: [],\n      searchTerm: '',\n      sortBy: _findIndexInstanceProperty(KEYS_TO_SORT).call(KEYS_TO_SORT, item => item.key === 'changed_on'),\n      selectedSliceIdsSet: new _Set(props.selectedSliceIds) };\n\n\n    this.rowRenderer = _bindInstanceProperty(_context = this.rowRenderer).call(_context, this);\n    this.searchUpdated = _bindInstanceProperty(_context2 = this.searchUpdated).call(_context2, this);\n    this.handleKeyPress = _bindInstanceProperty(_context3 = this.handleKeyPress).call(_context3, this);\n    this.handleSelect = _bindInstanceProperty(_context4 = this.handleSelect).call(_context4, this);\n  }\n\n  componentDidMount() {\n    this.slicesRequest = this.props.fetchAllSlices(this.props.userId);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const nextState = {};\n    if (nextProps.lastUpdated !== this.props.lastUpdated) {var _context5, _context6;\n      nextState.filteredSlices = _sortInstanceProperty(_context5 = _filterInstanceProperty(_context6 = _Object$values(nextProps.slices)).call(_context6,\n      createFilter(this.state.searchTerm, KEYS_TO_FILTERS))).call(_context5,\n      SliceAdder.sortByComparator(KEYS_TO_SORT[this.state.sortBy].key));\n    }\n\n    if (nextProps.selectedSliceIds !== this.props.selectedSliceIds) {\n      nextState.selectedSliceIdsSet = new _Set(nextProps.selectedSliceIds);\n    }\n\n    if (_Object$keys(nextState).length) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.slicesRequest && this.slicesRequest.abort) {\n      this.slicesRequest.abort();\n    }\n  }\n\n  getFilteredSortedSlices(searchTerm, sortBy) {var _context7, _context8;\n    return _sortInstanceProperty(_context7 = _filterInstanceProperty(_context8 = _Object$values(this.props.slices)).call(_context8,\n    createFilter(searchTerm, KEYS_TO_FILTERS))).call(_context7,\n    SliceAdder.sortByComparator(KEYS_TO_SORT[sortBy].key));\n  }\n\n  handleKeyPress(ev) {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n\n      this.searchUpdated(ev.target.value);\n    }\n  }\n\n  searchUpdated(searchTerm) {\n    this.setState({\n      searchTerm,\n      filteredSlices: this.getFilteredSortedSlices(\n      searchTerm,\n      this.state.sortBy) });\n\n\n  }\n\n  handleSelect(sortBy) {\n    this.setState({\n      sortBy,\n      filteredSlices: this.getFilteredSortedSlices(\n      this.state.searchTerm,\n      sortBy) });\n\n\n  }\n\n  rowRenderer({ key, index, style, parent }) {\n    const { filteredSlices, selectedSliceIdsSet } = this.state;\n    const cellData = filteredSlices[index];\n    const isSelected = selectedSliceIdsSet.has(cellData.slice_id);\n    const type = CHART_TYPE;\n    const id = NEW_CHART_ID;\n\n    const meta = {\n      chartId: cellData.slice_id,\n      sliceName: cellData.slice_name };\n\n    return (\n      ___EmotionJSX(DragDroppable, {\n        key: key,\n        component: { type, id, meta },\n        parentComponent: {\n          id: NEW_COMPONENTS_SOURCE_ID,\n          type: NEW_COMPONENT_SOURCE_TYPE },\n\n        index: index,\n        depth: 0,\n        disableDragDrop: isSelected,\n        editMode: this.props.editMode\n        // we must use a custom drag preview within the List because\n        // it does not seem to work within a fixed-position container\n        , useEmptyDragPreview: true\n        // List library expect style props here\n        // actual style should be applied to nested AddSliceCard component\n        , style: {}, __source: { fileName: _jsxFileName, lineNumber: 174 }, __self: this },\n\n      ({ dragSourceRef }) =>\n      ___EmotionJSX(CellMeasurer, {\n        cache: cache,\n        columnIndex: 0,\n        key: key,\n        parent: parent,\n        rowIndex: index, __source: { fileName: _jsxFileName, lineNumber: 193 }, __self: this },\n\n      ___EmotionJSX(AddSliceCard, {\n        innerRef: dragSourceRef,\n        style: style,\n        sliceName: cellData.slice_name,\n        lastModified: cellData.changed_on_humanized,\n        visType: cellData.viz_type,\n        datasourceLink: cellData.datasource_link,\n        isSelected: isSelected, __source: { fileName: _jsxFileName, lineNumber: 200 }, __self: this }))));\n\n\n\n\n\n  }\n\n  render() {\n    const slicesListHeight =\n    this.props.height -\n    SIDEPANE_HEADER_HEIGHT -\n    SLICE_ADDER_CONTROL_HEIGHT -\n    MARGIN_BOTTOM;\n    return (\n      ___EmotionJSX(\"div\", { className: \"slice-adder-container\", __source: { fileName: _jsxFileName, lineNumber: 222 }, __self: this },\n      ___EmotionJSX(\"div\", { className: \"controls\", __source: { fileName: _jsxFileName, lineNumber: 223 }, __self: this },\n      ___EmotionJSX(SearchInput, {\n        placeholder: t('Filter your charts'),\n        className: \"search-input\",\n        onChange: this.searchUpdated,\n        onKeyPress: this.handleKeyPress, __source: { fileName: _jsxFileName, lineNumber: 224 }, __self: this }),\n\n\n      ___EmotionJSX(DropdownButton, {\n        title: \"Sort by \" + KEYS_TO_SORT[this.state.sortBy].label,\n        onSelect: this.handleSelect,\n        id: \"slice-adder-sortby\", __source: { fileName: _jsxFileName, lineNumber: 231 }, __self: this },\n\n      _mapInstanceProperty(KEYS_TO_SORT).call(KEYS_TO_SORT, (item, index) =>\n      ___EmotionJSX(MenuItem, { key: item.key, eventKey: index, __source: { fileName: _jsxFileName, lineNumber: 237 }, __self: this }, \"Sort by \",\n      item.label)))),\n\n\n\n\n      this.props.isLoading && ___EmotionJSX(Loading, { __source: { fileName: _jsxFileName, lineNumber: 243 }, __self: this }),\n      !this.props.isLoading && this.state.filteredSlices.length > 0 &&\n      ___EmotionJSX(List, {\n        width: 376,\n        height: slicesListHeight,\n        rowCount: this.state.filteredSlices.length,\n        deferredMeasurementCache: cache,\n        rowHeight: cache.rowHeight,\n        rowRenderer: this.rowRenderer,\n        searchTerm: this.state.searchTerm,\n        sortBy: this.state.sortBy,\n        selectedSliceIds: this.props.selectedSliceIds, __source: { fileName: _jsxFileName, lineNumber: 245 }, __self: this }),\n\n\n      this.props.errorMessage &&\n      ___EmotionJSX(\"div\", { className: \"error-message\", __source: { fileName: _jsxFileName, lineNumber: 258 }, __self: this }, this.props.errorMessage),\n\n\n      ___EmotionJSX(AddSliceDragPreview, { slices: this.state.filteredSlices, __source: { fileName: _jsxFileName, lineNumber: 261 }, __self: this })));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSliceAdder.propTypes = propTypes;\nSliceAdder.defaultProps = defaultProps;const _default =\n\nSliceAdder;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(KEYS_TO_FILTERS, \"KEYS_TO_FILTERS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(KEYS_TO_SORT, \"KEYS_TO_SORT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(MARGIN_BOTTOM, \"MARGIN_BOTTOM\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(SIDEPANE_HEADER_HEIGHT, \"SIDEPANE_HEADER_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(SLICE_ADDER_CONTROL_HEIGHT, \"SLICE_ADDER_CONTROL_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(DEFAULT_CELL_HEIGHT, \"DEFAULT_CELL_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(cache, \"cache\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(SliceAdder, \"SliceAdder\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx"],"names":["React","PropTypes","DropdownButton","MenuItem","CellMeasurer","CellMeasurerCache","List","SearchInput","createFilter","t","AddSliceCard","AddSliceDragPreview","DragDroppable","Loading","CHART_TYPE","NEW_COMPONENT_SOURCE_TYPE","NEW_CHART_ID","NEW_COMPONENTS_SOURCE_ID","slicePropShape","propTypes","fetchAllSlices","func","isRequired","isLoading","bool","slices","objectOf","lastUpdated","number","errorMessage","string","userId","selectedSliceIds","arrayOf","editMode","height","defaultProps","window","innerHeight","KEYS_TO_FILTERS","KEYS_TO_SORT","key","label","MARGIN_BOTTOM","SIDEPANE_HEADER_HEIGHT","SLICE_ADDER_CONTROL_HEIGHT","DEFAULT_CELL_HEIGHT","cache","defaultHeight","fixedWidth","SliceAdder","Component","sortByComparator","attr","desc","a","b","constructor","props","state","filteredSlices","searchTerm","sortBy","item","selectedSliceIdsSet","rowRenderer","searchUpdated","handleKeyPress","handleSelect","componentDidMount","slicesRequest","UNSAFE_componentWillReceiveProps","nextProps","nextState","length","setState","componentWillUnmount","abort","getFilteredSortedSlices","ev","preventDefault","target","value","index","style","parent","cellData","isSelected","has","slice_id","type","id","meta","chartId","sliceName","slice_name","dragSourceRef","changed_on_humanized","viz_type","datasource_link","render","slicesListHeight","rowHeight"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { DropdownButton, MenuItem } from 'react-bootstrap';\nimport { CellMeasurer, CellMeasurerCache, List } from 'react-virtualized';\nimport SearchInput, { createFilter } from 'react-search-input';\nimport { t } from '@superset-ui/translation';\n\nimport AddSliceCard from './AddSliceCard';\nimport AddSliceDragPreview from './dnd/AddSliceDragPreview';\nimport DragDroppable from './dnd/DragDroppable';\nimport Loading from '../../components/Loading';\nimport { CHART_TYPE, NEW_COMPONENT_SOURCE_TYPE } from '../util/componentTypes';\nimport { NEW_CHART_ID, NEW_COMPONENTS_SOURCE_ID } from '../util/constants';\nimport { slicePropShape } from '../util/propShapes';\n\nconst propTypes = {\n  fetchAllSlices: PropTypes.func.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  slices: PropTypes.objectOf(slicePropShape).isRequired,\n  lastUpdated: PropTypes.number.isRequired,\n  errorMessage: PropTypes.string,\n  userId: PropTypes.string.isRequired,\n  selectedSliceIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n  editMode: PropTypes.bool,\n  height: PropTypes.number,\n};\n\nconst defaultProps = {\n  selectedSliceIds: [],\n  editMode: false,\n  errorMessage: '',\n  height: window.innerHeight,\n};\n\nconst KEYS_TO_FILTERS = ['slice_name', 'viz_type', 'datasource_name'];\nconst KEYS_TO_SORT = [\n  { key: 'slice_name', label: 'Name' },\n  { key: 'viz_type', label: 'Vis type' },\n  { key: 'datasource_name', label: 'Datasource' },\n  { key: 'changed_on', label: 'Recent' },\n];\n\nconst MARGIN_BOTTOM = 16;\nconst SIDEPANE_HEADER_HEIGHT = 55;\nconst SLICE_ADDER_CONTROL_HEIGHT = 64;\nconst DEFAULT_CELL_HEIGHT = 136;\n\nconst cache = new CellMeasurerCache({\n  defaultHeight: DEFAULT_CELL_HEIGHT,\n  fixedWidth: true,\n});\n\nclass SliceAdder extends React.Component {\n  static sortByComparator(attr) {\n    const desc = attr === 'changed_on' ? -1 : 1;\n\n    return (a, b) => {\n      if (a[attr] < b[attr]) {\n        return -1 * desc;\n      } else if (a[attr] > b[attr]) {\n        return 1 * desc;\n      }\n      return 0;\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      filteredSlices: [],\n      searchTerm: '',\n      sortBy: KEYS_TO_SORT.findIndex(item => item.key === 'changed_on'),\n      selectedSliceIdsSet: new Set(props.selectedSliceIds),\n    };\n\n    this.rowRenderer = this.rowRenderer.bind(this);\n    this.searchUpdated = this.searchUpdated.bind(this);\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    this.handleSelect = this.handleSelect.bind(this);\n  }\n\n  componentDidMount() {\n    this.slicesRequest = this.props.fetchAllSlices(this.props.userId);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const nextState = {};\n    if (nextProps.lastUpdated !== this.props.lastUpdated) {\n      nextState.filteredSlices = Object.values(nextProps.slices)\n        .filter(createFilter(this.state.searchTerm, KEYS_TO_FILTERS))\n        .sort(SliceAdder.sortByComparator(KEYS_TO_SORT[this.state.sortBy].key));\n    }\n\n    if (nextProps.selectedSliceIds !== this.props.selectedSliceIds) {\n      nextState.selectedSliceIdsSet = new Set(nextProps.selectedSliceIds);\n    }\n\n    if (Object.keys(nextState).length) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.slicesRequest && this.slicesRequest.abort) {\n      this.slicesRequest.abort();\n    }\n  }\n\n  getFilteredSortedSlices(searchTerm, sortBy) {\n    return Object.values(this.props.slices)\n      .filter(createFilter(searchTerm, KEYS_TO_FILTERS))\n      .sort(SliceAdder.sortByComparator(KEYS_TO_SORT[sortBy].key));\n  }\n\n  handleKeyPress(ev) {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n\n      this.searchUpdated(ev.target.value);\n    }\n  }\n\n  searchUpdated(searchTerm) {\n    this.setState({\n      searchTerm,\n      filteredSlices: this.getFilteredSortedSlices(\n        searchTerm,\n        this.state.sortBy,\n      ),\n    });\n  }\n\n  handleSelect(sortBy) {\n    this.setState({\n      sortBy,\n      filteredSlices: this.getFilteredSortedSlices(\n        this.state.searchTerm,\n        sortBy,\n      ),\n    });\n  }\n\n  rowRenderer({ key, index, style, parent }) {\n    const { filteredSlices, selectedSliceIdsSet } = this.state;\n    const cellData = filteredSlices[index];\n    const isSelected = selectedSliceIdsSet.has(cellData.slice_id);\n    const type = CHART_TYPE;\n    const id = NEW_CHART_ID;\n\n    const meta = {\n      chartId: cellData.slice_id,\n      sliceName: cellData.slice_name,\n    };\n    return (\n      <DragDroppable\n        key={key}\n        component={{ type, id, meta }}\n        parentComponent={{\n          id: NEW_COMPONENTS_SOURCE_ID,\n          type: NEW_COMPONENT_SOURCE_TYPE,\n        }}\n        index={index}\n        depth={0}\n        disableDragDrop={isSelected}\n        editMode={this.props.editMode}\n        // we must use a custom drag preview within the List because\n        // it does not seem to work within a fixed-position container\n        useEmptyDragPreview\n        // List library expect style props here\n        // actual style should be applied to nested AddSliceCard component\n        style={{}}\n      >\n        {({ dragSourceRef }) => (\n          <CellMeasurer\n            cache={cache}\n            columnIndex={0}\n            key={key}\n            parent={parent}\n            rowIndex={index}\n          >\n            <AddSliceCard\n              innerRef={dragSourceRef}\n              style={style}\n              sliceName={cellData.slice_name}\n              lastModified={cellData.changed_on_humanized}\n              visType={cellData.viz_type}\n              datasourceLink={cellData.datasource_link}\n              isSelected={isSelected}\n            />\n          </CellMeasurer>\n        )}\n      </DragDroppable>\n    );\n  }\n\n  render() {\n    const slicesListHeight =\n      this.props.height -\n      SIDEPANE_HEADER_HEIGHT -\n      SLICE_ADDER_CONTROL_HEIGHT -\n      MARGIN_BOTTOM;\n    return (\n      <div className=\"slice-adder-container\">\n        <div className=\"controls\">\n          <SearchInput\n            placeholder={t('Filter your charts')}\n            className=\"search-input\"\n            onChange={this.searchUpdated}\n            onKeyPress={this.handleKeyPress}\n          />\n\n          <DropdownButton\n            title={`Sort by ${KEYS_TO_SORT[this.state.sortBy].label}`}\n            onSelect={this.handleSelect}\n            id=\"slice-adder-sortby\"\n          >\n            {KEYS_TO_SORT.map((item, index) => (\n              <MenuItem key={item.key} eventKey={index}>\n                Sort by {item.label}\n              </MenuItem>\n            ))}\n          </DropdownButton>\n        </div>\n        {this.props.isLoading && <Loading />}\n        {!this.props.isLoading && this.state.filteredSlices.length > 0 && (\n          <List\n            width={376}\n            height={slicesListHeight}\n            rowCount={this.state.filteredSlices.length}\n            deferredMeasurementCache={cache}\n            rowHeight={cache.rowHeight}\n            rowRenderer={this.rowRenderer}\n            searchTerm={this.state.searchTerm}\n            sortBy={this.state.sortBy}\n            selectedSliceIds={this.props.selectedSliceIds}\n          />\n        )}\n        {this.props.errorMessage && (\n          <div className=\"error-message\">{this.props.errorMessage}</div>\n        )}\n        {/* Drag preview is just a single fixed-position element */}\n        <AddSliceDragPreview slices={this.state.filteredSlices} />\n      </div>\n    );\n  }\n}\n\nSliceAdder.propTypes = propTypes;\nSliceAdder.defaultProps = defaultProps;\n\nexport default SliceAdder;\n"]},"metadata":{},"sourceType":"module"}