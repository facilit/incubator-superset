{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator\";import _Symbol$toPrimitive from \"@babel/runtime-corejs3/core-js-stable/symbol/to-primitive\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _objectWithoutPropertiesLoose from \"@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _reduceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reduce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();function _toPropertyKey(arg) {var key = _toPrimitive(arg, \"string\");return typeof key === \"symbol\" ? key : String(key);}function _toPrimitive(input, hint) {if (typeof input !== \"object\" || input === null) return input;var prim = input[_Symbol$toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || \"default\");if (typeof res !== \"object\") return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return (hint === \"string\" ? String : Number)(input);}var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n/* eslint-disable camelcase */\nimport {\nADD_FILTER,\nREMOVE_FILTER,\nCHANGE_FILTER,\nUPDATE_DIRECT_PATH_TO_FILTER,\nUPDATE_LAYOUT_COMPONENTS,\nUPDATE_DASHBOARD_FILTERS_SCOPE } from\n'../actions/dashboardFilters';\nimport { TIME_RANGE } from '../../visualizations/FilterBox/FilterBox';\nimport { DASHBOARD_ROOT_ID } from '../util/constants';\nimport getFilterConfigsFromFormdata from '../util/getFilterConfigsFromFormdata';\nimport { buildFilterColorMap } from '../util/dashboardFiltersColorMap';\nimport { buildActiveFilters } from '../util/activeDashboardFilters';\nimport { getChartIdAndColumnFromFilterKey } from '../util/getDashboardFilterKey';\n\nexport const DASHBOARD_FILTER_SCOPE_GLOBAL = {\n  scope: [DASHBOARD_ROOT_ID],\n  immune: [] };\n\n\nexport const dashboardFilter = {\n  chartId: null,\n  componentId: null,\n  filterName: null,\n  datasourceId: null,\n  directPathToFilter: [],\n  isDateFilter: false,\n  isInstantFilter: true,\n  columns: {},\n  labels: {},\n  scopes: {} };\n\n\nconst CHANGE_FILTER_VALUE_ACTIONS = [ADD_FILTER, REMOVE_FILTER, CHANGE_FILTER];\n\nexport default function dashboardFiltersReducer(dashboardFilters = {}, action) {\n  const actionHandlers = {\n    [ADD_FILTER]() {var _context, _context2, _context3, _context4;\n      const { chartId, component, form_data } = action;\n      const { columns, labels } = getFilterConfigsFromFormdata(form_data);\n      const scopes = _reduceInstanceProperty(_context = _Object$keys(columns)).call(_context,\n      (map, column) => _Object$assign({},\n      map, {\n        [column]: DASHBOARD_FILTER_SCOPE_GLOBAL }),\n\n      {});\n\n      const directPathToFilter = component ?\n      _concatInstanceProperty(_context2 = _sliceInstanceProperty(_context3 = component.parents || []).call(_context3)).call(_context2, component.id) :\n      [];\n\n      const newFilter = _Object$assign({},\n      dashboardFilter, {\n        chartId,\n        componentId: component.id,\n        datasourceId: form_data.datasource,\n        filterName: component.meta.sliceName,\n        directPathToFilter,\n        columns,\n        labels,\n        scopes,\n        isInstantFilter: !!form_data.instant_filtering,\n        isDateFilter: _includesInstanceProperty(_context4 = _Object$keys(columns)).call(_context4, TIME_RANGE) });\n\n\n      return newFilter;\n    },\n\n    [CHANGE_FILTER](state) {var _context5;\n      const { newSelectedValues, merge } = action;\n      const updatedColumns = _reduceInstanceProperty(_context5 = _Object$keys(newSelectedValues)).call(_context5,\n      (columns, name) => {\n        // override existed column value, or add new column name\n        if (!merge || !(name in columns)) {\n          return _Object$assign({},\n          columns, {\n            [name]: newSelectedValues[name] });\n\n        }\n\n        return _Object$assign({},\n        columns, {\n          [name]: [...columns[name], ...newSelectedValues[name]] });\n\n      }, _Object$assign({},\n      state.columns));\n\n\n      return _Object$assign({},\n      state, {\n        columns: updatedColumns });\n\n    },\n\n    [UPDATE_DIRECT_PATH_TO_FILTER](state) {\n      const { path } = action;\n      return _Object$assign({},\n      state, {\n        directPathToFilter: path });\n\n    } };\n\n\n  if (action.type === UPDATE_LAYOUT_COMPONENTS) {\n    buildActiveFilters({\n      dashboardFilters,\n      components: action.components });\n\n    return dashboardFilters;\n  } else if (action.type === UPDATE_DASHBOARD_FILTERS_SCOPE) {var _context6;\n    const allDashboardFiltersScope = action.scopes;\n    // update filter scope for each filter field\n    const updatedFilters = _reduceInstanceProperty(_context6 = _Object$entries(allDashboardFiltersScope)).call(_context6,\n    (map, entry) => {\n      const [filterKey, { scope, immune }] = entry;\n      const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n      const scopes = _Object$assign({},\n      map[chartId].scopes, {\n        [column]: {\n          scope,\n          immune } });\n\n\n      return _Object$assign({},\n      map, {\n        [chartId]: _Object$assign({},\n        map[chartId], {\n          scopes }) });\n\n\n    },\n    dashboardFilters);\n\n\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n    return updatedFilters;\n  } else if (action.type === REMOVE_FILTER) {var _context7;\n    const { chartId } = action;\n    const updatedFilters = _objectWithoutPropertiesLoose(dashboardFilters, _mapInstanceProperty(_context7 = [chartId]).call(_context7, _toPropertyKey));\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n    buildFilterColorMap(updatedFilters);\n\n    return updatedFilters;\n  } else if (action.type in actionHandlers) {\n    const updatedFilters = _Object$assign({},\n    dashboardFilters, {\n      [action.chartId]: actionHandlers[action.type](\n      dashboardFilters[action.chartId]) });\n\n\n\n    if (_includesInstanceProperty(CHANGE_FILTER_VALUE_ACTIONS).call(CHANGE_FILTER_VALUE_ACTIONS, action.type)) {\n      buildActiveFilters({ dashboardFilters: updatedFilters });\n      buildFilterColorMap(updatedFilters);\n    }\n\n    return updatedFilters;\n  }\n\n  return dashboardFilters;\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DASHBOARD_FILTER_SCOPE_GLOBAL, \"DASHBOARD_FILTER_SCOPE_GLOBAL\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/reducers/dashboardFilters.js\");reactHotLoader.register(dashboardFilter, \"dashboardFilter\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/reducers/dashboardFilters.js\");reactHotLoader.register(CHANGE_FILTER_VALUE_ACTIONS, \"CHANGE_FILTER_VALUE_ACTIONS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/reducers/dashboardFilters.js\");reactHotLoader.register(dashboardFiltersReducer, \"dashboardFiltersReducer\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/reducers/dashboardFilters.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}