{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */\nimport { getChartControlPanelRegistry } from '@superset-ui/chart';\nimport { controls as SHARED_CONTROLS } from './controls';\nimport * as SECTIONS from './controlPanels/sections';\n\nexport function getFormDataFromControls(controlsState) {var _context;\n  const formData = { queryFields: {} };\n  _forEachInstanceProperty(_context = _Object$keys(controlsState)).call(_context, controlName => {\n    const control = controlsState[controlName];\n    formData[controlName] = control.value;\n    if (control.hasOwnProperty('queryField')) {\n      formData.queryFields[controlName] = control.queryField;\n    }\n  });\n  return formData;\n}\n\nexport function validateControl(control) {\n  const validators = control.validators;\n  if (validators && validators.length > 0) {\n    const validatedControl = _Object$assign({}, control);\n    const validationErrors = [];\n    _forEachInstanceProperty(validators).call(validators, f => {\n      const v = f(control.value);\n      if (v) {\n        validationErrors.push(v);\n      }\n    });\n    delete validatedControl.validators;\n    return _Object$assign({}, validatedControl, { validationErrors });\n  }\n  return control;\n}\n\nfunction findCustomControl(controlPanelSections, controlKey) {\n  // find custom control in `controlPanelSections` and apply `controlOverrides` if needed.\n  for (const section of controlPanelSections) {\n    for (const controlArr of section.controlSetRows) {\n      for (const control of controlArr) {\n        if (control != null && typeof control === 'object') {\n          if (control.config && control.name === controlKey) {\n            return control.config;\n          }\n        }\n      }\n    }\n  }\n  return null;\n}\n\nexport function getControlConfig(controlKey, vizType) {\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  const {\n    controlOverrides = {},\n    controlPanelSections = [] } =\n  controlPanelConfig;\n\n  const config =\n  controlKey in SHARED_CONTROLS ?\n  SHARED_CONTROLS[controlKey] :\n  findCustomControl(controlPanelSections, controlKey);\n\n  return _Object$assign({},\n  config, {},\n  controlOverrides[controlKey]);\n\n}\n\nexport function applyMapStateToPropsToControl(control, state) {\n  if (control.mapStateToProps) {\n    const appliedControl = _Object$assign({}, control);\n    if (state) {\n      _Object$assign(appliedControl, control.mapStateToProps(state, control));\n    }\n    delete appliedControl.mapStateToProps;\n    return appliedControl;\n  }\n  return control;\n}\n\nfunction handleMissingChoice(control) {\n  // If the value is not valid anymore based on choices, clear it\n  const value = control.value;\n  if (\n  control.type === 'SelectControl' &&\n  !control.freeForm &&\n  control.choices &&\n  value)\n  {var _context2;\n    const alteredControl = _Object$assign({}, control);\n    const choiceValues = _mapInstanceProperty(_context2 = control.choices).call(_context2, c => c[0]);\n    if (control.multi && value.length > 0) {\n      alteredControl.value = _filterInstanceProperty(value).call(value, el => _indexOfInstanceProperty(choiceValues).call(choiceValues, el) > -1);\n      return alteredControl;\n    } else if (!control.multi && _indexOfInstanceProperty(choiceValues).call(choiceValues, value) < 0) {\n      alteredControl.value = null;\n      return alteredControl;\n    }\n  }\n  return control;\n}\n\nexport function getControlStateFromControlConfig(controlConfig, state, value) {\n  const controlState = applyMapStateToPropsToControl(_Object$assign({},\n  controlConfig),\n  state);\n\n\n  // If default is a function, evaluate it\n  if (typeof controlState.default === 'function') {\n    controlState.default = controlState.default(controlState);\n  }\n\n  // If a choice control went from multi=false to true, wrap value in array\n  const controlValue =\n  controlConfig.multi && value && !_Array$isArray(value) ? [value] : value;\n  controlState.value =\n  typeof controlValue === 'undefined' ? controlState.default : controlValue;\n\n  return validateControl(handleMissingChoice(controlState));\n}\n\nexport function getControlState(controlKey, vizType, state, value) {\n  return getControlStateFromControlConfig(\n  getControlConfig(controlKey, vizType),\n  state,\n  value);\n\n}\n\nexport function sectionsToRender(vizType, datasourceType) {var _context3, _context4, _context5;\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  const {\n    sectionOverrides = {},\n    controlPanelSections = [] } =\n  controlPanelConfig;\n\n  const sections = _Object$assign({}, SECTIONS);\n\n  _forEachInstanceProperty(_context3 = _Object$entries(sectionOverrides)).call(_context3, ([section, overrides]) => {\n    if (typeof overrides === 'object' && overrides.constructor === Object) {\n      sections[section] = _Object$assign({},\n      sections[section], {},\n      overrides);\n\n    } else {\n      sections[section] = overrides;\n    }\n  });\n\n  const { datasourceAndVizType, sqlaTimeSeries, druidTimeSeries } = sections;\n  const timeSection =\n  datasourceType === 'table' ? sqlaTimeSeries : druidTimeSeries;\n\n  return _filterInstanceProperty(_context4 = _concatInstanceProperty(_context5 = []).call(_context5,\n  datasourceAndVizType, timeSection, controlPanelSections)).call(_context4,\n  section => section);\n}\n\nexport function getAllControlsState(vizType, datasourceType, state, formData) {var _context6;\n  const controlsState = {};\n  _forEachInstanceProperty(_context6 = sectionsToRender(vizType, datasourceType)).call(_context6, section => {var _context7;return (\n      _forEachInstanceProperty(_context7 = section.controlSetRows).call(_context7, (fieldsetRow) =>\n      _forEachInstanceProperty(fieldsetRow).call(fieldsetRow, field => {\n        if (typeof field === 'string') {\n          controlsState[field] = getControlState(\n          field,\n          vizType,\n          state,\n          formData[field]);\n\n        } else if (field != null && typeof field === 'object') {\n          if (field.config && field.name) {\n            const { config, name } = field;\n            controlsState[name] = getControlStateFromControlConfig(\n            config,\n            state,\n            formData[name]);\n\n          }\n        }\n      })));});\n\n\n\n  return controlsState;\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(getFormDataFromControls, \"getFormDataFromControls\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(validateControl, \"validateControl\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(findCustomControl, \"findCustomControl\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(getControlConfig, \"getControlConfig\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(applyMapStateToPropsToControl, \"applyMapStateToPropsToControl\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(handleMissingChoice, \"handleMissingChoice\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(getControlStateFromControlConfig, \"getControlStateFromControlConfig\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(getControlState, \"getControlState\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(sectionsToRender, \"sectionsToRender\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");reactHotLoader.register(getAllControlsState, \"getAllControlsState\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/controlUtils.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}