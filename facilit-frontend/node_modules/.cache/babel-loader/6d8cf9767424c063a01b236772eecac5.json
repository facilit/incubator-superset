{"ast":null,"code":"import \"core-js/modules/es.regexp.to-string\";import \"core-js/modules/web.dom-collections.iterator\";import _Date$now from \"@babel/runtime-corejs3/core-js-stable/date/now\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _snakeCase from \"lodash/snakeCase\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */\nimport dompurify from 'dompurify';\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { SuperChart } from '@superset-ui/chart';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from '../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object.isRequired,\n  initialValues: PropTypes.object,\n  formData: PropTypes.object.isRequired,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  queryResponse: PropTypes.object,\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func };\n\n\nconst BLANK = {};\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false };\n\n\nclass ChartRenderer extends React.Component {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.hasQueryResponseChange = false;\n\n    this.handleAddFilter = _bindInstanceProperty(_context = this.handleAddFilter).call(_context, this);\n    this.handleRenderSuccess = _bindInstanceProperty(_context2 = this.handleRenderSuccess).call(_context2, this);\n    this.handleRenderFailure = _bindInstanceProperty(_context3 = this.handleRenderFailure).call(_context3, this);\n    this.handleSetControlValue = _bindInstanceProperty(_context4 = this.handleSetControlValue).call(_context4, this);\n\n    this.hooks = {\n      onAddFilter: this.handleAddFilter,\n      onError: this.handleRenderFailure,\n      setControlValue: this.handleSetControlValue,\n      onFilterMenuOpen: this.props.onFilterMenuOpen,\n      onFilterMenuClose: this.props.onFilterMenuClose };\n\n  }\n\n  shouldComponentUpdate(nextProps) {var _context5;\n    const resultsReady =\n    nextProps.queryResponse &&\n    _indexOfInstanceProperty(_context5 = ['success', 'rendered']).call(_context5, nextProps.chartStatus) > -1 &&\n    !nextProps.queryResponse.error &&\n    !nextProps.refreshOverlayVisible;\n\n    if (resultsReady) {\n      this.hasQueryResponseChange =\n      nextProps.queryResponse !== this.props.queryResponse;\n\n      if (\n      this.hasQueryResponseChange ||\n      nextProps.annotationData !== this.props.annotationData ||\n      nextProps.height !== this.props.height ||\n      nextProps.width !== this.props.width ||\n      nextProps.triggerRender ||\n      nextProps.formData.color_scheme !== this.props.formData.color_scheme ||\n      nextProps.cacheBusterProp !== this.props.cacheBusterProp)\n      {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  handleAddFilter(col, vals, merge = true, refresh = true) {\n    this.props.addFilter(col, vals, merge, refresh);\n  }\n\n  handleRenderSuccess() {var _context6;\n    const { actions, chartStatus, chartId, vizType } = this.props;\n    if (_indexOfInstanceProperty(_context6 = ['loading', 'rendered']).call(_context6, chartStatus) < 0) {\n      actions.chartRenderingSucceeded(chartId);\n    }\n\n    // only log chart render time which is triggered by query results change\n    // currently we don't log chart re-render time, like window resize etc\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        viz_type: vizType,\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime });\n\n    }\n  }\n\n  handleRenderFailure(error, info) {\n    const { actions, chartId } = this.props;\n    console.warn(error); // eslint-disable-line\n    actions.chartRenderingFailed(\n    error.toString(),\n    chartId,\n    info ? info.componentStack : null);\n\n\n    // only trigger render log when query is changed\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        has_err: true,\n        error_details: error.toString(),\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime });\n\n    }\n  }\n\n  handleSetControlValue(...args) {\n    const { setControlValue } = this.props;\n    if (setControlValue) {\n      setControlValue(...args);\n    }\n  }\n\n  render() {\n    const {\n      chartAlert,\n      chartStatus,\n      vizType,\n      chartId,\n      refreshOverlayVisible } =\n    this.props;\n\n    // Skip chart rendering\n    if (\n    refreshOverlayVisible ||\n    chartStatus === 'loading' ||\n    !!chartAlert ||\n    chartStatus === null)\n    {\n      return null;\n    }\n\n    this.renderStartTime = Logger.getTimestamp();\n\n    const {\n      width,\n      height,\n      annotationData,\n      datasource,\n      initialValues,\n      formData,\n      queryResponse } =\n    this.props;\n\n    // It's bad practice to use unprefixed `vizType` as classnames for chart\n    // container. It may cause css conflicts as in the case of legacy table chart.\n    // When migrating charts, we should gradually add a `superset-chart-` prefix\n    // to each one of them.\n    const snakeCaseVizType = _snakeCase(vizType);\n    const chartClassName =\n    vizType === 'table' ? \"superset-chart-\" +\n    snakeCaseVizType :\n    snakeCaseVizType;\n\n    return (\n      ___EmotionJSX(SuperChart, {\n        disableErrorBoundary: true,\n        key: \"\" + chartId + (\n        process.env.WEBPACK_MODE === 'development' ? \"-\" + _Date$now() : ''),\n\n        id: \"chart-id-\" + chartId,\n        className: chartClassName,\n        chartType: vizType,\n        width: width,\n        height: height,\n        annotationData: annotationData,\n        datasource: datasource,\n        initialValues: initialValues,\n        formData: formData,\n        hooks: this.hooks,\n        queryData: queryResponse,\n        onRenderSuccess: this.handleRenderSuccess,\n        onRenderFailure: this.handleRenderFailure }));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChartRenderer.propTypes = propTypes;\nChartRenderer.defaultProps = defaultProps;const _default =\n\nChartRenderer;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(BLANK, \"BLANK\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(ChartRenderer, \"ChartRenderer\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/ChartRenderer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}