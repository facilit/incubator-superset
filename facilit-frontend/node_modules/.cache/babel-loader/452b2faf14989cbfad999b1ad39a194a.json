{"ast":null,"code":"import \"core-js/modules/es.string.split\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport PropTypes from 'prop-types';\nimport SyntaxHighlighter, {\nregisterLanguage } from\n'react-syntax-highlighter/light';\nimport htmlSyntax from 'react-syntax-highlighter/languages/hljs/htmlbars';\nimport markdownSyntax from 'react-syntax-highlighter/languages/hljs/markdown';\nimport sqlSyntax from 'react-syntax-highlighter/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/languages/hljs/json';\nimport github from 'react-syntax-highlighter/styles/hljs/github';\nimport {\nDropdownButton,\nMenuItem,\nRow,\nCol,\nFormControl } from\n'react-bootstrap';\nimport { Table } from 'reactable-arc';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient } from '@superset-ui/connection';\n\nimport getClientErrorObject from '../../utils/getClientErrorObject';\nimport CopyToClipboard from './../../components/CopyToClipboard';\nimport { getChartDataRequest } from '../../chart/chartAction';\n\nimport Loading from '../../components/Loading';\nimport ModalTrigger from './../../components/ModalTrigger';\nimport Button from '../../components/Button';\nimport RowCountLabel from './RowCountLabel';\nimport { prepareCopyToClipboardTabularData } from '../../utils/common';\nimport PropertiesModal from './PropertiesModal';\nimport { sliceUpdated } from '../actions/exploreActions';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nregisterLanguage('markdown', markdownSyntax);\nregisterLanguage('html', htmlSyntax);\nregisterLanguage('sql', sqlSyntax);\nregisterLanguage('json', jsonSyntax);\n\nconst propTypes = {\n  onOpenInEditor: PropTypes.func,\n  animation: PropTypes.bool,\n  queryResponse: PropTypes.object,\n  chartStatus: PropTypes.string,\n  latestQueryFormData: PropTypes.object.isRequired,\n  slice: PropTypes.object };\n\nconst defaultProps = {\n  animation: true };\n\n\nexport class DisplayQueryButton extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    const { datasource } = props.latestQueryFormData;\n    this.state = {\n      language: null,\n      query: null,\n      data: null,\n      isLoading: false,\n      error: null,\n      filterText: '',\n      sqlSupported: datasource && datasource.split('__')[1] === 'table',\n      isPropertiesModalOpen: false };\n\n    this.beforeOpen = _bindInstanceProperty(_context = this.beforeOpen).call(_context, this);\n    this.changeFilterText = _bindInstanceProperty(_context2 = this.changeFilterText).call(_context2, this);\n    this.openPropertiesModal = _bindInstanceProperty(_context3 = this.openPropertiesModal).call(_context3, this);\n    this.closePropertiesModal = _bindInstanceProperty(_context4 = this.closePropertiesModal).call(_context4, this);\n  }\n  beforeOpen(resultType) {\n    this.setState({ isLoading: true });\n\n    getChartDataRequest({\n      formData: this.props.latestQueryFormData,\n      resultFormat: 'json',\n      resultType }).\n\n    then(response => {\n      // Currently displaying of only first query is supported\n      const result = response.result[0];\n      this.setState({\n        language: result.language,\n        query: result.query,\n        data: result.data,\n        isLoading: false,\n        error: null });\n\n    }).\n    catch(response => {\n      getClientErrorObject(response).then(({ error, statusText }) => {\n        this.setState({\n          error: error || statusText || t('Sorry, An error occurred'),\n          isLoading: false });\n\n      });\n    });\n  }\n  changeFilterText(event) {\n    this.setState({ filterText: event.target.value });\n  }\n  redirectSQLLab() {\n    this.props.onOpenInEditor(this.props.latestQueryFormData);\n  }\n  openPropertiesModal() {\n    this.setState({ isPropertiesModalOpen: true });\n  }\n  closePropertiesModal() {\n    this.setState({ isPropertiesModalOpen: false });\n  }\n  renderQueryModalBody() {\n    if (this.state.isLoading) {\n      return ___EmotionJSX(Loading, { __source: { fileName: _jsxFileName, lineNumber: 132 }, __self: this });\n    } else if (this.state.error) {\n      return ___EmotionJSX(\"pre\", { __source: { fileName: _jsxFileName, lineNumber: 134 }, __self: this }, this.state.error);\n    } else if (this.state.query) {\n      return (\n        ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 137 }, __self: this },\n        ___EmotionJSX(CopyToClipboard, {\n          text: this.state.query,\n          shouldShowText: false,\n          copyNode:\n          ___EmotionJSX(Button, { style: { position: 'absolute', right: 20 }, __source: { fileName: _jsxFileName, lineNumber: 142 }, __self: this },\n          ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\", __source: { fileName: _jsxFileName, lineNumber: 143 }, __self: this })), __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this }),\n\n\n\n        ___EmotionJSX(SyntaxHighlighter, { language: this.state.language, style: github, __source: { fileName: _jsxFileName, lineNumber: 147 }, __self: this },\n        this.state.query)));\n\n\n\n    }\n    return null;\n  }\n  renderResultsModalBody() {\n    if (this.state.isLoading) {\n      return ___EmotionJSX(Loading, { __source: { fileName: _jsxFileName, lineNumber: 157 }, __self: this });\n    } else if (this.state.error) {\n      return ___EmotionJSX(\"pre\", { __source: { fileName: _jsxFileName, lineNumber: 159 }, __self: this }, this.state.error);\n    } else if (this.state.data) {\n      if (this.state.data.length === 0) {\n        return 'No data';\n      }\n      return this.renderDataTable(this.state.data);\n    }\n    return null;\n  }\n  renderDataTable(data) {\n    return (\n      ___EmotionJSX(\"div\", { style: { overflow: 'auto' }, __source: { fileName: _jsxFileName, lineNumber: 170 }, __self: this },\n      ___EmotionJSX(Row, { __source: { fileName: _jsxFileName, lineNumber: 171 }, __self: this },\n      ___EmotionJSX(Col, { md: 9, __source: { fileName: _jsxFileName, lineNumber: 172 }, __self: this },\n      ___EmotionJSX(RowCountLabel, {\n        rowcount: data.length,\n        suffix: t('rows retrieved'), __source: { fileName: _jsxFileName, lineNumber: 173 }, __self: this }),\n\n      ___EmotionJSX(CopyToClipboard, {\n        text: prepareCopyToClipboardTabularData(data),\n        wrapped: false,\n        copyNode:\n        ___EmotionJSX(Button, { style: { padding: '2px 10px', fontSize: '11px' }, __source: { fileName: _jsxFileName, lineNumber: 181 }, __self: this },\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\", __source: { fileName: _jsxFileName, lineNumber: 182 }, __self: this })), __source: { fileName: _jsxFileName, lineNumber: 177 }, __self: this })),\n\n\n\n\n      ___EmotionJSX(Col, { md: 3, __source: { fileName: _jsxFileName, lineNumber: 187 }, __self: this },\n      ___EmotionJSX(FormControl, {\n        placeholder: t('Search'),\n        bsSize: \"sm\",\n        value: this.state.filterText,\n        onChange: this.changeFilterText,\n        style: { paddingBottom: '5px' }, __source: { fileName: _jsxFileName, lineNumber: 188 }, __self: this }))),\n\n\n\n      ___EmotionJSX(Table, {\n        className: \"table table-condensed\",\n        sortable: true,\n        data: data,\n        hideFilterInput: true,\n        filterBy: this.state.filterText,\n        filterable: data.length ? _Object$keys(data[0]) : null,\n        noDataText: t('No data'), __source: { fileName: _jsxFileName, lineNumber: 197 }, __self: this })));\n\n\n\n  }\n  renderSamplesModalBody() {\n    if (this.state.isLoading) {\n      return (\n        ___EmotionJSX(\"img\", {\n          className: \"loading\",\n          alt: \"Loading...\",\n          src: \"/static/assets/images/loading.gif\", __source: { fileName: _jsxFileName, lineNumber: 212 }, __self: this }));\n\n\n    } else if (this.state.error) {\n      return ___EmotionJSX(\"pre\", { __source: { fileName: _jsxFileName, lineNumber: 219 }, __self: this }, this.state.error);\n    } else if (this.state.data) {\n      return this.renderDataTable(this.state.data);\n    }\n    return null;\n  }\n  render() {var _context5;\n    const { animation, slice } = this.props;\n    return (\n      ___EmotionJSX(DropdownButton, {\n        noCaret: true,\n        title:\n        ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 231 }, __self: this },\n        ___EmotionJSX(\"i\", { className: \"fa fa-bars\", __source: { fileName: _jsxFileName, lineNumber: 232 }, __self: this }), \"\\xA0\"),\n\n\n\n        bsSize: \"sm\",\n        pullRight: true,\n        id: \"query\", __source: { fileName: _jsxFileName, lineNumber: 228 }, __self: this },\n\n      slice &&\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(MenuItem, { onClick: this.openPropertiesModal, __source: { fileName: _jsxFileName, lineNumber: 242 }, __self: this },\n      t('Edit properties')),\n\n      ___EmotionJSX(PropertiesModal, {\n        slice: slice,\n        show: this.state.isPropertiesModalOpen,\n        onHide: this.closePropertiesModal,\n        onSave: this.props.sliceUpdated,\n        animation: animation, __source: { fileName: _jsxFileName, lineNumber: 245 }, __self: this })),\n\n\n\n      ___EmotionJSX(ModalTrigger, {\n        isMenuItem: true,\n        animation: animation,\n        triggerNode: ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 257 }, __self: this }, t('View query')),\n        modalTitle: t('View query'),\n        bsSize: \"large\",\n        beforeOpen: () => this.beforeOpen('query'),\n        modalBody: this.renderQueryModalBody(), __source: { fileName: _jsxFileName, lineNumber: 254 }, __self: this }),\n\n      ___EmotionJSX(ModalTrigger, {\n        isMenuItem: true,\n        animation: animation,\n        triggerNode: ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 266 }, __self: this }, t('View results')),\n        modalTitle: t('View results'),\n        bsSize: \"large\",\n        beforeOpen: () => this.beforeOpen('results'),\n        modalBody: this.renderResultsModalBody(), __source: { fileName: _jsxFileName, lineNumber: 263 }, __self: this }),\n\n      ___EmotionJSX(ModalTrigger, {\n        isMenuItem: true,\n        animation: animation,\n        triggerNode: ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 275 }, __self: this }, t('View samples')),\n        modalTitle: t('View samples'),\n        bsSize: \"large\",\n        beforeOpen: () => this.beforeOpen('samples'),\n        modalBody: this.renderSamplesModalBody(), __source: { fileName: _jsxFileName, lineNumber: 272 }, __self: this }),\n\n      this.state.sqlSupported &&\n      ___EmotionJSX(MenuItem, { eventKey: \"3\", onClick: _bindInstanceProperty(_context5 = this.redirectSQLLab).call(_context5, this), __source: { fileName: _jsxFileName, lineNumber: 282 }, __self: this },\n      t('Run in SQL Lab'))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nDisplayQueryButton.propTypes = propTypes;\nDisplayQueryButton.defaultProps = defaultProps;\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({ sliceUpdated }, dispatch);\n}const _default =\n\nconnect(null, mapDispatchToProps)(DisplayQueryButton);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(DisplayQueryButton, \"DisplayQueryButton\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/DisplayQueryButton.jsx"],"names":["React","connect","bindActionCreators","PropTypes","SyntaxHighlighter","registerLanguage","htmlSyntax","markdownSyntax","sqlSyntax","jsonSyntax","github","DropdownButton","MenuItem","Row","Col","FormControl","Table","t","SupersetClient","getClientErrorObject","CopyToClipboard","getChartDataRequest","Loading","ModalTrigger","Button","RowCountLabel","prepareCopyToClipboardTabularData","PropertiesModal","sliceUpdated","propTypes","onOpenInEditor","func","animation","bool","queryResponse","object","chartStatus","string","latestQueryFormData","isRequired","slice","defaultProps","DisplayQueryButton","PureComponent","constructor","props","datasource","state","language","query","data","isLoading","error","filterText","sqlSupported","split","isPropertiesModalOpen","beforeOpen","changeFilterText","openPropertiesModal","closePropertiesModal","resultType","setState","formData","resultFormat","then","response","result","catch","statusText","event","target","value","redirectSQLLab","renderQueryModalBody","position","right","renderResultsModalBody","length","renderDataTable","overflow","padding","fontSize","paddingBottom","renderSamplesModalBody","render","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport PropTypes from 'prop-types';\nimport SyntaxHighlighter, {\n  registerLanguage,\n} from 'react-syntax-highlighter/light';\nimport htmlSyntax from 'react-syntax-highlighter/languages/hljs/htmlbars';\nimport markdownSyntax from 'react-syntax-highlighter/languages/hljs/markdown';\nimport sqlSyntax from 'react-syntax-highlighter/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/languages/hljs/json';\nimport github from 'react-syntax-highlighter/styles/hljs/github';\nimport {\n  DropdownButton,\n  MenuItem,\n  Row,\n  Col,\n  FormControl,\n} from 'react-bootstrap';\nimport { Table } from 'reactable-arc';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient } from '@superset-ui/connection';\n\nimport getClientErrorObject from '../../utils/getClientErrorObject';\nimport CopyToClipboard from './../../components/CopyToClipboard';\nimport { getChartDataRequest } from '../../chart/chartAction';\n\nimport Loading from '../../components/Loading';\nimport ModalTrigger from './../../components/ModalTrigger';\nimport Button from '../../components/Button';\nimport RowCountLabel from './RowCountLabel';\nimport { prepareCopyToClipboardTabularData } from '../../utils/common';\nimport PropertiesModal from './PropertiesModal';\nimport { sliceUpdated } from '../actions/exploreActions';\n\nregisterLanguage('markdown', markdownSyntax);\nregisterLanguage('html', htmlSyntax);\nregisterLanguage('sql', sqlSyntax);\nregisterLanguage('json', jsonSyntax);\n\nconst propTypes = {\n  onOpenInEditor: PropTypes.func,\n  animation: PropTypes.bool,\n  queryResponse: PropTypes.object,\n  chartStatus: PropTypes.string,\n  latestQueryFormData: PropTypes.object.isRequired,\n  slice: PropTypes.object,\n};\nconst defaultProps = {\n  animation: true,\n};\n\nexport class DisplayQueryButton extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const { datasource } = props.latestQueryFormData;\n    this.state = {\n      language: null,\n      query: null,\n      data: null,\n      isLoading: false,\n      error: null,\n      filterText: '',\n      sqlSupported: datasource && datasource.split('__')[1] === 'table',\n      isPropertiesModalOpen: false,\n    };\n    this.beforeOpen = this.beforeOpen.bind(this);\n    this.changeFilterText = this.changeFilterText.bind(this);\n    this.openPropertiesModal = this.openPropertiesModal.bind(this);\n    this.closePropertiesModal = this.closePropertiesModal.bind(this);\n  }\n  beforeOpen(resultType) {\n    this.setState({ isLoading: true });\n\n    getChartDataRequest({\n      formData: this.props.latestQueryFormData,\n      resultFormat: 'json',\n      resultType,\n    })\n      .then(response => {\n        // Currently displaying of only first query is supported\n        const result = response.result[0];\n        this.setState({\n          language: result.language,\n          query: result.query,\n          data: result.data,\n          isLoading: false,\n          error: null,\n        });\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(({ error, statusText }) => {\n          this.setState({\n            error: error || statusText || t('Sorry, An error occurred'),\n            isLoading: false,\n          });\n        });\n      });\n  }\n  changeFilterText(event) {\n    this.setState({ filterText: event.target.value });\n  }\n  redirectSQLLab() {\n    this.props.onOpenInEditor(this.props.latestQueryFormData);\n  }\n  openPropertiesModal() {\n    this.setState({ isPropertiesModalOpen: true });\n  }\n  closePropertiesModal() {\n    this.setState({ isPropertiesModalOpen: false });\n  }\n  renderQueryModalBody() {\n    if (this.state.isLoading) {\n      return <Loading />;\n    } else if (this.state.error) {\n      return <pre>{this.state.error}</pre>;\n    } else if (this.state.query) {\n      return (\n        <div>\n          <CopyToClipboard\n            text={this.state.query}\n            shouldShowText={false}\n            copyNode={\n              <Button style={{ position: 'absolute', right: 20 }}>\n                <i className=\"fa fa-clipboard\" />\n              </Button>\n            }\n          />\n          <SyntaxHighlighter language={this.state.language} style={github}>\n            {this.state.query}\n          </SyntaxHighlighter>\n        </div>\n      );\n    }\n    return null;\n  }\n  renderResultsModalBody() {\n    if (this.state.isLoading) {\n      return <Loading />;\n    } else if (this.state.error) {\n      return <pre>{this.state.error}</pre>;\n    } else if (this.state.data) {\n      if (this.state.data.length === 0) {\n        return 'No data';\n      }\n      return this.renderDataTable(this.state.data);\n    }\n    return null;\n  }\n  renderDataTable(data) {\n    return (\n      <div style={{ overflow: 'auto' }}>\n        <Row>\n          <Col md={9}>\n            <RowCountLabel\n              rowcount={data.length}\n              suffix={t('rows retrieved')}\n            />\n            <CopyToClipboard\n              text={prepareCopyToClipboardTabularData(data)}\n              wrapped={false}\n              copyNode={\n                <Button style={{ padding: '2px 10px', fontSize: '11px' }}>\n                  <i className=\"fa fa-clipboard\" />\n                </Button>\n              }\n            />\n          </Col>\n          <Col md={3}>\n            <FormControl\n              placeholder={t('Search')}\n              bsSize=\"sm\"\n              value={this.state.filterText}\n              onChange={this.changeFilterText}\n              style={{ paddingBottom: '5px' }}\n            />\n          </Col>\n        </Row>\n        <Table\n          className=\"table table-condensed\"\n          sortable\n          data={data}\n          hideFilterInput\n          filterBy={this.state.filterText}\n          filterable={data.length ? Object.keys(data[0]) : null}\n          noDataText={t('No data')}\n        />\n      </div>\n    );\n  }\n  renderSamplesModalBody() {\n    if (this.state.isLoading) {\n      return (\n        <img\n          className=\"loading\"\n          alt=\"Loading...\"\n          src=\"/static/assets/images/loading.gif\"\n        />\n      );\n    } else if (this.state.error) {\n      return <pre>{this.state.error}</pre>;\n    } else if (this.state.data) {\n      return this.renderDataTable(this.state.data);\n    }\n    return null;\n  }\n  render() {\n    const { animation, slice } = this.props;\n    return (\n      <DropdownButton\n        noCaret\n        title={\n          <span>\n            <i className=\"fa fa-bars\" />\n            &nbsp;\n          </span>\n        }\n        bsSize=\"sm\"\n        pullRight\n        id=\"query\"\n      >\n        {slice && (\n          <>\n            <MenuItem onClick={this.openPropertiesModal}>\n              {t('Edit properties')}\n            </MenuItem>\n            <PropertiesModal\n              slice={slice}\n              show={this.state.isPropertiesModalOpen}\n              onHide={this.closePropertiesModal}\n              onSave={this.props.sliceUpdated}\n              animation={animation}\n            />\n          </>\n        )}\n        <ModalTrigger\n          isMenuItem\n          animation={animation}\n          triggerNode={<span>{t('View query')}</span>}\n          modalTitle={t('View query')}\n          bsSize=\"large\"\n          beforeOpen={() => this.beforeOpen('query')}\n          modalBody={this.renderQueryModalBody()}\n        />\n        <ModalTrigger\n          isMenuItem\n          animation={animation}\n          triggerNode={<span>{t('View results')}</span>}\n          modalTitle={t('View results')}\n          bsSize=\"large\"\n          beforeOpen={() => this.beforeOpen('results')}\n          modalBody={this.renderResultsModalBody()}\n        />\n        <ModalTrigger\n          isMenuItem\n          animation={animation}\n          triggerNode={<span>{t('View samples')}</span>}\n          modalTitle={t('View samples')}\n          bsSize=\"large\"\n          beforeOpen={() => this.beforeOpen('samples')}\n          modalBody={this.renderSamplesModalBody()}\n        />\n        {this.state.sqlSupported && (\n          <MenuItem eventKey=\"3\" onClick={this.redirectSQLLab.bind(this)}>\n            {t('Run in SQL Lab')}\n          </MenuItem>\n        )}\n      </DropdownButton>\n    );\n  }\n}\n\nDisplayQueryButton.propTypes = propTypes;\nDisplayQueryButton.defaultProps = defaultProps;\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({ sliceUpdated }, dispatch);\n}\n\nexport default connect(null, mapDispatchToProps)(DisplayQueryButton);\n"]},"metadata":{},"sourceType":"module"}