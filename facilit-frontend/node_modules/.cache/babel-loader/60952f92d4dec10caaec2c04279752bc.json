{"ast":null,"code":"import \"core-js/modules/es.string.split\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";var _context2;(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */\n/* eslint camelcase: 0 */\nimport { getChartControlPanelRegistry } from '@superset-ui/chart';\nimport { getAllControlsState, getFormDataFromControls } from './controlUtils';\nimport controls from './controls';\n\nfunction handleDeprecatedControls(formData) {\n  // Reacffectation / handling of deprecated controls\n  /* eslint-disable no-param-reassign */\n\n  // y_axis_zero was a boolean forcing 0 to be part of the Y Axis\n  if (formData.y_axis_zero) {\n    formData.y_axis_bounds = [0, null];\n  }\n}\n\nexport function getControlsState(state, inputFormData) {\n  /*\n                                                         * Gets a new controls object to put in the state. The controls object\n                                                         * is similar to the configuration control with only the controls\n                                                         * related to the current viz_type, materializes mapStateToProps functions,\n                                                         * adds value keys coming from inputFormData passed here. This can't be an action creator\n                                                         * just yet because it's used in both the explore and dashboard views.\n                                                         * */\n\n  // Getting a list of active control names for the current viz\n  const formData = _Object$assign({}, inputFormData);\n  const vizType = formData.viz_type || 'table';\n\n  handleDeprecatedControls(formData);\n\n  const controlsState = getAllControlsState(\n  vizType,\n  state.datasource.type,\n  state,\n  formData);\n\n\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  if (controlPanelConfig.onInit) {\n    return controlPanelConfig.onInit(controlsState);\n  }\n\n  return controlsState;\n}\n\nexport function applyDefaultFormData(inputFormData) {var _context;\n  const datasourceType = inputFormData.datasource.split('__')[1];\n  const vizType = inputFormData.viz_type;\n  const controlsState = getAllControlsState(vizType, datasourceType, null, _Object$assign({},\n  inputFormData));\n\n  const controlFormData = getFormDataFromControls(controlsState);\n\n  const formData = {};\n  _forEachInstanceProperty(_context = _Object$keys(controlsState)).call(_context, controlName => {\n    if (inputFormData[controlName] === undefined) {\n      formData[controlName] = controlFormData[controlName];\n    } else {\n      formData[controlName] = inputFormData[controlName];\n    }\n  });\n\n  // always use dynamically generated queryFields\n  formData.queryFields = controlFormData.queryFields;\n  return formData;\n}\n\nconst defaultControls = _Object$assign({}, controls);\n_forEachInstanceProperty(_context2 = _Object$keys(controls)).call(_context2, f => {\n  defaultControls[f].value = controls[f].default;\n});\n\nconst defaultState = {\n  controls: defaultControls,\n  form_data: getFormDataFromControls(defaultControls) };\n\n\nexport { defaultControls, defaultState };;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(handleDeprecatedControls, \"handleDeprecatedControls\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/store.js\");reactHotLoader.register(getControlsState, \"getControlsState\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/store.js\");reactHotLoader.register(applyDefaultFormData, \"applyDefaultFormData\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/store.js\");reactHotLoader.register(defaultControls, \"defaultControls\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/store.js\");reactHotLoader.register(defaultState, \"defaultState\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/store.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/store.js"],"names":["getChartControlPanelRegistry","getAllControlsState","getFormDataFromControls","controls","handleDeprecatedControls","formData","y_axis_zero","y_axis_bounds","getControlsState","state","inputFormData","vizType","viz_type","controlsState","datasource","type","controlPanelConfig","get","onInit","applyDefaultFormData","datasourceType","split","controlFormData","controlName","undefined","queryFields","defaultControls","f","value","default","defaultState","form_data"],"mappings":"4lBAAA;;;;;;;;;;;;;;;;;;AAkBA;AACA,SAASA,4BAAT,QAA6C,oBAA7C;AACA,SAASC,mBAAT,EAA8BC,uBAA9B,QAA6D,gBAA7D;AACA,OAAOC,QAAP,MAAqB,YAArB;;AAEA,SAASC,wBAAT,CAAkCC,QAAlC,EAA4C;AAC1C;AACA;;AAEA;AACA,MAAIA,QAAQ,CAACC,WAAb,EAA0B;AACxBD,IAAAA,QAAQ,CAACE,aAAT,GAAyB,CAAC,CAAD,EAAI,IAAJ,CAAzB;AACD;AACF;;AAED,OAAO,SAASC,gBAAT,CAA0BC,KAA1B,EAAiCC,aAAjC,EAAgD;AACrD;;;;;;;;AAQA;AACA,QAAML,QAAQ,sBAAQK,aAAR,CAAd;AACA,QAAMC,OAAO,GAAGN,QAAQ,CAACO,QAAT,IAAqB,OAArC;;AAEAR,EAAAA,wBAAwB,CAACC,QAAD,CAAxB;;AAEA,QAAMQ,aAAa,GAAGZ,mBAAmB;AACvCU,EAAAA,OADuC;AAEvCF,EAAAA,KAAK,CAACK,UAAN,CAAiBC,IAFsB;AAGvCN,EAAAA,KAHuC;AAIvCJ,EAAAA,QAJuC,CAAzC;;;AAOA,QAAMW,kBAAkB,GAAGhB,4BAA4B,GAAGiB,GAA/B,CAAmCN,OAAnC,KAA+C,EAA1E;AACA,MAAIK,kBAAkB,CAACE,MAAvB,EAA+B;AAC7B,WAAOF,kBAAkB,CAACE,MAAnB,CAA0BL,aAA1B,CAAP;AACD;;AAED,SAAOA,aAAP;AACD;;AAED,OAAO,SAASM,oBAAT,CAA8BT,aAA9B,EAA6C;AAClD,QAAMU,cAAc,GAAGV,aAAa,CAACI,UAAd,CAAyBO,KAAzB,CAA+B,IAA/B,EAAqC,CAArC,CAAvB;AACA,QAAMV,OAAO,GAAGD,aAAa,CAACE,QAA9B;AACA,QAAMC,aAAa,GAAGZ,mBAAmB,CAACU,OAAD,EAAUS,cAAV,EAA0B,IAA1B;AACpCV,EAAAA,aADoC,EAAzC;;AAGA,QAAMY,eAAe,GAAGpB,uBAAuB,CAACW,aAAD,CAA/C;;AAEA,QAAMR,QAAQ,GAAG,EAAjB;AACA,mDAAYQ,aAAZ,kBAAmCU,WAAW,IAAI;AAChD,QAAIb,aAAa,CAACa,WAAD,CAAb,KAA+BC,SAAnC,EAA8C;AAC5CnB,MAAAA,QAAQ,CAACkB,WAAD,CAAR,GAAwBD,eAAe,CAACC,WAAD,CAAvC;AACD,KAFD,MAEO;AACLlB,MAAAA,QAAQ,CAACkB,WAAD,CAAR,GAAwBb,aAAa,CAACa,WAAD,CAArC;AACD;AACF,GAND;;AAQA;AACAlB,EAAAA,QAAQ,CAACoB,WAAT,GAAuBH,eAAe,CAACG,WAAvC;AACA,SAAOpB,QAAP;AACD;;AAED,MAAMqB,eAAe,sBAAQvB,QAAR,CAArB;AACA,kDAAYA,QAAZ,mBAA8BwB,CAAC,IAAI;AACjCD,EAAAA,eAAe,CAACC,CAAD,CAAf,CAAmBC,KAAnB,GAA2BzB,QAAQ,CAACwB,CAAD,CAAR,CAAYE,OAAvC;AACD,CAFD;;AAIA,MAAMC,YAAY,GAAG;AACnB3B,EAAAA,QAAQ,EAAEuB,eADS;AAEnBK,EAAAA,SAAS,EAAE7B,uBAAuB,CAACwB,eAAD,CAFf,EAArB;;;AAKA,SAASA,eAAT,EAA0BI,YAA1B,G,iLAxES1B,wB,2IAUOI,gB,mIA8BAW,oB,uIAsBVO,e,kIAKAI,Y","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { getChartControlPanelRegistry } from '@superset-ui/chart';\nimport { getAllControlsState, getFormDataFromControls } from './controlUtils';\nimport controls from './controls';\n\nfunction handleDeprecatedControls(formData) {\n  // Reacffectation / handling of deprecated controls\n  /* eslint-disable no-param-reassign */\n\n  // y_axis_zero was a boolean forcing 0 to be part of the Y Axis\n  if (formData.y_axis_zero) {\n    formData.y_axis_bounds = [0, null];\n  }\n}\n\nexport function getControlsState(state, inputFormData) {\n  /*\n   * Gets a new controls object to put in the state. The controls object\n   * is similar to the configuration control with only the controls\n   * related to the current viz_type, materializes mapStateToProps functions,\n   * adds value keys coming from inputFormData passed here. This can't be an action creator\n   * just yet because it's used in both the explore and dashboard views.\n   * */\n\n  // Getting a list of active control names for the current viz\n  const formData = { ...inputFormData };\n  const vizType = formData.viz_type || 'table';\n\n  handleDeprecatedControls(formData);\n\n  const controlsState = getAllControlsState(\n    vizType,\n    state.datasource.type,\n    state,\n    formData,\n  );\n\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  if (controlPanelConfig.onInit) {\n    return controlPanelConfig.onInit(controlsState);\n  }\n\n  return controlsState;\n}\n\nexport function applyDefaultFormData(inputFormData) {\n  const datasourceType = inputFormData.datasource.split('__')[1];\n  const vizType = inputFormData.viz_type;\n  const controlsState = getAllControlsState(vizType, datasourceType, null, {\n    ...inputFormData,\n  });\n  const controlFormData = getFormDataFromControls(controlsState);\n\n  const formData = {};\n  Object.keys(controlsState).forEach(controlName => {\n    if (inputFormData[controlName] === undefined) {\n      formData[controlName] = controlFormData[controlName];\n    } else {\n      formData[controlName] = inputFormData[controlName];\n    }\n  });\n\n  // always use dynamically generated queryFields\n  formData.queryFields = controlFormData.queryFields;\n  return formData;\n}\n\nconst defaultControls = { ...controls };\nObject.keys(controls).forEach(f => {\n  defaultControls[f].value = controls[f].default;\n});\n\nconst defaultState = {\n  controls: defaultControls,\n  form_data: getFormDataFromControls(defaultControls),\n};\n\nexport { defaultControls, defaultState };\n"]},"metadata":{},"sourceType":"module"}