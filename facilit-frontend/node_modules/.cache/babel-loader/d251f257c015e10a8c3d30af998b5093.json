{"ast":null,"code":"import \"core-js/modules/es.symbol.description\";import \"core-js/modules/web.dom-collections.iterator\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Form from 'react-jsonschema-form';\nimport chrono from 'chrono-node';\nimport { Col, FormControl, FormGroup, Row } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport Button from '../../components/Button';\nimport ModalTrigger from '../../components/ModalTrigger';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst validators = {\n  greater: (a, b) => a > b,\n  greater_equal: (a, b) => a >= b,\n  less: (a, b) => a < b,\n  less_equal: (a, b) => a <= b };\n\n\nfunction getJSONSchema() {var _context;\n  const jsonSchema = window.featureFlags.SCHEDULED_QUERIES.JSONSCHEMA;\n  // parse date-time into usable value (eg, 'today' => `new Date()`)\n  _forEachInstanceProperty(_context = _Object$entries(jsonSchema.properties)).call(_context, ([key, properties]) => {\n    if (properties.default && properties.format === 'date-time') {\n      jsonSchema.properties[key] = _Object$assign({},\n      properties, {\n        default: chrono.parseDate(properties.default).toISOString() });\n\n    }\n  });\n  return jsonSchema;\n}\n\nfunction getUISchema() {\n  return window.featureFlags.SCHEDULED_QUERIES.UISCHEMA;\n}\n\nfunction getValidationRules() {\n  return window.featureFlags.SCHEDULED_QUERIES.VALIDATION || [];\n}\n\nfunction getValidator() {\n  const rules = getValidationRules();\n  return (formData, errors) => {\n    _forEachInstanceProperty(rules).call(rules, rule => {var _context2, _context3;\n      const test = validators[rule.name];\n      const args = _mapInstanceProperty(_context2 = rule.arguments).call(_context2, name => formData[name]);\n      const container = rule.container || _sliceInstanceProperty(_context3 = rule.arguments).call(_context3, -1)[0];\n      if (!test(...args)) {\n        errors[container].addError(rule.message);\n      }\n    });\n    return errors;\n  };\n}\n\nconst propTypes = {\n  defaultLabel: PropTypes.string,\n  sql: PropTypes.string.isRequired,\n  schema: PropTypes.string.isRequired,\n  dbId: PropTypes.number.isRequired,\n  animation: PropTypes.bool,\n  onSchedule: PropTypes.func,\n  scheduleQueryWarning: PropTypes.string,\n  disabled: PropTypes.bool,\n  tooltip: PropTypes.string };\n\nconst defaultProps = {\n  defaultLabel: t('Undefined'),\n  animation: true,\n  onSchedule: () => {},\n  scheduleQueryWarning: null,\n  disabled: false,\n  tooltip: null };\n\n\nclass ScheduleQueryButton extends React.PureComponent {\n  constructor(props) {var _context4, _context5, _context6, _context7, _context8;\n    super(props);\n    this.state = {\n      description: '',\n      label: props.defaultLabel,\n      showSchedule: false };\n\n    this.toggleSchedule = _bindInstanceProperty(_context4 = this.toggleSchedule).call(_context4, this);\n    this.onSchedule = _bindInstanceProperty(_context5 = this.onSchedule).call(_context5, this);\n    this.onCancel = _bindInstanceProperty(_context6 = this.onCancel).call(_context6, this);\n    this.onLabelChange = _bindInstanceProperty(_context7 = this.onLabelChange).call(_context7, this);\n    this.onDescriptionChange = _bindInstanceProperty(_context8 = this.onDescriptionChange).call(_context8, this);\n  }\n  onSchedule({ formData }) {\n    const query = {\n      label: this.state.label,\n      description: this.state.description,\n      db_id: this.props.dbId,\n      schema: this.props.schema,\n      sql: this.props.sql,\n      extra_json: _JSON$stringify({ schedule_info: formData }) };\n\n    this.props.onSchedule(query);\n    this.saveModal.close();\n  }\n  onCancel() {\n    this.saveModal.close();\n  }\n  onLabelChange(e) {\n    this.setState({ label: e.target.value });\n  }\n  onDescriptionChange(e) {\n    this.setState({ description: e.target.value });\n  }\n  toggleSchedule() {\n    this.setState({ showSchedule: !this.state.showSchedule });\n  }\n  renderModalBody() {\n    return (\n      ___EmotionJSX(FormGroup, null,\n      ___EmotionJSX(Row, { style: { paddingBottom: '10px' } },\n      ___EmotionJSX(Col, { md: 12 },\n      ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"embed-height\" },\n      t('Label')),\n\n      ___EmotionJSX(FormControl, {\n        type: \"text\",\n        placeholder: t('Label for your query'),\n        value: this.state.label,\n        onChange: this.onLabelChange }))),\n\n\n\n      ___EmotionJSX(Row, { style: { paddingBottom: '10px' } },\n      ___EmotionJSX(Col, { md: 12 },\n      ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"embed-height\" },\n      t('Description')),\n\n      ___EmotionJSX(FormControl, {\n        componentClass: \"textarea\",\n        placeholder: t('Write a description for your query'),\n        value: this.state.description,\n        onChange: this.onDescriptionChange }))),\n\n\n\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 12 },\n      ___EmotionJSX(Form, {\n        schema: getJSONSchema(),\n        uiSchema: getUISchema(),\n        onSubmit: this.onSchedule,\n        validate: getValidator() }))),\n\n\n\n      this.props.scheduleQueryWarning &&\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 12 },\n      ___EmotionJSX(\"small\", null, this.props.scheduleQueryWarning)))));\n\n\n\n\n\n  }\n  render() {\n    return (\n      ___EmotionJSX(\"span\", { className: \"ScheduleQueryButton\" },\n      ___EmotionJSX(ModalTrigger, {\n        ref: _ref => {\n          this.saveModal = _ref;\n        },\n        modalTitle: t('Schedule Query'),\n        modalBody: this.renderModalBody(),\n        triggerNode:\n        ___EmotionJSX(Button, {\n          bsSize: \"small\",\n          className: \"toggleSchedule\",\n          onClick: this.toggleSchedule,\n          disabled: this.props.disabled,\n          tooltip: this.props.tooltip },\n\n        ___EmotionJSX(\"i\", { className: \"fa fa-calendar\" }), \" \", t('Schedule Query')),\n\n\n        bsSize: \"medium\" })));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}ScheduleQueryButton.propTypes = propTypes;\nScheduleQueryButton.defaultProps = defaultProps;const _default =\n\nScheduleQueryButton;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(validators, \"validators\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(getJSONSchema, \"getJSONSchema\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(getUISchema, \"getUISchema\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(getValidationRules, \"getValidationRules\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(getValidator, \"getValidator\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(ScheduleQueryButton, \"ScheduleQueryButton\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ScheduleQueryButton.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}