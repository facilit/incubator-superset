{"ast":null,"code":"import \"core-js/modules/es.number.to-fixed\";import \"core-js/modules/es.regexp.to-string\";import \"core-js/modules/es.string.split\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _reverseInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reverse\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryTable.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Table } from 'reactable-arc';\nimport { Label, ProgressBar, Well } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport Link from '../../components/Link';\nimport ResultSet from './ResultSet';\nimport ModalTrigger from '../../components/ModalTrigger';\nimport HighlightedSql from './HighlightedSql';\nimport { fDuration } from '../../modules/dates';\nimport { storeQuery } from '../../utils/common';\nimport QueryStateLabel from './QueryStateLabel';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  columns: PropTypes.array,\n  actions: PropTypes.object,\n  queries: PropTypes.array,\n  onUserClicked: PropTypes.func,\n  onDbClicked: PropTypes.func,\n  displayLimit: PropTypes.number.isRequired };\n\nconst defaultProps = {\n  columns: ['started', 'duration', 'rows'],\n  queries: [],\n  onUserClicked: () => {},\n  onDbClicked: () => {} };\n\n\nclass QueryTable extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const uri = window.location.toString();\n    const cleanUri = uri.substring(0, _indexOfInstanceProperty(uri).call(uri, '#'));\n    this.state = {\n      cleanUri,\n      showVisualizeModal: false,\n      activeQuery: null };\n\n  }\n  callback(url) {\n    window.open(url);\n  }\n  openQuery(dbId, schema, sql) {\n    const newQuery = {\n      dbId,\n      title: t('Untitled Query'),\n      schema,\n      sql };\n\n    storeQuery(newQuery).then(url => this.callback(url));\n  }\n  hideVisualizeModal() {\n    this.setState({ showVisualizeModal: false });\n  }\n  showVisualizeModal(query) {\n    this.setState({ activeQuery: query, showVisualizeModal: true });\n  }\n  restoreSql(query) {\n    this.props.actions.queryEditorSetSql({ id: query.sqlEditorId }, query.sql);\n  }\n\n  openQueryInNewTab(query) {\n    this.props.actions.cloneQueryToNewTab(query, true);\n  }\n  openAsyncResults(query, displayLimit) {\n    this.props.actions.fetchQueryResults(query, displayLimit);\n  }\n  clearQueryResults(query) {\n    this.props.actions.clearQueryResults(query);\n  }\n  removeQuery(query) {\n    this.props.actions.removeQuery(query);\n  }\n  render() {var _context, _context2;\n    const data = _reverseInstanceProperty(_context = _mapInstanceProperty(_context2 = this.props.queries).call(_context2,\n    query => {var _context3, _context4, _context5, _context10, _context11, _context12;\n      const q = _Object$assign({}, query);\n      if (q.endDttm) {\n        q.duration = fDuration(q.startDttm, q.endDttm);\n      }\n      const time = moment(q.startDttm).format().split('T');\n      q.time =\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 103 }, __self: this },\n      ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 104 }, __self: this },\n      time[0], \" \", ___EmotionJSX(\"br\", { __source: { fileName: _jsxFileName, lineNumber: 105 }, __self: this }), \" \", time[1]));\n\n\n\n      q.user =\n      ___EmotionJSX(\"button\", {\n        className: \"btn btn-link btn-xs\",\n        onClick: _bindInstanceProperty(_context3 = this.props.onUserClicked).call(_context3, this, q.userId), __source: { fileName: _jsxFileName, lineNumber: 110 }, __self: this },\n\n      q.user);\n\n\n      q.db =\n      ___EmotionJSX(\"button\", {\n        className: \"btn btn-link btn-xs\",\n        onClick: _bindInstanceProperty(_context4 = this.props.onDbClicked).call(_context4, this, q.dbId), __source: { fileName: _jsxFileName, lineNumber: 118 }, __self: this },\n\n      q.db);\n\n\n      q.started = moment(q.startDttm).format('HH:mm:ss');\n      q.querylink =\n      ___EmotionJSX(\"div\", { style: { width: '100px' }, __source: { fileName: _jsxFileName, lineNumber: 127 }, __self: this },\n      ___EmotionJSX(\"button\", {\n        className: \"btn btn-link btn-xs\",\n        onClick: _bindInstanceProperty(_context5 = this.openQuery).call(_context5, this, q.dbId, q.schema, q.sql), __source: { fileName: _jsxFileName, lineNumber: 128 }, __self: this },\n\n      ___EmotionJSX(\"i\", { className: \"fa fa-external-link\", __source: { fileName: _jsxFileName, lineNumber: 132 }, __self: this }),\n      t('Open in SQL Editor')));\n\n\n\n      q.sql =\n      ___EmotionJSX(Well, { __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this },\n      ___EmotionJSX(HighlightedSql, {\n        sql: q.sql,\n        rawSql: q.executedSql,\n        shrink: true,\n        maxWidth: 60, __source: { fileName: _jsxFileName, lineNumber: 139 }, __self: this }));\n\n\n\n      if (q.resultsKey) {var _context6, _context7;\n        q.output =\n        ___EmotionJSX(ModalTrigger, {\n          bsSize: \"large\",\n          className: \"ResultsModal\",\n          triggerNode:\n          ___EmotionJSX(Label, { bsStyle: \"info\", style: { cursor: 'pointer' }, __source: { fileName: _jsxFileName, lineNumber: 153 }, __self: this },\n          t('view results')),\n\n\n          modalTitle: t('Data preview'),\n          beforeOpen: _bindInstanceProperty(_context6 = this.openAsyncResults).call(_context6,\n          this,\n          query,\n          this.props.displayLimit),\n\n          onExit: _bindInstanceProperty(_context7 = this.clearQueryResults).call(_context7, this, query),\n          modalBody:\n          ___EmotionJSX(ResultSet, {\n            showSql: true,\n            query: query,\n            actions: this.props.actions,\n            height: 400,\n            displayLimit: this.props.displayLimit, __source: { fileName: _jsxFileName, lineNumber: 165 }, __self: this }), __source: { fileName: _jsxFileName, lineNumber: 149 }, __self: this });\n\n\n\n\n      } else {var _context8, _context9;\n        // if query was run using ctas and force_ctas_schema was set\n        // tempTable will have the schema\n        const schemaUsed =\n        q.ctas && q.tempTable && _includesInstanceProperty(_context8 = q.tempTable).call(_context8, '.') ? '' : q.schema;\n        q.output = _filterInstanceProperty(_context9 = [schemaUsed, q.tempTable]).call(_context9, v => v).join('.');\n      }\n      q.progress =\n      ___EmotionJSX(ProgressBar, {\n        style: { width: '75px' },\n        striped: true,\n        now: q.progress,\n        label: q.progress.toFixed(0) + \"%\", __source: { fileName: _jsxFileName, lineNumber: 183 }, __self: this });\n\n\n      let errorTooltip;\n      if (q.errorMessage) {\n        errorTooltip =\n        ___EmotionJSX(Link, { tooltip: q.errorMessage, __source: { fileName: _jsxFileName, lineNumber: 193 }, __self: this },\n        ___EmotionJSX(\"i\", { className: \"fa fa-exclamation-circle text-danger\", __source: { fileName: _jsxFileName, lineNumber: 194 }, __self: this }));\n\n\n      }\n      q.state =\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 199 }, __self: this },\n      ___EmotionJSX(QueryStateLabel, { query: query, __source: { fileName: _jsxFileName, lineNumber: 200 }, __self: this }),\n      errorTooltip);\n\n\n      q.actions =\n      ___EmotionJSX(\"div\", { style: { width: '75px' }, __source: { fileName: _jsxFileName, lineNumber: 205 }, __self: this },\n      ___EmotionJSX(Link, {\n        className: \"fa fa-pencil m-r-3\",\n        onClick: _bindInstanceProperty(_context10 = this.restoreSql).call(_context10, this, query),\n        tooltip: t(\n        'Overwrite text in the editor with a query on this table'),\n\n        placement: \"top\", __source: { fileName: _jsxFileName, lineNumber: 206 }, __self: this }),\n\n      ___EmotionJSX(Link, {\n        className: \"fa fa-plus-circle m-r-3\",\n        onClick: _bindInstanceProperty(_context11 = this.openQueryInNewTab).call(_context11, this, query),\n        tooltip: t('Run query in a new tab'),\n        placement: \"top\", __source: { fileName: _jsxFileName, lineNumber: 214 }, __self: this }),\n\n      ___EmotionJSX(Link, {\n        className: \"fa fa-trash m-r-3\",\n        tooltip: t('Remove query from log'),\n        onClick: _bindInstanceProperty(_context12 = this.removeQuery).call(_context12, this, query), __source: { fileName: _jsxFileName, lineNumber: 220 }, __self: this }));\n\n\n\n      return q;\n    })).call(_context);\n\n    return (\n      ___EmotionJSX(\"div\", { className: \"QueryTable\", __source: { fileName: _jsxFileName, lineNumber: 231 }, __self: this },\n      ___EmotionJSX(Table, {\n        columns: this.props.columns,\n        className: \"table table-condensed\",\n        data: data,\n        itemsPerPage: 50, __source: { fileName: _jsxFileName, lineNumber: 232 }, __self: this })));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}QueryTable.propTypes = propTypes;\nQueryTable.defaultProps = defaultProps;const _default =\n\nQueryTable;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryTable.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryTable.jsx\");reactHotLoader.register(QueryTable, \"QueryTable\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryTable.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryTable.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryTable.jsx"],"names":["React","PropTypes","moment","Table","Label","ProgressBar","Well","t","Link","ResultSet","ModalTrigger","HighlightedSql","fDuration","storeQuery","QueryStateLabel","propTypes","columns","array","actions","object","queries","onUserClicked","func","onDbClicked","displayLimit","number","isRequired","defaultProps","QueryTable","PureComponent","constructor","props","uri","window","location","toString","cleanUri","substring","state","showVisualizeModal","activeQuery","callback","url","open","openQuery","dbId","schema","sql","newQuery","title","then","hideVisualizeModal","setState","query","restoreSql","queryEditorSetSql","id","sqlEditorId","openQueryInNewTab","cloneQueryToNewTab","openAsyncResults","fetchQueryResults","clearQueryResults","removeQuery","render","data","q","endDttm","duration","startDttm","time","format","split","user","userId","db","started","querylink","width","executedSql","resultsKey","output","cursor","schemaUsed","ctas","tempTable","v","join","progress","toFixed","errorTooltip","errorMessage"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Table } from 'reactable-arc';\nimport { Label, ProgressBar, Well } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport Link from '../../components/Link';\nimport ResultSet from './ResultSet';\nimport ModalTrigger from '../../components/ModalTrigger';\nimport HighlightedSql from './HighlightedSql';\nimport { fDuration } from '../../modules/dates';\nimport { storeQuery } from '../../utils/common';\nimport QueryStateLabel from './QueryStateLabel';\n\nconst propTypes = {\n  columns: PropTypes.array,\n  actions: PropTypes.object,\n  queries: PropTypes.array,\n  onUserClicked: PropTypes.func,\n  onDbClicked: PropTypes.func,\n  displayLimit: PropTypes.number.isRequired,\n};\nconst defaultProps = {\n  columns: ['started', 'duration', 'rows'],\n  queries: [],\n  onUserClicked: () => {},\n  onDbClicked: () => {},\n};\n\nclass QueryTable extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const uri = window.location.toString();\n    const cleanUri = uri.substring(0, uri.indexOf('#'));\n    this.state = {\n      cleanUri,\n      showVisualizeModal: false,\n      activeQuery: null,\n    };\n  }\n  callback(url) {\n    window.open(url);\n  }\n  openQuery(dbId, schema, sql) {\n    const newQuery = {\n      dbId,\n      title: t('Untitled Query'),\n      schema,\n      sql,\n    };\n    storeQuery(newQuery).then(url => this.callback(url));\n  }\n  hideVisualizeModal() {\n    this.setState({ showVisualizeModal: false });\n  }\n  showVisualizeModal(query) {\n    this.setState({ activeQuery: query, showVisualizeModal: true });\n  }\n  restoreSql(query) {\n    this.props.actions.queryEditorSetSql({ id: query.sqlEditorId }, query.sql);\n  }\n\n  openQueryInNewTab(query) {\n    this.props.actions.cloneQueryToNewTab(query, true);\n  }\n  openAsyncResults(query, displayLimit) {\n    this.props.actions.fetchQueryResults(query, displayLimit);\n  }\n  clearQueryResults(query) {\n    this.props.actions.clearQueryResults(query);\n  }\n  removeQuery(query) {\n    this.props.actions.removeQuery(query);\n  }\n  render() {\n    const data = this.props.queries\n      .map(query => {\n        const q = { ...query };\n        if (q.endDttm) {\n          q.duration = fDuration(q.startDttm, q.endDttm);\n        }\n        const time = moment(q.startDttm).format().split('T');\n        q.time = (\n          <div>\n            <span>\n              {time[0]} <br /> {time[1]}\n            </span>\n          </div>\n        );\n        q.user = (\n          <button\n            className=\"btn btn-link btn-xs\"\n            onClick={this.props.onUserClicked.bind(this, q.userId)}\n          >\n            {q.user}\n          </button>\n        );\n        q.db = (\n          <button\n            className=\"btn btn-link btn-xs\"\n            onClick={this.props.onDbClicked.bind(this, q.dbId)}\n          >\n            {q.db}\n          </button>\n        );\n        q.started = moment(q.startDttm).format('HH:mm:ss');\n        q.querylink = (\n          <div style={{ width: '100px' }}>\n            <button\n              className=\"btn btn-link btn-xs\"\n              onClick={this.openQuery.bind(this, q.dbId, q.schema, q.sql)}\n            >\n              <i className=\"fa fa-external-link\" />\n              {t('Open in SQL Editor')}\n            </button>\n          </div>\n        );\n        q.sql = (\n          <Well>\n            <HighlightedSql\n              sql={q.sql}\n              rawSql={q.executedSql}\n              shrink\n              maxWidth={60}\n            />\n          </Well>\n        );\n        if (q.resultsKey) {\n          q.output = (\n            <ModalTrigger\n              bsSize=\"large\"\n              className=\"ResultsModal\"\n              triggerNode={\n                <Label bsStyle=\"info\" style={{ cursor: 'pointer' }}>\n                  {t('view results')}\n                </Label>\n              }\n              modalTitle={t('Data preview')}\n              beforeOpen={this.openAsyncResults.bind(\n                this,\n                query,\n                this.props.displayLimit,\n              )}\n              onExit={this.clearQueryResults.bind(this, query)}\n              modalBody={\n                <ResultSet\n                  showSql\n                  query={query}\n                  actions={this.props.actions}\n                  height={400}\n                  displayLimit={this.props.displayLimit}\n                />\n              }\n            />\n          );\n        } else {\n          // if query was run using ctas and force_ctas_schema was set\n          // tempTable will have the schema\n          const schemaUsed =\n            q.ctas && q.tempTable && q.tempTable.includes('.') ? '' : q.schema;\n          q.output = [schemaUsed, q.tempTable].filter(v => v).join('.');\n        }\n        q.progress = (\n          <ProgressBar\n            style={{ width: '75px' }}\n            striped\n            now={q.progress}\n            label={`${q.progress.toFixed(0)}%`}\n          />\n        );\n        let errorTooltip;\n        if (q.errorMessage) {\n          errorTooltip = (\n            <Link tooltip={q.errorMessage}>\n              <i className=\"fa fa-exclamation-circle text-danger\" />\n            </Link>\n          );\n        }\n        q.state = (\n          <div>\n            <QueryStateLabel query={query} />\n            {errorTooltip}\n          </div>\n        );\n        q.actions = (\n          <div style={{ width: '75px' }}>\n            <Link\n              className=\"fa fa-pencil m-r-3\"\n              onClick={this.restoreSql.bind(this, query)}\n              tooltip={t(\n                'Overwrite text in the editor with a query on this table',\n              )}\n              placement=\"top\"\n            />\n            <Link\n              className=\"fa fa-plus-circle m-r-3\"\n              onClick={this.openQueryInNewTab.bind(this, query)}\n              tooltip={t('Run query in a new tab')}\n              placement=\"top\"\n            />\n            <Link\n              className=\"fa fa-trash m-r-3\"\n              tooltip={t('Remove query from log')}\n              onClick={this.removeQuery.bind(this, query)}\n            />\n          </div>\n        );\n        return q;\n      })\n      .reverse();\n    return (\n      <div className=\"QueryTable\">\n        <Table\n          columns={this.props.columns}\n          className=\"table table-condensed\"\n          data={data}\n          itemsPerPage={50}\n        />\n      </div>\n    );\n  }\n}\nQueryTable.propTypes = propTypes;\nQueryTable.defaultProps = defaultProps;\n\nexport default QueryTable;\n"]},"metadata":{},"sourceType":"module"}