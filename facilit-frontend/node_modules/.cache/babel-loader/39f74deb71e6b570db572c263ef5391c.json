{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _objectWithoutPropertiesLoose from \"@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/AdhocFilterEditPopover.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Button, Popover, Tab, Tabs } from 'react-bootstrap';\n\nimport columnType from '../propTypes/columnType';\nimport adhocMetricType from '../propTypes/adhocMetricType';\nimport AdhocFilter, { EXPRESSION_TYPES } from '../AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from './AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from './AdhocFilterEditPopoverSqlTabContent';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n  PropTypes.oneOfType([\n  columnType,\n  PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n  adhocMetricType])).\n\n  isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string };\n\n\nconst startingWidth = 300;\nconst startingHeight = 190;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6;\n    super(props);\n    this.onSave = _bindInstanceProperty(_context = this.onSave).call(_context, this);\n    this.onDragDown = _bindInstanceProperty(_context2 = this.onDragDown).call(_context2, this);\n    this.onMouseMove = _bindInstanceProperty(_context3 = this.onMouseMove).call(_context3, this);\n    this.onMouseUp = _bindInstanceProperty(_context4 = this.onMouseUp).call(_context4, this);\n    this.onAdhocFilterChange = _bindInstanceProperty(_context5 = this.onAdhocFilterChange).call(_context5, this);\n    this.adjustHeight = _bindInstanceProperty(_context6 = this.adjustHeight).call(_context6, this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: startingWidth,\n      height: startingHeight };\n\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n      this.dragStartWidth + (e.clientX - this.dragStartX),\n      startingWidth),\n\n      height: Math.max(\n      this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n      startingHeight) });\n\n\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const _this$props =\n\n\n\n\n\n\n\n\n    this.props,{ adhocFilter: propsAdhocFilter, options, datasource, partitionColumn } = _this$props,popoverProps = _objectWithoutPropertiesLoose(_this$props, [\"adhocFilter\", \"options\", \"onChange\", \"onClose\", \"onResize\", \"datasource\", \"partitionColumn\"]);\n\n    const { adhocFilter } = this.state;\n\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      ___EmotionJSX(Popover, _extends({ id: \"filter-edit-popover\" }, popoverProps, { __source: { fileName: _jsxFileName, lineNumber: 131 }, __self: this }),\n      ___EmotionJSX(Tabs, {\n        id: \"adhoc-filter-edit-tabs\",\n        defaultActiveKey: adhocFilter.expressionType,\n        className: \"adhoc-filter-edit-tabs\",\n        style: { height: this.state.height, width: this.state.width }, __source: { fileName: _jsxFileName, lineNumber: 132 }, __self: this },\n\n      ___EmotionJSX(Tab, {\n        className: \"adhoc-filter-edit-tab\",\n        eventKey: EXPRESSION_TYPES.SIMPLE,\n        title: \"Simple\", __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this },\n\n      ___EmotionJSX(AdhocFilterEditPopoverSimpleTabContent, {\n        adhocFilter: this.state.adhocFilter,\n        onChange: this.onAdhocFilterChange,\n        options: options,\n        datasource: datasource,\n        onHeightChange: this.adjustHeight,\n        partitionColumn: partitionColumn, __source: { fileName: _jsxFileName, lineNumber: 143 }, __self: this })),\n\n\n      ___EmotionJSX(Tab, {\n        className: \"adhoc-filter-edit-tab\",\n        eventKey: EXPRESSION_TYPES.SQL,\n        title: \"Custom SQL\", __source: { fileName: _jsxFileName, lineNumber: 152 }, __self: this },\n\n      !this.props.datasource ||\n      this.props.datasource.type !== 'druid' ?\n      ___EmotionJSX(AdhocFilterEditPopoverSqlTabContent, {\n        adhocFilter: this.state.adhocFilter,\n        onChange: this.onAdhocFilterChange,\n        options: this.props.options,\n        height: this.state.height, __source: { fileName: _jsxFileName, lineNumber: 159 }, __self: this }) :\n\n\n      ___EmotionJSX(\"div\", { className: \"custom-sql-disabled-message\", __source: { fileName: _jsxFileName, lineNumber: 166 }, __self: this }, \"Custom SQL Filters are not available on druid datasources\"))),\n\n\n\n\n\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 172 }, __self: this },\n      ___EmotionJSX(Button, {\n        disabled: !stateIsValid,\n        bsStyle: hasUnsavedChanges && stateIsValid ? 'primary' : 'default',\n        bsSize: \"small\",\n        className: \"m-r-5\",\n        onClick: this.onSave, __source: { fileName: _jsxFileName, lineNumber: 173 }, __self: this }, \"Save\"),\n\n\n\n      ___EmotionJSX(Button, { bsSize: \"small\", onClick: this.props.onClose, __source: { fileName: _jsxFileName, lineNumber: 182 }, __self: this }, \"Close\"),\n\n\n      ___EmotionJSX(\"i\", {\n        onMouseDown: this.onDragDown,\n        className: \"fa fa-expand edit-popover-resize text-muted\", __source: { fileName: _jsxFileName, lineNumber: 185 }, __self: this }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}AdhocFilterEditPopover.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/AdhocFilterEditPopover.jsx\");reactHotLoader.register(startingWidth, \"startingWidth\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/AdhocFilterEditPopover.jsx\");reactHotLoader.register(startingHeight, \"startingHeight\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/AdhocFilterEditPopover.jsx\");reactHotLoader.register(AdhocFilterEditPopover, \"AdhocFilterEditPopover\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/AdhocFilterEditPopover.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/AdhocFilterEditPopover.jsx"],"names":["React","PropTypes","Button","Popover","Tab","Tabs","columnType","adhocMetricType","AdhocFilter","EXPRESSION_TYPES","AdhocFilterEditPopoverSimpleTabContent","AdhocFilterEditPopoverSqlTabContent","propTypes","adhocFilter","instanceOf","isRequired","onChange","func","onClose","onResize","options","arrayOf","oneOfType","shape","saved_metric_name","string","datasource","object","partitionColumn","startingWidth","startingHeight","AdhocFilterEditPopover","Component","constructor","props","onSave","onDragDown","onMouseMove","onMouseUp","onAdhocFilterChange","adjustHeight","state","width","height","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","setState","e","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","Math","max","heightDifference","render","propsAdhocFilter","popoverProps","stateIsValid","isValid","hasUnsavedChanges","equals","expressionType","SIMPLE","SQL","type"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Button, Popover, Tab, Tabs } from 'react-bootstrap';\n\nimport columnType from '../propTypes/columnType';\nimport adhocMetricType from '../propTypes/adhocMetricType';\nimport AdhocFilter, { EXPRESSION_TYPES } from '../AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from './AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from './AdhocFilterEditPopoverSqlTabContent';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n};\n\nconst startingWidth = 300;\nconst startingHeight = 190;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: startingWidth,\n      height: startingHeight,\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        startingWidth,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        startingHeight,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      <Popover id=\"filter-edit-popover\" {...popoverProps}>\n        <Tabs\n          id=\"adhoc-filter-edit-tabs\"\n          defaultActiveKey={adhocFilter.expressionType}\n          className=\"adhoc-filter-edit-tabs\"\n          style={{ height: this.state.height, width: this.state.width }}\n        >\n          <Tab\n            className=\"adhoc-filter-edit-tab\"\n            eventKey={EXPRESSION_TYPES.SIMPLE}\n            title=\"Simple\"\n          >\n            <AdhocFilterEditPopoverSimpleTabContent\n              adhocFilter={this.state.adhocFilter}\n              onChange={this.onAdhocFilterChange}\n              options={options}\n              datasource={datasource}\n              onHeightChange={this.adjustHeight}\n              partitionColumn={partitionColumn}\n            />\n          </Tab>\n          <Tab\n            className=\"adhoc-filter-edit-tab\"\n            eventKey={EXPRESSION_TYPES.SQL}\n            title=\"Custom SQL\"\n          >\n            {!this.props.datasource ||\n            this.props.datasource.type !== 'druid' ? (\n              <AdhocFilterEditPopoverSqlTabContent\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={this.props.options}\n                height={this.state.height}\n              />\n            ) : (\n              <div className=\"custom-sql-disabled-message\">\n                Custom SQL Filters are not available on druid datasources\n              </div>\n            )}\n          </Tab>\n        </Tabs>\n        <div>\n          <Button\n            disabled={!stateIsValid}\n            bsStyle={hasUnsavedChanges && stateIsValid ? 'primary' : 'default'}\n            bsSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n          >\n            Save\n          </Button>\n          <Button bsSize=\"small\" onClick={this.props.onClose}>\n            Close\n          </Button>\n          <i\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </Popover>\n    );\n  }\n}\nAdhocFilterEditPopover.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}