{"ast":null,"code":"import \"core-js/modules/es.symbol.description\";import \"core-js/modules/es.promise\";import \"core-js/modules/es.string.replace\";import \"core-js/modules/web.dom-collections.iterator\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/PropertiesModal.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Button, Modal, Row, Col, FormControl, FormGroup } from 'react-bootstrap';\n// @ts-ignore\nimport Dialog from 'react-bootstrap-dialog';\nimport { AsyncSelect } from 'src/components/Select';\nimport rison from 'rison';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient } from '@superset-ui/connection';\nimport getClientErrorObject from '../../utils/getClientErrorObject';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nexport default function PropertiesModalWrapper({ show, onHide, animation, slice, onSave }) {\n  // The wrapper is a separate component so that hooks only run when the modal opens\n  return ___EmotionJSX(Modal, { show: show, onHide: onHide, animation: animation, bsSize: \"large\", __source: { fileName: _jsxFileName, lineNumber: 30 }, __self: this },\n  ___EmotionJSX(PropertiesModal, { slice: slice, onHide: onHide, onSave: onSave, __source: { fileName: _jsxFileName, lineNumber: 31 }, __self: this }));\n\n}\nfunction PropertiesModal({ slice, onHide, onSave }) {\n  const [submitting, setSubmitting] = useState(false);\n  const errorDialog = useRef(null);\n  // values of form inputs\n  const [name, setName] = useState(slice.slice_name || '');\n  const [description, setDescription] = useState(slice.description || '');\n  const [cacheTimeout, setCacheTimeout] = useState(slice.cache_timeout != null ? slice.cache_timeout : '');\n  const [owners, setOwners] = useState(null);\n  function showError({ error, statusText }) {\n    errorDialog.current.show({\n      title: 'Error',\n      bsSize: 'medium',\n      bsStyle: 'danger',\n      actions: [Dialog.DefaultAction('Ok', () => {}, 'btn-danger')],\n      body: error || statusText || t('An error has occurred') });\n\n  }\n  async function fetchChartData() {\n    try {var _context;\n      const response = await SupersetClient.get({\n        endpoint: \"/api/v1/chart/\" + slice.slice_id });\n\n      const chart = response.json.result;\n      setOwners(_mapInstanceProperty(_context = chart.owners).call(_context, owner => ({\n        value: owner.id,\n        label: owner.first_name + \" \" + owner.last_name })));\n\n    }\n    catch (response) {\n      const clientError = await getClientErrorObject(response);\n      showError(clientError);\n    }\n  }\n  // get the owners of this slice\n  useEffect(() => {\n    fetchChartData();\n  }, []);\n  const loadOptions = (input = '') => {\n    const query = rison.encode({\n      filter: input });\n\n    return SupersetClient.get({\n      endpoint: \"/api/v1/chart/related/owners?q=\" + query }).\n    then(response => {\n      const { result } = response.json;\n      return _mapInstanceProperty(result).call(result, item => ({\n        value: item.value,\n        label: item.text }));\n\n    }, badResponse => {\n      getClientErrorObject(badResponse).then(showError);\n      return [];\n    });\n  };\n  const onSubmit = async event => {\n    event.stopPropagation();\n    event.preventDefault();\n    setSubmitting(true);\n    const payload = {\n      slice_name: name || null,\n      description: description || null,\n      cache_timeout: cacheTimeout || null };\n\n    if (owners) {\n      payload.owners = _mapInstanceProperty(owners).call(owners, o => o.value);\n    }\n    try {\n      const res = await SupersetClient.put({\n        endpoint: \"/api/v1/chart/\" + slice.slice_id,\n        headers: { 'Content-Type': 'application/json' },\n        body: _JSON$stringify(payload) });\n\n      // update the redux state\n      const updatedChart = _Object$assign({},\n      res.json.result, {\n        id: slice.slice_id });\n\n      onSave(updatedChart);\n      onHide();\n    }\n    catch (res) {\n      const clientError = await getClientErrorObject(res);\n      showError(clientError);\n    }\n    setSubmitting(false);\n  };\n  return ___EmotionJSX(\"form\", { onSubmit: onSubmit, __source: { fileName: _jsxFileName, lineNumber: 120 }, __self: this },\n  ___EmotionJSX(Modal.Header, { closeButton: true, __source: { fileName: _jsxFileName, lineNumber: 121 }, __self: this },\n  ___EmotionJSX(Modal.Title, { __source: { fileName: _jsxFileName, lineNumber: 122 }, __self: this }, \"Edit Chart Properties\")),\n\n  ___EmotionJSX(Modal.Body, { __source: { fileName: _jsxFileName, lineNumber: 124 }, __self: this },\n  ___EmotionJSX(Row, { __source: { fileName: _jsxFileName, lineNumber: 125 }, __self: this },\n  ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 126 }, __self: this },\n  ___EmotionJSX(\"h3\", { __source: { fileName: _jsxFileName, lineNumber: 127 }, __self: this }, t('Basic Information')),\n  ___EmotionJSX(FormGroup, { __source: { fileName: _jsxFileName, lineNumber: 128 }, __self: this },\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"name\", __source: { fileName: _jsxFileName, lineNumber: 129 }, __self: this },\n  t('Name')),\n\n  ___EmotionJSX(FormControl, { name: \"name\", type: \"text\", bsSize: \"sm\", value: name\n    // @ts-ignore\n    , onChange: event => setName(event.target.value), __source: { fileName: _jsxFileName, lineNumber: 132 }, __self: this })),\n\n  ___EmotionJSX(FormGroup, { __source: { fileName: _jsxFileName, lineNumber: 136 }, __self: this },\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"description\", __source: { fileName: _jsxFileName, lineNumber: 137 }, __self: this },\n  t('Description')),\n\n  ___EmotionJSX(FormControl, { name: \"description\", type: \"text\", componentClass: \"textarea\", bsSize: \"sm\", value: description\n    // @ts-ignore\n    , onChange: event => setDescription(event.target.value), style: { maxWidth: '100%' }, __source: { fileName: _jsxFileName, lineNumber: 140 }, __self: this }),\n  ___EmotionJSX(\"p\", { className: \"help-block\", __source: { fileName: _jsxFileName, lineNumber: 143 }, __self: this },\n  t('The description can be displayed as widget headers in the dashboard view. Supports markdown.')))),\n\n\n\n  ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 148 }, __self: this },\n  ___EmotionJSX(\"h3\", { __source: { fileName: _jsxFileName, lineNumber: 149 }, __self: this }, t('Configuration')),\n  ___EmotionJSX(FormGroup, { __source: { fileName: _jsxFileName, lineNumber: 150 }, __self: this },\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"cacheTimeout\", __source: { fileName: _jsxFileName, lineNumber: 151 }, __self: this },\n  t('Cache Timeout')),\n\n  ___EmotionJSX(FormControl, { name: \"cacheTimeout\", type: \"text\", bsSize: \"sm\", value: cacheTimeout\n    // @ts-ignore\n    , onChange: event => setCacheTimeout(event.target.value.replace(/[^0-9]/, '')), __source: { fileName: _jsxFileName, lineNumber: 154 }, __self: this }),\n  ___EmotionJSX(\"p\", { className: \"help-block\", __source: { fileName: _jsxFileName, lineNumber: 157 }, __self: this },\n  t('Duration (in seconds) of the caching timeout for this chart. Note this defaults to the datasource/table timeout if undefined.'))),\n\n\n  ___EmotionJSX(\"h3\", { style: { marginTop: '1em' }, __source: { fileName: _jsxFileName, lineNumber: 161 }, __self: this }, t('Access')),\n  ___EmotionJSX(FormGroup, { __source: { fileName: _jsxFileName, lineNumber: 162 }, __self: this },\n  ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"owners\", __source: { fileName: _jsxFileName, lineNumber: 163 }, __self: this },\n  t('Owners')),\n\n  ___EmotionJSX(AsyncSelect, { isMulti: true, name: \"owners\", value: owners || [], loadOptions: loadOptions, defaultOptions: true // load options on render\n    , cacheOptions: true, onChange: setOwners, disabled: !owners, filterOption: null // options are filtered at the api\n    , __source: { fileName: _jsxFileName, lineNumber: 166 }, __self: this }),\n  ___EmotionJSX(\"p\", { className: \"help-block\", __source: { fileName: _jsxFileName, lineNumber: 169 }, __self: this },\n  t('A list of users who can alter the chart. Searchable by name or username.')))))),\n\n\n\n\n\n  ___EmotionJSX(Modal.Footer, { __source: { fileName: _jsxFileName, lineNumber: 176 }, __self: this },\n  ___EmotionJSX(Button, { type: \"submit\", bsSize: \"sm\", bsStyle: \"primary\", className: \"m-r-5\", disabled: !owners || submitting, __source: { fileName: _jsxFileName, lineNumber: 177 }, __self: this },\n  t('Save')),\n\n  ___EmotionJSX(Button, { type: \"button\", bsSize: \"sm\", onClick: onHide, __source: { fileName: _jsxFileName, lineNumber: 180 }, __self: this },\n  t('Cancel')),\n\n  ___EmotionJSX(Dialog, { ref: errorDialog, __source: { fileName: _jsxFileName, lineNumber: 183 }, __self: this })));\n\n\n}__signature__(PropertiesModal, \"useState{[submitting, setSubmitting](false)}\\nuseRef{errorDialog}\\nuseState{[name, setName](slice.slice_name || '')}\\nuseState{[description, setDescription](slice.description || '')}\\nuseState{[cacheTimeout, setCacheTimeout](slice.cache_timeout != null ? slice.cache_timeout : '')}\\nuseState{[owners, setOwners](null)}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(PropertiesModalWrapper, \"PropertiesModalWrapper\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/PropertiesModal.tsx\");reactHotLoader.register(PropertiesModal, \"PropertiesModal\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/PropertiesModal.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/PropertiesModal.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useRef } from 'react';\nimport {\n  Button,\n  Modal,\n  Row,\n  Col,\n  FormControl,\n  FormGroup,\n  // @ts-ignore\n} from 'react-bootstrap';\n// @ts-ignore\nimport Dialog from 'react-bootstrap-dialog';\nimport { OptionsType } from 'react-select/src/types';\nimport { AsyncSelect } from 'src/components/Select';\nimport rison from 'rison';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient, Json } from '@superset-ui/connection';\nimport Chart from 'src/types/Chart';\nimport getClientErrorObject from '../../utils/getClientErrorObject';\n\nexport type Slice = {\n  slice_id: number;\n  slice_name: string;\n  description: string | null;\n  cache_timeout: number | null;\n};\n\ntype InternalProps = {\n  slice: Slice;\n  onHide: () => void;\n  onSave: (chart: Chart) => void;\n};\n\ntype OwnerOption = {\n  label: string;\n  value: number;\n};\n\nexport type WrapperProps = InternalProps & {\n  show: boolean;\n  animation?: boolean; // for the modal\n};\n\nexport default function PropertiesModalWrapper({\n  show,\n  onHide,\n  animation,\n  slice,\n  onSave,\n}: WrapperProps) {\n  // The wrapper is a separate component so that hooks only run when the modal opens\n  return (\n    <Modal show={show} onHide={onHide} animation={animation} bsSize=\"large\">\n      <PropertiesModal slice={slice} onHide={onHide} onSave={onSave} />\n    </Modal>\n  );\n}\n\nfunction PropertiesModal({ slice, onHide, onSave }: InternalProps) {\n  const [submitting, setSubmitting] = useState(false);\n  const errorDialog = useRef<any>(null);\n\n  // values of form inputs\n  const [name, setName] = useState(slice.slice_name || '');\n  const [description, setDescription] = useState(slice.description || '');\n  const [cacheTimeout, setCacheTimeout] = useState(\n    slice.cache_timeout != null ? slice.cache_timeout : '',\n  );\n  const [owners, setOwners] = useState<OptionsType<OwnerOption> | null>(null);\n\n  function showError({ error, statusText }: any) {\n    errorDialog.current.show({\n      title: 'Error',\n      bsSize: 'medium',\n      bsStyle: 'danger',\n      actions: [Dialog.DefaultAction('Ok', () => {}, 'btn-danger')],\n      body: error || statusText || t('An error has occurred'),\n    });\n  }\n\n  async function fetchChartData() {\n    try {\n      const response = await SupersetClient.get({\n        endpoint: `/api/v1/chart/${slice.slice_id}`,\n      });\n      const chart = (response.json as Json).result;\n      setOwners(\n        chart.owners.map((owner: any) => ({\n          value: owner.id,\n          label: `${owner.first_name} ${owner.last_name}`,\n        })),\n      );\n    } catch (response) {\n      const clientError = await getClientErrorObject(response);\n      showError(clientError);\n    }\n  }\n\n  // get the owners of this slice\n  useEffect(() => {\n    fetchChartData();\n  }, []);\n\n  const loadOptions = (input = '') => {\n    const query = rison.encode({\n      filter: input,\n    });\n    return SupersetClient.get({\n      endpoint: `/api/v1/chart/related/owners?q=${query}`,\n    }).then(\n      response => {\n        const { result } = response.json as Json;\n        return result.map((item: any) => ({\n          value: item.value,\n          label: item.text,\n        }));\n      },\n      badResponse => {\n        getClientErrorObject(badResponse).then(showError);\n        return [];\n      },\n    );\n  };\n\n  const onSubmit = async (event: React.FormEvent) => {\n    event.stopPropagation();\n    event.preventDefault();\n    setSubmitting(true);\n    const payload: { [key: string]: any } = {\n      slice_name: name || null,\n      description: description || null,\n      cache_timeout: cacheTimeout || null,\n    };\n    if (owners) {\n      payload.owners = owners.map(o => o.value);\n    }\n    try {\n      const res = await SupersetClient.put({\n        endpoint: `/api/v1/chart/${slice.slice_id}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      // update the redux state\n      const updatedChart = {\n        ...(res.json as Json).result,\n        id: slice.slice_id,\n      };\n      onSave(updatedChart);\n      onHide();\n    } catch (res) {\n      const clientError = await getClientErrorObject(res);\n      showError(clientError);\n    }\n    setSubmitting(false);\n  };\n\n  return (\n    <form onSubmit={onSubmit}>\n      <Modal.Header closeButton>\n        <Modal.Title>Edit Chart Properties</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Row>\n          <Col md={6}>\n            <h3>{t('Basic Information')}</h3>\n            <FormGroup>\n              <label className=\"control-label\" htmlFor=\"name\">\n                {t('Name')}\n              </label>\n              <FormControl\n                name=\"name\"\n                type=\"text\"\n                bsSize=\"sm\"\n                value={name}\n                // @ts-ignore\n                onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n                  setName(event.target.value)\n                }\n              />\n            </FormGroup>\n            <FormGroup>\n              <label className=\"control-label\" htmlFor=\"description\">\n                {t('Description')}\n              </label>\n              <FormControl\n                name=\"description\"\n                type=\"text\"\n                componentClass=\"textarea\"\n                bsSize=\"sm\"\n                value={description}\n                // @ts-ignore\n                onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n                  setDescription(event.target.value)\n                }\n                style={{ maxWidth: '100%' }}\n              />\n              <p className=\"help-block\">\n                {t(\n                  'The description can be displayed as widget headers in the dashboard view. Supports markdown.',\n                )}\n              </p>\n            </FormGroup>\n          </Col>\n          <Col md={6}>\n            <h3>{t('Configuration')}</h3>\n            <FormGroup>\n              <label className=\"control-label\" htmlFor=\"cacheTimeout\">\n                {t('Cache Timeout')}\n              </label>\n              <FormControl\n                name=\"cacheTimeout\"\n                type=\"text\"\n                bsSize=\"sm\"\n                value={cacheTimeout}\n                // @ts-ignore\n                onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n                  setCacheTimeout(event.target.value.replace(/[^0-9]/, ''))\n                }\n              />\n              <p className=\"help-block\">\n                {t(\n                  'Duration (in seconds) of the caching timeout for this chart. Note this defaults to the datasource/table timeout if undefined.',\n                )}\n              </p>\n            </FormGroup>\n            <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n            <FormGroup>\n              <label className=\"control-label\" htmlFor=\"owners\">\n                {t('Owners')}\n              </label>\n              <AsyncSelect\n                isMulti\n                name=\"owners\"\n                value={owners || []}\n                loadOptions={loadOptions}\n                defaultOptions // load options on render\n                cacheOptions\n                onChange={setOwners}\n                disabled={!owners}\n                filterOption={null} // options are filtered at the api\n              />\n              <p className=\"help-block\">\n                {t(\n                  'A list of users who can alter the chart. Searchable by name or username.',\n                )}\n              </p>\n            </FormGroup>\n          </Col>\n        </Row>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button\n          type=\"submit\"\n          bsSize=\"sm\"\n          bsStyle=\"primary\"\n          className=\"m-r-5\"\n          disabled={!owners || submitting}\n        >\n          {t('Save')}\n        </Button>\n        <Button type=\"button\" bsSize=\"sm\" onClick={onHide}>\n          {t('Cancel')}\n        </Button>\n        <Dialog ref={errorDialog} />\n      </Modal.Footer>\n    </form>\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}