{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator\";import _sortInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/sort\";import _valuesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/values\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _reduceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reduce\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _isNil from \"lodash/isNil\";import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\n\nimport FilterIndicator from './FilterIndicator';\nimport FilterIndicatorGroup from './FilterIndicatorGroup';\nimport { FILTER_INDICATORS_DISPLAY_LENGTH } from '../util/constants';\nimport { getChartIdsInFilterScope } from '../util/activeDashboardFilters';\nimport { getDashboardFilterKey } from '../util/getDashboardFilterKey';\nimport { getFilterColorMap } from '../util/dashboardFiltersColorMap';\nimport { TIME_FILTER_MAP } from '../../visualizations/FilterBox/FilterBox';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  // from props\n  dashboardFilters: PropTypes.object.isRequired,\n  chartId: PropTypes.number.isRequired,\n  chartStatus: PropTypes.string,\n\n  // from redux\n  datasources: PropTypes.object.isRequired,\n  setDirectPathToChild: PropTypes.func.isRequired,\n  filterFieldOnFocus: PropTypes.object.isRequired };\n\n\nconst defaultProps = {\n  chartStatus: 'loading' };\n\n\nconst TIME_GRANULARITY_FIELDS = [\nTIME_FILTER_MAP.granularity,\nTIME_FILTER_MAP.time_grain_sqla];\n\n\nfunction sortByIndicatorLabel(indicator1, indicator2) {\n  const s1 = (indicator1.label || indicator1.name).toLowerCase();\n  const s2 = (indicator2.label || indicator2.name).toLowerCase();\n  if (s1 < s2) {\n    return -1;\n  } else if (s1 > s2) {\n    return 1;\n  }\n  return 0;\n}\n\nexport default class FilterIndicatorsContainer extends React.PureComponent {\n  getFilterIndicators() {var _context, _context7, _context8;\n    const {\n      datasources = {},\n      dashboardFilters,\n      chartId: currentChartId,\n      filterFieldOnFocus } =\n    this.props;\n\n    if (_Object$keys(dashboardFilters).length === 0) {\n      return [];\n    }\n\n    const dashboardFiltersColorMap = getFilterColorMap();\n    const sortIndicatorsByEmptiness = _reduceInstanceProperty(_context = _Object$values(dashboardFilters)).call(_context,\n    (indicators, dashboardFilter) => {\n      const {\n        chartId,\n        componentId,\n        datasourceId,\n        directPathToFilter,\n        isDateFilter,\n        isInstantFilter,\n        columns,\n        labels,\n        scopes } =\n      dashboardFilter;\n      const datasource = datasources[datasourceId] || {};\n\n      if (currentChartId !== chartId) {var _context2, _context3;\n        _forEachInstanceProperty(_context2 = _filterInstanceProperty(_context3 = _Object$keys(columns)).call(_context3,\n        name => {var _context4;return (\n            _includesInstanceProperty(_context4 = getChartIdsInFilterScope({ filterScope: scopes[name] })).call(_context4,\n            currentChartId));})).call(_context2,\n\n\n        name => {var _context5;\n          const colorMapKey = getDashboardFilterKey({\n            chartId,\n            column: name });\n\n\n          // filter values could be single value or array of values\n          const values =\n          _isNil(columns[name]) ||\n          isDateFilter && columns[name] === 'No filter' ||\n          _Array$isArray(columns[name]) && columns[name].length === 0 ?\n          [] :\n          _concatInstanceProperty(_context5 = []).call(_context5, columns[name]);\n\n          const indicator = {\n            chartId,\n            colorCode: dashboardFiltersColorMap[colorMapKey],\n            componentId,\n            directPathToFilter: _concatInstanceProperty(directPathToFilter).call(directPathToFilter, \"LABEL-\" + name),\n            isDateFilter,\n            isInstantFilter,\n            name,\n            label: labels[name] || name,\n            values,\n            isFilterFieldActive:\n            chartId === filterFieldOnFocus.chartId &&\n            name === filterFieldOnFocus.column };\n\n\n          // map time granularity value to datasource configure\n          if (isDateFilter && _includesInstanceProperty(TIME_GRANULARITY_FIELDS).call(TIME_GRANULARITY_FIELDS, name)) {var _context6;\n            const timeGranularityConfig =\n            (name === TIME_FILTER_MAP.time_grain_sqla ?\n            datasource.time_grain_sqla :\n            datasource.granularity) || [];\n            const timeGranularityDisplayMapping = _reduceInstanceProperty(timeGranularityConfig).call(timeGranularityConfig,\n            (map, [key, value]) => _Object$assign({},\n            map, {\n              [key]: value }),\n\n            {});\n\n\n            indicator.values = _mapInstanceProperty(_context6 = _valuesInstanceProperty(indicator)).call(_context6,\n            value => timeGranularityDisplayMapping[value] || value);\n\n          }\n\n          if (_isEmpty(_valuesInstanceProperty(indicator))) {\n            indicators[1].push(indicator);\n          } else {\n            indicators[0].push(indicator);\n          }\n        });\n      }\n\n      return indicators;\n    },\n    [[], []]);\n\n\n    // cypress' electron don't support [].flat():\n    return [\n    ..._sortInstanceProperty(_context7 = sortIndicatorsByEmptiness[0]).call(_context7, sortByIndicatorLabel),\n    ..._sortInstanceProperty(_context8 = sortIndicatorsByEmptiness[1]).call(_context8, sortByIndicatorLabel)];\n\n  }\n\n  render() {\n    const { chartStatus, setDirectPathToChild } = this.props;\n    if (chartStatus === 'loading') {\n      return null;\n    }\n\n    const indicators = this.getFilterIndicators();\n    // if total indicators <= FILTER_INDICATORS_DISPLAY_LENGTH,\n    // show indicator for each filter field.\n    // else: show single group indicator.\n    const showIndicatorsInGroup =\n    indicators.length > FILTER_INDICATORS_DISPLAY_LENGTH;\n\n    return (\n      ___EmotionJSX(\"div\", { className: \"dashboard-filter-indicators-container\" },\n      !showIndicatorsInGroup &&\n      _mapInstanceProperty(indicators).call(indicators, (indicator) =>\n      ___EmotionJSX(FilterIndicator, {\n        key: indicator.chartId + \"_\" + indicator.name,\n        indicator: indicator,\n        setDirectPathToChild: setDirectPathToChild })),\n\n\n      showIndicatorsInGroup &&\n      ___EmotionJSX(FilterIndicatorGroup, {\n        indicators: indicators,\n        setDirectPathToChild: setDirectPathToChild })));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nFilterIndicatorsContainer.propTypes = propTypes;\nFilterIndicatorsContainer.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/FilterIndicatorsContainer.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/FilterIndicatorsContainer.jsx\");reactHotLoader.register(TIME_GRANULARITY_FIELDS, \"TIME_GRANULARITY_FIELDS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/FilterIndicatorsContainer.jsx\");reactHotLoader.register(sortByIndicatorLabel, \"sortByIndicatorLabel\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/FilterIndicatorsContainer.jsx\");reactHotLoader.register(FilterIndicatorsContainer, \"FilterIndicatorsContainer\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/FilterIndicatorsContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}