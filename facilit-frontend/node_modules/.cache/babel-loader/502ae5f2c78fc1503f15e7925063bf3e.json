{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { SupersetClient } from '@superset-ui/connection';\nimport { DropdownButton, MenuItem } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport CssEditor from './CssEditor';\nimport RefreshIntervalModal from './RefreshIntervalModal';\nimport SaveModal from './SaveModal';\nimport injectCustomCss from '../util/injectCustomCss';\nimport { SAVE_TYPE_NEWDASHBOARD } from '../util/constants';\nimport URLShortLinkModal from '../../components/URLShortLinkModal';\nimport downloadAsImage from '../util/downloadAsImage';\nimport getDashboardUrl from '../util/getDashboardUrl';\nimport { getActiveFilters } from '../util/activeDashboardFilters';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  hasUnsavedChanges: PropTypes.bool.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  onChange: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  forceRefreshAllCharts: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  startPeriodicRender: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  userCanEdit: PropTypes.bool.isRequired,\n  userCanSave: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  onSave: PropTypes.func.isRequired,\n  showPropertiesModal: PropTypes.func.isRequired,\n  refreshLimit: PropTypes.number,\n  refreshWarning: PropTypes.string };\n\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined,\n  refreshLimit: 0,\n  refreshWarning: null };\n\n\nclass HeaderActionsDropdown extends React.PureComponent {\n  static discardChanges() {\n    window.location.reload();\n  }\n\n  constructor(props) {var _context, _context2;\n    super(props);\n    this.state = {\n      css: props.customCss,\n      cssTemplates: [] };\n\n\n    this.changeCss = _bindInstanceProperty(_context = this.changeCss).call(_context, this);\n    this.changeRefreshInterval = _bindInstanceProperty(_context2 = this.changeRefreshInterval).call(_context2, this);\n  }\n\n  UNSAFE_componentWillMount() {\n    injectCustomCss(this.state.css);\n\n    SupersetClient.get({ endpoint: '/csstemplateasyncmodelview/api/read' }).\n    then(({ json }) => {var _context3;\n      const cssTemplates = _mapInstanceProperty(_context3 = json.result).call(_context3, row => ({\n        value: row.template_name,\n        css: row.css,\n        label: row.template_name }));\n\n      this.setState({ cssTemplates });\n    }).\n    catch(() => {\n      this.props.addDangerToast(\n      t('An error occurred while fetching available CSS templates'));\n\n    });\n  }\n\n  changeCss(css) {\n    this.setState({ css }, () => {\n      injectCustomCss(css);\n    });\n    this.props.onChange();\n    this.props.updateCss(css);\n  }\n\n  changeRefreshInterval(refreshInterval, isPersistent) {\n    this.props.setRefreshFrequency(refreshInterval, isPersistent);\n    this.props.startPeriodicRender(refreshInterval * 1000);\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      dashboardId,\n      dashboardInfo,\n      forceRefreshAllCharts,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      editMode,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      hasUnsavedChanges,\n      layout,\n      expandedSlices,\n      onSave,\n      userCanEdit,\n      userCanSave,\n      isLoading,\n      refreshLimit,\n      refreshWarning } =\n    this.props;\n\n    const emailTitle = t('Superset Dashboard');\n    const emailSubject = emailTitle + \" \" + dashboardTitle;\n    const emailBody = t('Check out this dashboard: ');\n\n    return (\n      ___EmotionJSX(DropdownButton, {\n        title: \"\",\n        id: \"save-dash-split-button\",\n        bsStyle: hasUnsavedChanges ? 'primary' : undefined,\n        bsSize: \"small\",\n        pullRight: true },\n\n      userCanSave &&\n      ___EmotionJSX(SaveModal, {\n        addSuccessToast: this.props.addSuccessToast,\n        addDangerToast: this.props.addDangerToast,\n        dashboardId: dashboardId,\n        dashboardTitle: dashboardTitle,\n        dashboardInfo: dashboardInfo,\n        saveType: SAVE_TYPE_NEWDASHBOARD,\n        layout: layout,\n        expandedSlices: expandedSlices,\n        refreshFrequency: refreshFrequency,\n        shouldPersistRefreshFrequency: shouldPersistRefreshFrequency,\n        customCss: customCss,\n        colorNamespace: colorNamespace,\n        colorScheme: colorScheme,\n        onSave: onSave,\n        isMenuItem: true,\n        triggerNode: ___EmotionJSX(\"span\", null, t('Save as')),\n        canOverwrite: userCanEdit }),\n\n\n\n      hasUnsavedChanges && userCanSave &&\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(MenuItem, {\n        eventKey: \"discard\",\n        onSelect: HeaderActionsDropdown.discardChanges },\n\n      t('Discard changes'))),\n\n\n\n\n      userCanSave && ___EmotionJSX(MenuItem, { divider: true }),\n\n      ___EmotionJSX(MenuItem, { onClick: forceRefreshAllCharts, disabled: isLoading },\n      t('Force refresh dashboard')),\n\n\n      ___EmotionJSX(RefreshIntervalModal, {\n        refreshFrequency: refreshFrequency,\n        refreshLimit: refreshLimit,\n        refreshWarning: refreshWarning,\n        onChange: this.changeRefreshInterval,\n        editMode: editMode,\n        triggerNode:\n        ___EmotionJSX(\"span\", null,\n        editMode ?\n        t('Set auto-refresh interval') :\n        t('Auto-refresh dashboard')) }),\n\n\n\n\n      editMode &&\n      ___EmotionJSX(MenuItem, { onClick: this.props.showPropertiesModal },\n      t('Edit dashboard properties')),\n\n\n\n      ___EmotionJSX(URLShortLinkModal, {\n        url: getDashboardUrl(\n        window.location.pathname,\n        getActiveFilters(),\n        window.location.hash),\n\n        emailSubject: emailSubject,\n        emailContent: emailBody,\n        addDangerToast: this.props.addDangerToast,\n        isMenuItem: true,\n        triggerNode: ___EmotionJSX(\"span\", null, t('Share dashboard')) }),\n\n\n      editMode &&\n      ___EmotionJSX(CssEditor, {\n        triggerNode: ___EmotionJSX(\"span\", null, t('Edit CSS')),\n        initialCss: this.state.css,\n        templates: this.state.cssTemplates,\n        onChange: this.changeCss }),\n\n\n\n      !editMode &&\n      ___EmotionJSX(MenuItem, { onClick: downloadAsImage('.dashboard', dashboardTitle) },\n      t('Download as image'))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nHeaderActionsDropdown.propTypes = propTypes;\nHeaderActionsDropdown.defaultProps = defaultProps;const _default =\n\nHeaderActionsDropdown;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");reactHotLoader.register(HeaderActionsDropdown, \"HeaderActionsDropdown\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}