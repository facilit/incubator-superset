{"ast":null,"code":"import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _startsWithInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/starts-with\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/translation';\nimport Button from '../components/Button';\nimport Fieldset from './Fieldset';\nimport { recurseReactClone } from './utils';\nimport './crud.less';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  collection: PropTypes.arrayOf(PropTypes.object).isRequired,\n  itemGenerator: PropTypes.func,\n  columnLabels: PropTypes.object,\n  tableColumns: PropTypes.array.isRequired,\n  onChange: PropTypes.func,\n  itemRenderers: PropTypes.object,\n  allowDeletes: PropTypes.bool,\n  expandFieldset: PropTypes.node,\n  emptyMessage: PropTypes.node,\n  extraButtons: PropTypes.node,\n  allowAddItem: PropTypes.bool };\n\nconst defaultProps = {\n  onChange: () => {},\n  itemRenderers: {},\n  columnLabels: {},\n  allowDeletes: false,\n  emptyMessage: 'No entries',\n  allowAddItem: false,\n  itemGenerator: () => ({}),\n  expandFieldset: null,\n  extraButtons: null };\n\nconst Frame = props => ___EmotionJSX(\"div\", { className: \"frame\", __source: { fileName: _jsxFileName, lineNumber: 52 }, __self: this }, props.children);\nFrame.propTypes = { children: PropTypes.node };\n\nfunction createKeyedCollection(arr) {\n  const newArr = _mapInstanceProperty(arr).call(arr, o => _Object$assign({},\n  o, {\n    id: o.id || shortid.generate() }));\n\n  const map = {};\n  _forEachInstanceProperty(newArr).call(newArr, o => {\n    map[o.id] = o;\n  });\n  return map;\n}\n\nexport default class CRUDCollection extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7;\n    super(props);\n    this.state = {\n      expandedColumns: {},\n      collection: createKeyedCollection(props.collection) };\n\n    this.renderItem = _bindInstanceProperty(_context = this.renderItem).call(_context, this);\n    this.onAddItem = _bindInstanceProperty(_context2 = this.onAddItem).call(_context2, this);\n    this.renderExpandableSection = _bindInstanceProperty(_context3 = this.renderExpandableSection).call(_context3, this);\n    this.getLabel = _bindInstanceProperty(_context4 = this.getLabel).call(_context4, this);\n    this.onFieldsetChange = _bindInstanceProperty(_context5 = this.onFieldsetChange).call(_context5, this);\n    this.renderTableBody = _bindInstanceProperty(_context6 = this.renderTableBody).call(_context6, this);\n    this.changeCollection = _bindInstanceProperty(_context7 = this.changeCollection).call(_context7, this);\n  }\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (nextProps.collection !== this.props.collection) {\n      this.setState({\n        collection: createKeyedCollection(nextProps.collection) });\n\n    }\n  }\n  onCellChange(id, col, val) {\n    this.changeCollection(_Object$assign({},\n    this.state.collection, {\n      [id]: _Object$assign({},\n      this.state.collection[id], {\n        [col]: val }) }));\n\n\n  }\n  onAddItem() {\n    let newItem = this.props.itemGenerator();\n    if (!newItem.id) {\n      newItem = _Object$assign({}, newItem, { id: shortid.generate() });\n    }\n    this.changeCollection(_Object$assign({},\n    this.state.collection, {\n      [newItem.id]: newItem }));\n\n  }\n  onFieldsetChange(item) {\n    this.changeCollection(_Object$assign({},\n    this.state.collection, {\n      [item.id]: item }));\n\n  }\n  getLabel(col) {\n    const { columnLabels } = this.props;\n    let label = columnLabels[col] ? columnLabels[col] : col;\n    if (_startsWithInstanceProperty(label).call(label, '__')) {\n      // special label-free columns (ie: caret for expand, delete cross)\n      label = '';\n    }\n    return label;\n  }\n  changeCollection(collection) {var _context8;\n    this.setState({ collection });\n    this.props.onChange(_mapInstanceProperty(_context8 = _Object$keys(collection)).call(_context8, k => collection[k]));\n  }\n  deleteItem(id) {\n    const newColl = _Object$assign({}, this.state.collection);\n    delete newColl[id];\n    this.changeCollection(newColl);\n  }\n  effectiveTableColumns() {var _context9;\n    const { tableColumns, allowDeletes, expandFieldset } = this.props;\n    const cols = allowDeletes ?\n    _concatInstanceProperty(tableColumns).call(tableColumns, ['__actions']) :\n    tableColumns;\n    return expandFieldset ? _concatInstanceProperty(_context9 = ['__expand']).call(_context9, cols) : cols;\n  }\n  toggleExpand(id) {\n    this.onCellChange(id, '__expanded', false);\n    this.setState({\n      expandedColumns: _Object$assign({},\n      this.state.expandedColumns, {\n        [id]: !this.state.expandedColumns[id] }) });\n\n\n  }\n  renderHeaderRow() {\n    const cols = this.effectiveTableColumns();\n    return (\n      ___EmotionJSX(\"thead\", { __source: { fileName: _jsxFileName, lineNumber: 151 }, __self: this },\n      ___EmotionJSX(\"tr\", { __source: { fileName: _jsxFileName, lineNumber: 152 }, __self: this },\n      this.props.expandFieldset && ___EmotionJSX(\"th\", { className: \"tiny-cell\", __source: { fileName: _jsxFileName, lineNumber: 153 }, __self: this }),\n      _mapInstanceProperty(cols).call(cols, (col) =>\n      ___EmotionJSX(\"th\", { key: col, __source: { fileName: _jsxFileName, lineNumber: 155 }, __self: this }, this.getLabel(col))),\n\n      this.props.allowDeletes && ___EmotionJSX(\"th\", { className: \"tiny-cell\", __source: { fileName: _jsxFileName, lineNumber: 157 }, __self: this }))));\n\n\n\n  }\n  renderExpandableSection(item) {\n    const propsGenerator = () => ({ item, onChange: this.onFieldsetChange });\n    return recurseReactClone(\n    this.props.expandFieldset,\n    Fieldset,\n    propsGenerator);\n\n  }\n  renderCell(record, col) {var _context10;\n    const renderer = this.props.itemRenderers[col];\n    const val = record[col];\n    const onChange = _bindInstanceProperty(_context10 = this.onCellChange).call(_context10, this, record.id, col);\n    return renderer ? renderer(val, onChange, this.getLabel(col)) : val;\n  }\n  renderItem(record) {\n    const { tableColumns, allowDeletes, expandFieldset } = this.props;\n    /* eslint-disable no-underscore-dangle */\n    const isExpanded =\n    !!this.state.expandedColumns[record.id] || record.__expanded;\n    let tds = [];\n    if (expandFieldset) {var _context11;\n      tds.push(\n      ___EmotionJSX(\"td\", { key: \"__expand\", className: \"expand\", __source: { fileName: _jsxFileName, lineNumber: 184 }, __self: this },\n      ___EmotionJSX(\"i\", {\n        className: \"fa fa-caret-\" + (\n        isExpanded ? 'down' : 'right') + \" text-primary pointer\",\n\n        onClick: _bindInstanceProperty(_context11 = this.toggleExpand).call(_context11, this, record.id), __source: { fileName: _jsxFileName, lineNumber: 185 }, __self: this })));\n\n\n\n    }\n    tds = _concatInstanceProperty(tds).call(tds,\n    _mapInstanceProperty(tableColumns).call(tableColumns, (col) =>\n    ___EmotionJSX(\"td\", { key: col, __source: { fileName: _jsxFileName, lineNumber: 196 }, __self: this }, this.renderCell(record, col))));\n\n\n    if (allowDeletes) {var _context12;\n      tds.push(\n      ___EmotionJSX(\"td\", { key: \"__actions\", __source: { fileName: _jsxFileName, lineNumber: 201 }, __self: this },\n      ___EmotionJSX(\"i\", {\n        className: \"fa fa-close text-primary pointer\",\n        onClick: _bindInstanceProperty(_context12 = this.deleteItem).call(_context12, this, record.id), __source: { fileName: _jsxFileName, lineNumber: 202 }, __self: this })));\n\n\n\n    }\n    const trs = [\n    ___EmotionJSX(\"tr\", { className: \"row\", key: record.id, __source: { fileName: _jsxFileName, lineNumber: 210 }, __self: this },\n    tds)];\n\n\n    if (isExpanded) {\n      trs.push(\n      ___EmotionJSX(\"tr\", { className: \"exp\", key: 'exp__' + record.id, __source: { fileName: _jsxFileName, lineNumber: 216 }, __self: this },\n      ___EmotionJSX(\"td\", {\n        colSpan: this.effectiveTableColumns().length,\n        className: \"expanded\", __source: { fileName: _jsxFileName, lineNumber: 217 }, __self: this },\n\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 221 }, __self: this }, this.renderExpandableSection(record)))));\n\n\n\n    }\n    return trs;\n  }\n  renderEmptyCell() {\n    return (\n      ___EmotionJSX(\"tr\", { __source: { fileName: _jsxFileName, lineNumber: 230 }, __self: this },\n      ___EmotionJSX(\"td\", { className: \"empty-collection\", __source: { fileName: _jsxFileName, lineNumber: 231 }, __self: this }, this.props.emptyMessage)));\n\n\n  }\n  renderTableBody() {var _context13;\n    const data = _mapInstanceProperty(_context13 = _Object$keys(this.state.collection)).call(_context13,\n    k => this.state.collection[k]);\n\n    const content = data.length ?\n    _mapInstanceProperty(data).call(data, d => this.renderItem(d)) :\n    this.renderEmptyCell();\n    return ___EmotionJSX(\"tbody\", { __source: { fileName: _jsxFileName, lineNumber: 242 }, __self: this }, content);\n  }\n  render() {\n    return (\n      ___EmotionJSX(\"div\", { className: \"CRUD\", __source: { fileName: _jsxFileName, lineNumber: 246 }, __self: this },\n      ___EmotionJSX(\"table\", { className: \"table\", __source: { fileName: _jsxFileName, lineNumber: 247 }, __self: this },\n      this.renderHeaderRow(),\n      this.renderTableBody()),\n\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 251 }, __self: this },\n      this.props.allowAddItem &&\n      ___EmotionJSX(Button, { bsStyle: \"primary\", onClick: this.onAddItem, __source: { fileName: _jsxFileName, lineNumber: 253 }, __self: this },\n      ___EmotionJSX(\"i\", { className: \"fa fa-plus\", __source: { fileName: _jsxFileName, lineNumber: 254 }, __self: this }), \" \", t('Add Item')),\n\n\n      this.props.extraButtons)));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}CRUDCollection.defaultProps = defaultProps;\nCRUDCollection.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx\");reactHotLoader.register(Frame, \"Frame\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx\");reactHotLoader.register(createKeyedCollection, \"createKeyedCollection\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx\");reactHotLoader.register(CRUDCollection, \"CRUDCollection\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/CRUD/CollectionTable.jsx"],"names":["React","PropTypes","shortid","t","Button","Fieldset","recurseReactClone","propTypes","collection","arrayOf","object","isRequired","itemGenerator","func","columnLabels","tableColumns","array","onChange","itemRenderers","allowDeletes","bool","expandFieldset","node","emptyMessage","extraButtons","allowAddItem","defaultProps","Frame","props","children","createKeyedCollection","arr","newArr","o","id","generate","map","CRUDCollection","PureComponent","constructor","state","expandedColumns","renderItem","onAddItem","renderExpandableSection","getLabel","onFieldsetChange","renderTableBody","changeCollection","UNSAFE_componentWillReceiveProps","nextProps","setState","onCellChange","col","val","newItem","item","label","k","deleteItem","newColl","effectiveTableColumns","cols","toggleExpand","renderHeaderRow","propsGenerator","renderCell","record","renderer","isExpanded","__expanded","tds","push","trs","length","renderEmptyCell","data","content","d","render"],"mappings":"mgCAAA;;;;;;;;;;;;;;;;;;AAkBA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,SAASC,CAAT,QAAkB,0BAAlB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,SAASC,iBAAT,QAAkC,SAAlC;AACA,OAAO,aAAP,C;;AAEA,MAAMC,SAAS,GAAG;AAChBC,EAAAA,UAAU,EAAEP,SAAS,CAACQ,OAAV,CAAkBR,SAAS,CAACS,MAA5B,EAAoCC,UADhC;AAEhBC,EAAAA,aAAa,EAAEX,SAAS,CAACY,IAFT;AAGhBC,EAAAA,YAAY,EAAEb,SAAS,CAACS,MAHR;AAIhBK,EAAAA,YAAY,EAAEd,SAAS,CAACe,KAAV,CAAgBL,UAJd;AAKhBM,EAAAA,QAAQ,EAAEhB,SAAS,CAACY,IALJ;AAMhBK,EAAAA,aAAa,EAAEjB,SAAS,CAACS,MANT;AAOhBS,EAAAA,YAAY,EAAElB,SAAS,CAACmB,IAPR;AAQhBC,EAAAA,cAAc,EAAEpB,SAAS,CAACqB,IARV;AAShBC,EAAAA,YAAY,EAAEtB,SAAS,CAACqB,IATR;AAUhBE,EAAAA,YAAY,EAAEvB,SAAS,CAACqB,IAVR;AAWhBG,EAAAA,YAAY,EAAExB,SAAS,CAACmB,IAXR,EAAlB;;AAaA,MAAMM,YAAY,GAAG;AACnBT,EAAAA,QAAQ,EAAE,MAAM,CAAE,CADC;AAEnBC,EAAAA,aAAa,EAAE,EAFI;AAGnBJ,EAAAA,YAAY,EAAE,EAHK;AAInBK,EAAAA,YAAY,EAAE,KAJK;AAKnBI,EAAAA,YAAY,EAAE,YALK;AAMnBE,EAAAA,YAAY,EAAE,KANK;AAOnBb,EAAAA,aAAa,EAAE,OAAO,EAAP,CAPI;AAQnBS,EAAAA,cAAc,EAAE,IARG;AASnBG,EAAAA,YAAY,EAAE,IATK,EAArB;;AAWA,MAAMG,KAAK,GAAGC,KAAK,IAAI,uBAAK,SAAS,EAAC,OAAf,wEAAwBA,KAAK,CAACC,QAA9B,CAAvB;AACAF,KAAK,CAACpB,SAAN,GAAkB,EAAEsB,QAAQ,EAAE5B,SAAS,CAACqB,IAAtB,EAAlB;;AAEA,SAASQ,qBAAT,CAA+BC,GAA/B,EAAoC;AAClC,QAAMC,MAAM,GAAG,qBAAAD,GAAG,MAAH,CAAAA,GAAG,EAAKE,CAAC;AACnBA,EAAAA,CADmB;AAEtBC,IAAAA,EAAE,EAAED,CAAC,CAACC,EAAF,IAAQhC,OAAO,CAACiC,QAAR,EAFU,GAAN,CAAlB;;AAIA,QAAMC,GAAG,GAAG,EAAZ;AACA,2BAAAJ,MAAM,MAAN,CAAAA,MAAM,EAASC,CAAC,IAAI;AAClBG,IAAAA,GAAG,CAACH,CAAC,CAACC,EAAH,CAAH,GAAYD,CAAZ;AACD,GAFK,CAAN;AAGA,SAAOG,GAAP;AACD;;AAED,eAAe,MAAMC,cAAN,SAA6BrC,KAAK,CAACsC,aAAnC,CAAiD;AAC9DC,EAAAA,WAAW,CAACX,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKY,KAAL,GAAa;AACXC,MAAAA,eAAe,EAAE,EADN;AAEXjC,MAAAA,UAAU,EAAEsB,qBAAqB,CAACF,KAAK,CAACpB,UAAP,CAFtB,EAAb;;AAIA,SAAKkC,UAAL,GAAkB,sCAAKA,UAAL,iBAAqB,IAArB,CAAlB;AACA,SAAKC,SAAL,GAAiB,uCAAKA,SAAL,kBAAoB,IAApB,CAAjB;AACA,SAAKC,uBAAL,GAA+B,uCAAKA,uBAAL,kBAAkC,IAAlC,CAA/B;AACA,SAAKC,QAAL,GAAgB,uCAAKA,QAAL,kBAAmB,IAAnB,CAAhB;AACA,SAAKC,gBAAL,GAAwB,uCAAKA,gBAAL,kBAA2B,IAA3B,CAAxB;AACA,SAAKC,eAAL,GAAuB,uCAAKA,eAAL,kBAA0B,IAA1B,CAAvB;AACA,SAAKC,gBAAL,GAAwB,uCAAKA,gBAAL,kBAA2B,IAA3B,CAAxB;AACD;AACDC,EAAAA,gCAAgC,CAACC,SAAD,EAAY;AAC1C,QAAIA,SAAS,CAAC1C,UAAV,KAAyB,KAAKoB,KAAL,CAAWpB,UAAxC,EAAoD;AAClD,WAAK2C,QAAL,CAAc;AACZ3C,QAAAA,UAAU,EAAEsB,qBAAqB,CAACoB,SAAS,CAAC1C,UAAX,CADrB,EAAd;;AAGD;AACF;AACD4C,EAAAA,YAAY,CAAClB,EAAD,EAAKmB,GAAL,EAAUC,GAAV,EAAe;AACzB,SAAKN,gBAAL;AACK,SAAKR,KAAL,CAAWhC,UADhB;AAEE,OAAC0B,EAAD;AACK,WAAKM,KAAL,CAAWhC,UAAX,CAAsB0B,EAAtB,CADL;AAEE,SAACmB,GAAD,GAAOC,GAFT,GAFF;;;AAOD;AACDX,EAAAA,SAAS,GAAG;AACV,QAAIY,OAAO,GAAG,KAAK3B,KAAL,CAAWhB,aAAX,EAAd;AACA,QAAI,CAAC2C,OAAO,CAACrB,EAAb,EAAiB;AACfqB,MAAAA,OAAO,sBAAQA,OAAR,IAAiBrB,EAAE,EAAEhC,OAAO,CAACiC,QAAR,EAArB,GAAP;AACD;AACD,SAAKa,gBAAL;AACK,SAAKR,KAAL,CAAWhC,UADhB;AAEE,OAAC+C,OAAO,CAACrB,EAAT,GAAcqB,OAFhB;;AAID;AACDT,EAAAA,gBAAgB,CAACU,IAAD,EAAO;AACrB,SAAKR,gBAAL;AACK,SAAKR,KAAL,CAAWhC,UADhB;AAEE,OAACgD,IAAI,CAACtB,EAAN,GAAWsB,IAFb;;AAID;AACDX,EAAAA,QAAQ,CAACQ,GAAD,EAAM;AACZ,UAAM,EAAEvC,YAAF,KAAmB,KAAKc,KAA9B;AACA,QAAI6B,KAAK,GAAG3C,YAAY,CAACuC,GAAD,CAAZ,GAAoBvC,YAAY,CAACuC,GAAD,CAAhC,GAAwCA,GAApD;AACA,QAAI,4BAAAI,KAAK,MAAL,CAAAA,KAAK,EAAY,IAAZ,CAAT,EAA4B;AAC1B;AACAA,MAAAA,KAAK,GAAG,EAAR;AACD;AACD,WAAOA,KAAP;AACD;AACDT,EAAAA,gBAAgB,CAACxC,UAAD,EAAa;AAC3B,SAAK2C,QAAL,CAAc,EAAE3C,UAAF,EAAd;AACA,SAAKoB,KAAL,CAAWX,QAAX,CAAoB,8CAAYT,UAAZ,mBAA4BkD,CAAC,IAAIlD,UAAU,CAACkD,CAAD,CAA3C,CAApB;AACD;AACDC,EAAAA,UAAU,CAACzB,EAAD,EAAK;AACb,UAAM0B,OAAO,sBAAQ,KAAKpB,KAAL,CAAWhC,UAAnB,CAAb;AACA,WAAOoD,OAAO,CAAC1B,EAAD,CAAd;AACA,SAAKc,gBAAL,CAAsBY,OAAtB;AACD;AACDC,EAAAA,qBAAqB,GAAG;AACtB,UAAM,EAAE9C,YAAF,EAAgBI,YAAhB,EAA8BE,cAA9B,KAAiD,KAAKO,KAA5D;AACA,UAAMkC,IAAI,GAAG3C,YAAY;AACrB,4BAAAJ,YAAY,MAAZ,CAAAA,YAAY,EAAQ,CAAC,WAAD,CAAR,CADS;AAErBA,IAAAA,YAFJ;AAGA,WAAOM,cAAc,GAAG,qCAAC,UAAD,mBAAoByC,IAApB,CAAH,GAA+BA,IAApD;AACD;AACDC,EAAAA,YAAY,CAAC7B,EAAD,EAAK;AACf,SAAKkB,YAAL,CAAkBlB,EAAlB,EAAsB,YAAtB,EAAoC,KAApC;AACA,SAAKiB,QAAL,CAAc;AACZV,MAAAA,eAAe;AACV,WAAKD,KAAL,CAAWC,eADD;AAEb,SAACP,EAAD,GAAM,CAAC,KAAKM,KAAL,CAAWC,eAAX,CAA2BP,EAA3B,CAFM,GADH,EAAd;;;AAMD;AACD8B,EAAAA,eAAe,GAAG;AAChB,UAAMF,IAAI,GAAG,KAAKD,qBAAL,EAAb;AACA;AACE;AACE;AACG,WAAKjC,KAAL,CAAWP,cAAX,IAA6B,sBAAI,SAAS,EAAC,WAAd,wEADhC;AAEG,2BAAAyC,IAAI,MAAJ,CAAAA,IAAI,EAAK,CAAAT,GAAG;AACX,4BAAI,GAAG,EAAEA,GAAT,yEAAe,KAAKR,QAAL,CAAcQ,GAAd,CAAf,CADG,CAFP;;AAKG,WAAKzB,KAAL,CAAWT,YAAX,IAA2B,sBAAI,SAAS,EAAC,WAAd,wEAL9B,CADF,CADF;;;;AAWD;AACDyB,EAAAA,uBAAuB,CAACY,IAAD,EAAO;AAC5B,UAAMS,cAAc,GAAG,OAAO,EAAET,IAAF,EAAQvC,QAAQ,EAAE,KAAK6B,gBAAvB,EAAP,CAAvB;AACA,WAAOxC,iBAAiB;AACtB,SAAKsB,KAAL,CAAWP,cADW;AAEtBhB,IAAAA,QAFsB;AAGtB4D,IAAAA,cAHsB,CAAxB;;AAKD;AACDC,EAAAA,UAAU,CAACC,MAAD,EAASd,GAAT,EAAc;AACtB,UAAMe,QAAQ,GAAG,KAAKxC,KAAL,CAAWV,aAAX,CAAyBmC,GAAzB,CAAjB;AACA,UAAMC,GAAG,GAAGa,MAAM,CAACd,GAAD,CAAlB;AACA,UAAMpC,QAAQ,GAAG,wCAAKmC,YAAL,mBAAuB,IAAvB,EAA6Be,MAAM,CAACjC,EAApC,EAAwCmB,GAAxC,CAAjB;AACA,WAAOe,QAAQ,GAAGA,QAAQ,CAACd,GAAD,EAAMrC,QAAN,EAAgB,KAAK4B,QAAL,CAAcQ,GAAd,CAAhB,CAAX,GAAiDC,GAAhE;AACD;AACDZ,EAAAA,UAAU,CAACyB,MAAD,EAAS;AACjB,UAAM,EAAEpD,YAAF,EAAgBI,YAAhB,EAA8BE,cAA9B,KAAiD,KAAKO,KAA5D;AACA;AACA,UAAMyC,UAAU;AACd,KAAC,CAAC,KAAK7B,KAAL,CAAWC,eAAX,CAA2B0B,MAAM,CAACjC,EAAlC,CAAF,IAA2CiC,MAAM,CAACG,UADpD;AAEA,QAAIC,GAAG,GAAG,EAAV;AACA,QAAIlD,cAAJ,EAAoB;AAClBkD,MAAAA,GAAG,CAACC,IAAJ;AACE,4BAAI,GAAG,EAAC,UAAR,EAAmB,SAAS,EAAC,QAA7B;AACE;AACE,QAAA,SAAS;AACPH,QAAAA,UAAU,GAAG,MAAH,GAAY,OADf,2BADX;;AAIE,QAAA,OAAO,EAAE,wCAAKN,YAAL,mBAAuB,IAAvB,EAA6BI,MAAM,CAACjC,EAApC,CAJX,wEADF,CADF;;;;AAUD;AACDqC,IAAAA,GAAG,GAAG,wBAAAA,GAAG,MAAH,CAAAA,GAAG;AACP,yBAAAxD,YAAY,MAAZ,CAAAA,YAAY,EAAK,CAAAsC,GAAG;AAClB,0BAAI,GAAG,EAAEA,GAAT,yEAAe,KAAKa,UAAL,CAAgBC,MAAhB,EAAwBd,GAAxB,CAAf,CADU,CADL,CAAT;;;AAKA,QAAIlC,YAAJ,EAAkB;AAChBoD,MAAAA,GAAG,CAACC,IAAJ;AACE,4BAAI,GAAG,EAAC,WAAR;AACE;AACE,QAAA,SAAS,EAAC,kCADZ;AAEE,QAAA,OAAO,EAAE,wCAAKb,UAAL,mBAAqB,IAArB,EAA2BQ,MAAM,CAACjC,EAAlC,CAFX,wEADF,CADF;;;;AAQD;AACD,UAAMuC,GAAG,GAAG;AACV,0BAAI,SAAS,EAAC,KAAd,EAAoB,GAAG,EAAEN,MAAM,CAACjC,EAAhC;AACGqC,IAAAA,GADH,CADU,CAAZ;;;AAKA,QAAIF,UAAJ,EAAgB;AACdI,MAAAA,GAAG,CAACD,IAAJ;AACE,4BAAI,SAAS,EAAC,KAAd,EAAoB,GAAG,EAAE,UAAUL,MAAM,CAACjC,EAA1C;AACE;AACE,QAAA,OAAO,EAAE,KAAK2B,qBAAL,GAA6Ba,MADxC;AAEE,QAAA,SAAS,EAAC,UAFZ;;AAIE,oGAAM,KAAK9B,uBAAL,CAA6BuB,MAA7B,CAAN,CAJF,CADF,CADF;;;;AAUD;AACD,WAAOM,GAAP;AACD;AACDE,EAAAA,eAAe,GAAG;AAChB;AACE;AACE,4BAAI,SAAS,EAAC,kBAAd,yEAAkC,KAAK/C,KAAL,CAAWL,YAA7C,CADF,CADF;;;AAKD;AACDwB,EAAAA,eAAe,GAAG;AAChB,UAAM6B,IAAI,GAAG,+CAAY,KAAKpC,KAAL,CAAWhC,UAAvB;AACXkD,IAAAA,CAAC,IAAI,KAAKlB,KAAL,CAAWhC,UAAX,CAAsBkD,CAAtB,CADM,CAAb;;AAGA,UAAMmB,OAAO,GAAGD,IAAI,CAACF,MAAL;AACZ,yBAAAE,IAAI,MAAJ,CAAAA,IAAI,EAAKE,CAAC,IAAI,KAAKpC,UAAL,CAAgBoC,CAAhB,CAAV,CADQ;AAEZ,SAAKH,eAAL,EAFJ;AAGA,WAAO,gGAAQE,OAAR,CAAP;AACD;AACDE,EAAAA,MAAM,GAAG;AACP;AACE,6BAAK,SAAS,EAAC,MAAf;AACE,+BAAO,SAAS,EAAC,OAAjB;AACG,WAAKf,eAAL,EADH;AAEG,WAAKjB,eAAL,EAFH,CADF;;AAKE;AACG,WAAKnB,KAAL,CAAWH,YAAX;AACC,oBAAC,MAAD,IAAQ,OAAO,EAAC,SAAhB,EAA0B,OAAO,EAAE,KAAKkB,SAAxC;AACE,2BAAG,SAAS,EAAC,YAAb,wEADF,OACgCxC,CAAC,CAAC,UAAD,CADjC,CAFJ;;;AAMG,WAAKyB,KAAL,CAAWJ,YANd,CALF,CADF;;;;AAgBD,GAlM6D;AAAA;AAAA,6BAoMhEa,cAAc,CAACX,YAAf,GAA8BA,YAA9B;AACAW,cAAc,CAAC9B,SAAf,GAA2BA,SAA3B,C,iLA5OMA,S,oIAaAmB,Y,uIAWAC,K,gIAGGG,qB,gJAYYO,c","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/translation';\nimport Button from '../components/Button';\nimport Fieldset from './Fieldset';\nimport { recurseReactClone } from './utils';\nimport './crud.less';\n\nconst propTypes = {\n  collection: PropTypes.arrayOf(PropTypes.object).isRequired,\n  itemGenerator: PropTypes.func,\n  columnLabels: PropTypes.object,\n  tableColumns: PropTypes.array.isRequired,\n  onChange: PropTypes.func,\n  itemRenderers: PropTypes.object,\n  allowDeletes: PropTypes.bool,\n  expandFieldset: PropTypes.node,\n  emptyMessage: PropTypes.node,\n  extraButtons: PropTypes.node,\n  allowAddItem: PropTypes.bool,\n};\nconst defaultProps = {\n  onChange: () => {},\n  itemRenderers: {},\n  columnLabels: {},\n  allowDeletes: false,\n  emptyMessage: 'No entries',\n  allowAddItem: false,\n  itemGenerator: () => ({}),\n  expandFieldset: null,\n  extraButtons: null,\n};\nconst Frame = props => <div className=\"frame\">{props.children}</div>;\nFrame.propTypes = { children: PropTypes.node };\n\nfunction createKeyedCollection(arr) {\n  const newArr = arr.map(o => ({\n    ...o,\n    id: o.id || shortid.generate(),\n  }));\n  const map = {};\n  newArr.forEach(o => {\n    map[o.id] = o;\n  });\n  return map;\n}\n\nexport default class CRUDCollection extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      expandedColumns: {},\n      collection: createKeyedCollection(props.collection),\n    };\n    this.renderItem = this.renderItem.bind(this);\n    this.onAddItem = this.onAddItem.bind(this);\n    this.renderExpandableSection = this.renderExpandableSection.bind(this);\n    this.getLabel = this.getLabel.bind(this);\n    this.onFieldsetChange = this.onFieldsetChange.bind(this);\n    this.renderTableBody = this.renderTableBody.bind(this);\n    this.changeCollection = this.changeCollection.bind(this);\n  }\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (nextProps.collection !== this.props.collection) {\n      this.setState({\n        collection: createKeyedCollection(nextProps.collection),\n      });\n    }\n  }\n  onCellChange(id, col, val) {\n    this.changeCollection({\n      ...this.state.collection,\n      [id]: {\n        ...this.state.collection[id],\n        [col]: val,\n      },\n    });\n  }\n  onAddItem() {\n    let newItem = this.props.itemGenerator();\n    if (!newItem.id) {\n      newItem = { ...newItem, id: shortid.generate() };\n    }\n    this.changeCollection({\n      ...this.state.collection,\n      [newItem.id]: newItem,\n    });\n  }\n  onFieldsetChange(item) {\n    this.changeCollection({\n      ...this.state.collection,\n      [item.id]: item,\n    });\n  }\n  getLabel(col) {\n    const { columnLabels } = this.props;\n    let label = columnLabels[col] ? columnLabels[col] : col;\n    if (label.startsWith('__')) {\n      // special label-free columns (ie: caret for expand, delete cross)\n      label = '';\n    }\n    return label;\n  }\n  changeCollection(collection) {\n    this.setState({ collection });\n    this.props.onChange(Object.keys(collection).map(k => collection[k]));\n  }\n  deleteItem(id) {\n    const newColl = { ...this.state.collection };\n    delete newColl[id];\n    this.changeCollection(newColl);\n  }\n  effectiveTableColumns() {\n    const { tableColumns, allowDeletes, expandFieldset } = this.props;\n    const cols = allowDeletes\n      ? tableColumns.concat(['__actions'])\n      : tableColumns;\n    return expandFieldset ? ['__expand'].concat(cols) : cols;\n  }\n  toggleExpand(id) {\n    this.onCellChange(id, '__expanded', false);\n    this.setState({\n      expandedColumns: {\n        ...this.state.expandedColumns,\n        [id]: !this.state.expandedColumns[id],\n      },\n    });\n  }\n  renderHeaderRow() {\n    const cols = this.effectiveTableColumns();\n    return (\n      <thead>\n        <tr>\n          {this.props.expandFieldset && <th className=\"tiny-cell\" />}\n          {cols.map(col => (\n            <th key={col}>{this.getLabel(col)}</th>\n          ))}\n          {this.props.allowDeletes && <th className=\"tiny-cell\" />}\n        </tr>\n      </thead>\n    );\n  }\n  renderExpandableSection(item) {\n    const propsGenerator = () => ({ item, onChange: this.onFieldsetChange });\n    return recurseReactClone(\n      this.props.expandFieldset,\n      Fieldset,\n      propsGenerator,\n    );\n  }\n  renderCell(record, col) {\n    const renderer = this.props.itemRenderers[col];\n    const val = record[col];\n    const onChange = this.onCellChange.bind(this, record.id, col);\n    return renderer ? renderer(val, onChange, this.getLabel(col)) : val;\n  }\n  renderItem(record) {\n    const { tableColumns, allowDeletes, expandFieldset } = this.props;\n    /* eslint-disable no-underscore-dangle */\n    const isExpanded =\n      !!this.state.expandedColumns[record.id] || record.__expanded;\n    let tds = [];\n    if (expandFieldset) {\n      tds.push(\n        <td key=\"__expand\" className=\"expand\">\n          <i\n            className={`fa fa-caret-${\n              isExpanded ? 'down' : 'right'\n            } text-primary pointer`}\n            onClick={this.toggleExpand.bind(this, record.id)}\n          />\n        </td>,\n      );\n    }\n    tds = tds.concat(\n      tableColumns.map(col => (\n        <td key={col}>{this.renderCell(record, col)}</td>\n      )),\n    );\n    if (allowDeletes) {\n      tds.push(\n        <td key=\"__actions\">\n          <i\n            className=\"fa fa-close text-primary pointer\"\n            onClick={this.deleteItem.bind(this, record.id)}\n          />\n        </td>,\n      );\n    }\n    const trs = [\n      <tr className=\"row\" key={record.id}>\n        {tds}\n      </tr>,\n    ];\n    if (isExpanded) {\n      trs.push(\n        <tr className=\"exp\" key={'exp__' + record.id}>\n          <td\n            colSpan={this.effectiveTableColumns().length}\n            className=\"expanded\"\n          >\n            <div>{this.renderExpandableSection(record)}</div>\n          </td>\n        </tr>,\n      );\n    }\n    return trs;\n  }\n  renderEmptyCell() {\n    return (\n      <tr>\n        <td className=\"empty-collection\">{this.props.emptyMessage}</td>\n      </tr>\n    );\n  }\n  renderTableBody() {\n    const data = Object.keys(this.state.collection).map(\n      k => this.state.collection[k],\n    );\n    const content = data.length\n      ? data.map(d => this.renderItem(d))\n      : this.renderEmptyCell();\n    return <tbody>{content}</tbody>;\n  }\n  render() {\n    return (\n      <div className=\"CRUD\">\n        <table className=\"table\">\n          {this.renderHeaderRow()}\n          {this.renderTableBody()}\n        </table>\n        <div>\n          {this.props.allowAddItem && (\n            <Button bsStyle=\"primary\" onClick={this.onAddItem}>\n              <i className=\"fa fa-plus\" /> {t('Add Item')}\n            </Button>\n          )}\n          {this.props.extraButtons}\n        </div>\n      </div>\n    );\n  }\n}\nCRUDCollection.defaultProps = defaultProps;\nCRUDCollection.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}