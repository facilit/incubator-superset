{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _setTimeout from \"@babel/runtime-corejs3/core-js-stable/set-timeout\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Tabs as BootstrapTabs, Tab as BootstrapTab } from 'react-bootstrap';\n\nimport DragDroppable from '../dnd/DragDroppable';\nimport DragHandle from '../dnd/DragHandle';\nimport DashboardComponent from '../../containers/DashboardComponent';\nimport DeleteComponentButton from '../DeleteComponentButton';\nimport HoverMenu from '../menu/HoverMenu';\nimport findTabIndexByComponentId from '../../util/findTabIndexByComponentId';\nimport getDirectPathToTabIndex from '../../util/getDirectPathToTabIndex';\nimport getLeafComponentIdFromPath from '../../util/getLeafComponentIdFromPath';\nimport { componentShape } from '../../util/propShapes';\nimport { NEW_TAB_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\nimport { RENDER_TAB, RENDER_TAB_CONTENT } from './Tab';\nimport { TAB_TYPE } from '../../util/componentTypes';\nimport { LOG_ACTIONS_SELECT_DASHBOARD_TAB } from '../../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst NEW_TAB_INDEX = -1;\nconst MAX_TAB_COUNT = 10;\n\nconst propTypes = {\n  id: PropTypes.string.isRequired,\n  parentId: PropTypes.string.isRequired,\n  component: componentShape.isRequired,\n  parentComponent: componentShape.isRequired,\n  index: PropTypes.number.isRequired,\n  depth: PropTypes.number.isRequired,\n  renderTabContent: PropTypes.bool, // whether to render tabs + content or just tabs\n  editMode: PropTypes.bool.isRequired,\n  renderHoverMenu: PropTypes.bool,\n  logEvent: PropTypes.func.isRequired,\n  directPathToChild: PropTypes.arrayOf(PropTypes.string),\n\n  // grid related\n  availableColumnCount: PropTypes.number,\n  columnWidth: PropTypes.number,\n  onResizeStart: PropTypes.func,\n  onResize: PropTypes.func,\n  onResizeStop: PropTypes.func,\n\n  // dnd\n  createComponent: PropTypes.func.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  onChangeTab: PropTypes.func.isRequired,\n  deleteComponent: PropTypes.func.isRequired,\n  updateComponents: PropTypes.func.isRequired };\n\n\nconst defaultProps = {\n  children: null,\n  renderTabContent: true,\n  renderHoverMenu: true,\n  availableColumnCount: 0,\n  columnWidth: 0,\n  directPathToChild: [],\n  onResizeStart() {},\n  onResize() {},\n  onResizeStop() {} };\n\n\nclass Tabs extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    const tabIndex = Math.max(\n    0,\n    findTabIndexByComponentId({\n      currentComponent: props.component,\n      directPathToChild: props.directPathToChild }));\n\n\n\n    this.state = {\n      tabIndex };\n\n    this.handleClickTab = _bindInstanceProperty(_context = this.handleClickTab).call(_context, this);\n    this.handleDeleteComponent = _bindInstanceProperty(_context2 = this.handleDeleteComponent).call(_context2, this);\n    this.handleDeleteTab = _bindInstanceProperty(_context3 = this.handleDeleteTab).call(_context3, this);\n    this.handleDropOnTab = _bindInstanceProperty(_context4 = this.handleDropOnTab).call(_context4, this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const maxIndex = Math.max(0, nextProps.component.children.length - 1);\n    if (this.state.tabIndex > maxIndex) {\n      this.setState(() => ({ tabIndex: maxIndex }));\n    }\n\n    if (nextProps.isComponentVisible) {\n      const nextFocusComponent = getLeafComponentIdFromPath(\n      nextProps.directPathToChild);\n\n      const currentFocusComponent = getLeafComponentIdFromPath(\n      this.props.directPathToChild);\n\n\n      if (nextFocusComponent !== currentFocusComponent) {\n        const nextTabIndex = findTabIndexByComponentId({\n          currentComponent: nextProps.component,\n          directPathToChild: nextProps.directPathToChild });\n\n\n        // make sure nextFocusComponent is under this tabs component\n        if (nextTabIndex > -1 && nextTabIndex !== this.state.tabIndex) {\n          this.setState(() => ({ tabIndex: nextTabIndex }));\n        }\n      }\n    }\n  }\n\n  handleClickTab(tabIndex, ev) {\n    if (ev) {\n      const target = ev.target;\n      // special handler for clicking on anchor link icon (or whitespace nearby):\n      // will show short link popover but do not change tab\n      if (target && target.classList.contains('short-link-trigger')) {\n        return;\n      }\n    }\n\n    const { component, createComponent } = this.props;\n\n    if (tabIndex === NEW_TAB_INDEX) {\n      createComponent({\n        destination: {\n          id: component.id,\n          type: component.type,\n          index: component.children.length },\n\n        dragging: {\n          id: NEW_TAB_ID,\n          type: TAB_TYPE } });\n\n\n    } else if (tabIndex !== this.state.tabIndex) {\n      const pathToTabIndex = getDirectPathToTabIndex(component, tabIndex);\n      const targetTabId = pathToTabIndex[pathToTabIndex.length - 1];\n      this.props.logEvent(LOG_ACTIONS_SELECT_DASHBOARD_TAB, {\n        target_id: targetTabId,\n        index: tabIndex });\n\n\n      this.props.onChangeTab({ pathToTabIndex });\n    }\n  }\n\n  handleDeleteComponent() {\n    const { deleteComponent, id, parentId } = this.props;\n    deleteComponent(id, parentId);\n  }\n\n  handleDeleteTab(tabIndex) {\n    this.handleClickTab(Math.max(0, tabIndex - 1));\n  }\n\n  handleDropOnTab(dropResult) {\n    const { component } = this.props;\n\n    // Ensure dropped tab is visible\n    const { destination } = dropResult;\n    if (destination) {var _context5;\n      const dropTabIndex =\n      destination.id === component.id ?\n      destination.index // dropped ON tabs\n      : _indexOfInstanceProperty(_context5 = component.children).call(_context5, destination.id); // dropped IN tab\n\n      if (dropTabIndex > -1) {\n        _setTimeout(() => {\n          this.handleClickTab(dropTabIndex);\n        }, 30);\n      }\n    }\n  }\n\n  render() {\n    const {\n      depth,\n      component: tabsComponent,\n      parentComponent,\n      index,\n      availableColumnCount,\n      columnWidth,\n      onResizeStart,\n      onResize,\n      onResizeStop,\n      handleComponentDrop,\n      renderTabContent,\n      renderHoverMenu,\n      isComponentVisible: isCurrentTabVisible,\n      editMode } =\n    this.props;\n\n    const { tabIndex: selectedTabIndex } = this.state;\n    const { children: tabIds } = tabsComponent;\n\n    return (\n      ___EmotionJSX(DragDroppable, {\n        component: tabsComponent,\n        parentComponent: parentComponent,\n        orientation: \"row\",\n        index: index,\n        depth: depth,\n        onDrop: handleComponentDrop,\n        editMode: editMode },\n\n      ({\n        dropIndicatorProps: tabsDropIndicatorProps,\n        dragSourceRef: tabsDragSourceRef }) =>\n\n      ___EmotionJSX(\"div\", { className: \"dashboard-component dashboard-component-tabs\" },\n      editMode && renderHoverMenu &&\n      ___EmotionJSX(HoverMenu, { innerRef: tabsDragSourceRef, position: \"left\" },\n      ___EmotionJSX(DragHandle, { position: \"left\" }),\n      ___EmotionJSX(DeleteComponentButton, { onDelete: this.handleDeleteComponent })),\n\n\n\n      ___EmotionJSX(BootstrapTabs, {\n        id: tabsComponent.id,\n        activeKey: selectedTabIndex,\n        onSelect: this.handleClickTab,\n        animation: true,\n        mountOnEnter: true,\n        unmountOnExit: false },\n\n      _mapInstanceProperty(tabIds).call(tabIds, (tabId, tabIndex) =>\n      // react-bootstrap doesn't render a Tab if we move this to its own Tab.jsx so we\n      // use `renderType` to indicate what the DashboardComponent should render. This\n      // prevents us from passing the entire dashboard component lookup to render Tabs.jsx\n      ___EmotionJSX(BootstrapTab, {\n        key: tabId,\n        eventKey: tabIndex,\n        title:\n        ___EmotionJSX(DashboardComponent, {\n          id: tabId,\n          parentId: tabsComponent.id,\n          depth: depth,\n          index: tabIndex,\n          renderType: RENDER_TAB,\n          availableColumnCount: availableColumnCount,\n          columnWidth: columnWidth,\n          onDropOnTab: this.handleDropOnTab,\n          onDeleteTab: this.handleDeleteTab }) },\n\n\n\n      renderTabContent &&\n      ___EmotionJSX(DashboardComponent, {\n        id: tabId,\n        parentId: tabsComponent.id,\n        depth: depth // see isValidChild.js for why tabs don't increment child depth\n        , index: tabIndex,\n        renderType: RENDER_TAB_CONTENT,\n        availableColumnCount: availableColumnCount,\n        columnWidth: columnWidth,\n        onResizeStart: onResizeStart,\n        onResize: onResize,\n        onResizeStop: onResizeStop,\n        onDropOnTab: this.handleDropOnTab,\n        isComponentVisible:\n        selectedTabIndex === tabIndex && isCurrentTabVisible }))),\n\n\n\n\n\n\n      editMode && tabIds.length < MAX_TAB_COUNT &&\n      ___EmotionJSX(BootstrapTab, {\n        eventKey: NEW_TAB_INDEX,\n        title: ___EmotionJSX(\"div\", { className: \"fa fa-plus\" }) })),\n\n\n\n\n\n      tabsDropIndicatorProps &&\n      parentComponent.id !== DASHBOARD_ROOT_ID &&\n      ___EmotionJSX(\"div\", tabsDropIndicatorProps))));\n\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nTabs.propTypes = propTypes;\nTabs.defaultProps = defaultProps;const _default =\n\nTabs;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(NEW_TAB_INDEX, \"NEW_TAB_INDEX\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(MAX_TAB_COUNT, \"MAX_TAB_COUNT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(Tabs, \"Tabs\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}