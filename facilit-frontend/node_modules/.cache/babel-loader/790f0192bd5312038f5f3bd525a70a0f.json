{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _sortInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/sort\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _findIndexInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find-index\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         */\n/* eslint-env browser */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { DropdownButton, MenuItem } from 'react-bootstrap';\nimport { CellMeasurer, CellMeasurerCache, List } from 'react-virtualized';\nimport SearchInput, { createFilter } from 'react-search-input';\nimport { t } from '@superset-ui/translation';\n\nimport AddSliceCard from './AddSliceCard';\nimport AddSliceDragPreview from './dnd/AddSliceDragPreview';\nimport DragDroppable from './dnd/DragDroppable';\nimport Loading from '../../components/Loading';\nimport { CHART_TYPE, NEW_COMPONENT_SOURCE_TYPE } from '../util/componentTypes';\nimport { NEW_CHART_ID, NEW_COMPONENTS_SOURCE_ID } from '../util/constants';\nimport { slicePropShape } from '../util/propShapes';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  fetchAllSlices: PropTypes.func.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  slices: PropTypes.objectOf(slicePropShape).isRequired,\n  lastUpdated: PropTypes.number.isRequired,\n  errorMessage: PropTypes.string,\n  userId: PropTypes.string.isRequired,\n  selectedSliceIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n  editMode: PropTypes.bool,\n  height: PropTypes.number };\n\n\nconst defaultProps = {\n  selectedSliceIds: [],\n  editMode: false,\n  errorMessage: '',\n  height: window.innerHeight };\n\n\nconst KEYS_TO_FILTERS = ['slice_name', 'viz_type', 'datasource_name'];\nconst KEYS_TO_SORT = [\n{ key: 'slice_name', label: 'Name' },\n{ key: 'viz_type', label: 'Vis type' },\n{ key: 'datasource_name', label: 'Datasource' },\n{ key: 'changed_on', label: 'Recent' }];\n\n\nconst MARGIN_BOTTOM = 16;\nconst SIDEPANE_HEADER_HEIGHT = 55;\nconst SLICE_ADDER_CONTROL_HEIGHT = 64;\nconst DEFAULT_CELL_HEIGHT = 136;\n\nconst cache = new CellMeasurerCache({\n  defaultHeight: DEFAULT_CELL_HEIGHT,\n  fixedWidth: true });\n\n\nclass SliceAdder extends React.Component {\n  static sortByComparator(attr) {\n    const desc = attr === 'changed_on' ? -1 : 1;\n\n    return (a, b) => {\n      if (a[attr] < b[attr]) {\n        return -1 * desc;\n      } else if (a[attr] > b[attr]) {\n        return 1 * desc;\n      }\n      return 0;\n    };\n  }\n\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      filteredSlices: [],\n      searchTerm: '',\n      sortBy: _findIndexInstanceProperty(KEYS_TO_SORT).call(KEYS_TO_SORT, item => item.key === 'changed_on'),\n      selectedSliceIdsSet: new _Set(props.selectedSliceIds) };\n\n\n    this.rowRenderer = _bindInstanceProperty(_context = this.rowRenderer).call(_context, this);\n    this.searchUpdated = _bindInstanceProperty(_context2 = this.searchUpdated).call(_context2, this);\n    this.handleKeyPress = _bindInstanceProperty(_context3 = this.handleKeyPress).call(_context3, this);\n    this.handleSelect = _bindInstanceProperty(_context4 = this.handleSelect).call(_context4, this);\n  }\n\n  componentDidMount() {\n    this.slicesRequest = this.props.fetchAllSlices(this.props.userId);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const nextState = {};\n    if (nextProps.lastUpdated !== this.props.lastUpdated) {var _context5, _context6;\n      nextState.filteredSlices = _sortInstanceProperty(_context5 = _filterInstanceProperty(_context6 = _Object$values(nextProps.slices)).call(_context6,\n      createFilter(this.state.searchTerm, KEYS_TO_FILTERS))).call(_context5,\n      SliceAdder.sortByComparator(KEYS_TO_SORT[this.state.sortBy].key));\n    }\n\n    if (nextProps.selectedSliceIds !== this.props.selectedSliceIds) {\n      nextState.selectedSliceIdsSet = new _Set(nextProps.selectedSliceIds);\n    }\n\n    if (_Object$keys(nextState).length) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.slicesRequest && this.slicesRequest.abort) {\n      this.slicesRequest.abort();\n    }\n  }\n\n  getFilteredSortedSlices(searchTerm, sortBy) {var _context7, _context8;\n    return _sortInstanceProperty(_context7 = _filterInstanceProperty(_context8 = _Object$values(this.props.slices)).call(_context8,\n    createFilter(searchTerm, KEYS_TO_FILTERS))).call(_context7,\n    SliceAdder.sortByComparator(KEYS_TO_SORT[sortBy].key));\n  }\n\n  handleKeyPress(ev) {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n\n      this.searchUpdated(ev.target.value);\n    }\n  }\n\n  searchUpdated(searchTerm) {\n    this.setState({\n      searchTerm,\n      filteredSlices: this.getFilteredSortedSlices(\n      searchTerm,\n      this.state.sortBy) });\n\n\n  }\n\n  handleSelect(sortBy) {\n    this.setState({\n      sortBy,\n      filteredSlices: this.getFilteredSortedSlices(\n      this.state.searchTerm,\n      sortBy) });\n\n\n  }\n\n  rowRenderer({ key, index, style, parent }) {\n    const { filteredSlices, selectedSliceIdsSet } = this.state;\n    const cellData = filteredSlices[index];\n    const isSelected = selectedSliceIdsSet.has(cellData.slice_id);\n    const type = CHART_TYPE;\n    const id = NEW_CHART_ID;\n\n    const meta = {\n      chartId: cellData.slice_id,\n      sliceName: cellData.slice_name };\n\n    return (\n      ___EmotionJSX(DragDroppable, {\n        key: key,\n        component: { type, id, meta },\n        parentComponent: {\n          id: NEW_COMPONENTS_SOURCE_ID,\n          type: NEW_COMPONENT_SOURCE_TYPE },\n\n        index: index,\n        depth: 0,\n        disableDragDrop: isSelected,\n        editMode: this.props.editMode\n        // we must use a custom drag preview within the List because\n        // it does not seem to work within a fixed-position container\n        , useEmptyDragPreview: true\n        // List library expect style props here\n        // actual style should be applied to nested AddSliceCard component\n        , style: {} },\n\n      ({ dragSourceRef }) =>\n      ___EmotionJSX(CellMeasurer, {\n        cache: cache,\n        columnIndex: 0,\n        key: key,\n        parent: parent,\n        rowIndex: index },\n\n      ___EmotionJSX(AddSliceCard, {\n        innerRef: dragSourceRef,\n        style: style,\n        sliceName: cellData.slice_name,\n        lastModified: cellData.changed_on_humanized,\n        visType: cellData.viz_type,\n        datasourceLink: cellData.datasource_link,\n        isSelected: isSelected }))));\n\n\n\n\n\n  }\n\n  render() {\n    const slicesListHeight =\n    this.props.height -\n    SIDEPANE_HEADER_HEIGHT -\n    SLICE_ADDER_CONTROL_HEIGHT -\n    MARGIN_BOTTOM;\n    return (\n      ___EmotionJSX(\"div\", { className: \"slice-adder-container\" },\n      ___EmotionJSX(\"div\", { className: \"controls\" },\n      ___EmotionJSX(SearchInput, {\n        placeholder: t('Filter your charts'),\n        className: \"search-input\",\n        onChange: this.searchUpdated,\n        onKeyPress: this.handleKeyPress }),\n\n\n      ___EmotionJSX(DropdownButton, {\n        title: \"Sort by \" + KEYS_TO_SORT[this.state.sortBy].label,\n        onSelect: this.handleSelect,\n        id: \"slice-adder-sortby\" },\n\n      _mapInstanceProperty(KEYS_TO_SORT).call(KEYS_TO_SORT, (item, index) =>\n      ___EmotionJSX(MenuItem, { key: item.key, eventKey: index }, \"Sort by \",\n      item.label)))),\n\n\n\n\n      this.props.isLoading && ___EmotionJSX(Loading, null),\n      !this.props.isLoading && this.state.filteredSlices.length > 0 &&\n      ___EmotionJSX(List, {\n        width: 376,\n        height: slicesListHeight,\n        rowCount: this.state.filteredSlices.length,\n        deferredMeasurementCache: cache,\n        rowHeight: cache.rowHeight,\n        rowRenderer: this.rowRenderer,\n        searchTerm: this.state.searchTerm,\n        sortBy: this.state.sortBy,\n        selectedSliceIds: this.props.selectedSliceIds }),\n\n\n      this.props.errorMessage &&\n      ___EmotionJSX(\"div\", { className: \"error-message\" }, this.props.errorMessage),\n\n\n      ___EmotionJSX(AddSliceDragPreview, { slices: this.state.filteredSlices })));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSliceAdder.propTypes = propTypes;\nSliceAdder.defaultProps = defaultProps;const _default =\n\nSliceAdder;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(KEYS_TO_FILTERS, \"KEYS_TO_FILTERS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(KEYS_TO_SORT, \"KEYS_TO_SORT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(MARGIN_BOTTOM, \"MARGIN_BOTTOM\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(SIDEPANE_HEADER_HEIGHT, \"SIDEPANE_HEADER_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(SLICE_ADDER_CONTROL_HEIGHT, \"SLICE_ADDER_CONTROL_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(DEFAULT_CELL_HEIGHT, \"DEFAULT_CELL_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(cache, \"cache\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(SliceAdder, \"SliceAdder\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/SliceAdder.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}