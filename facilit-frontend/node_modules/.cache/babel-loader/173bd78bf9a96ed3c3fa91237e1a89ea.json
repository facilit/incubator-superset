{"ast":null,"code":"import \"core-js/modules/es.regexp.to-string\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                              *\n                                                                                                                                                                                                                                                                                                                                                                                                                                              *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                              *\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                              * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                              */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { Alert } from 'react-bootstrap';\n\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from '../logger/LogUtils';\nimport Loading from '../components/Loading';\nimport RefreshChartOverlay from '../components/RefreshChartOverlay';\nimport ErrorMessageWithStackTrace from '../components/ErrorMessage/ErrorMessageWithStackTrace';\nimport ErrorBoundary from '../components/ErrorBoundary';\nimport ChartRenderer from './ChartRenderer';\nimport './chart.less';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object.isRequired,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queryResponse: PropTypes.object,\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func };\n\n\nconst BLANK = {};\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null };\n\n\nclass Chart extends React.PureComponent {\n  constructor(props) {var _context;\n    super(props);\n    this.handleRenderContainerFailure = _bindInstanceProperty(_context = this.handleRenderContainerFailure).call(_context,\n    this);\n\n  }\n\n  componentDidMount() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    if (this.props.chartId > 0 && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)) {\n      // Load saved chart with a GET request\n      this.props.actions.getSavedChart(\n      this.props.formData,\n      false,\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId);\n\n    } else {\n      // Create chart with POST request\n      this.props.actions.postChartFormData(\n      this.props.formData,\n      false,\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId);\n\n    }\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    console.warn(error); // eslint-disable-line\n    actions.chartRenderingFailed(\n    error.toString(),\n    chartId,\n    info ? info.componentStack : null);\n\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime });\n\n  }\n\n  renderErrorMessage() {var _queryResponse$errors;\n    const { chartAlert, chartStackTrace, queryResponse } = this.props;\n    return (\n      ___EmotionJSX(ErrorMessageWithStackTrace, {\n        error: queryResponse === null || queryResponse === void 0 ? void 0 : (_queryResponse$errors = queryResponse.errors) === null || _queryResponse$errors === void 0 ? void 0 : _queryResponse$errors[0],\n        message: chartAlert,\n        link: queryResponse ? queryResponse.link : null,\n        stackTrace: chartStackTrace }));\n\n\n  }\n\n  render() {\n    const {\n      width,\n      height,\n      chartAlert,\n      chartStatus,\n      errorMessage,\n      onQuery,\n      refreshOverlayVisible } =\n    this.props;\n\n    const isLoading = chartStatus === 'loading';\n\n    // this allows <Loading /> to be positioned in the middle of the chart\n    const containerStyles = isLoading ? { height, width } : null;\n    const isFaded = refreshOverlayVisible && !errorMessage;\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return this.renderErrorMessage();\n    }\n    if (errorMessage) {\n      return ___EmotionJSX(Alert, { bsStyle: \"warning\" }, errorMessage);\n    }\n    return (\n      ___EmotionJSX(ErrorBoundary, {\n        onError: this.handleRenderContainerFailure,\n        showMessage: false },\n\n      ___EmotionJSX(\"div\", {\n        className: \"chart-container \" + (isLoading ? 'is-loading' : ''),\n        style: containerStyles },\n\n      isLoading && ___EmotionJSX(Loading, { size: 50 }),\n\n      !isLoading && !chartAlert && isFaded &&\n      ___EmotionJSX(RefreshChartOverlay, {\n        width: width,\n        height: height,\n        onQuery: onQuery }),\n\n\n      ___EmotionJSX(\"div\", { className: \"slice_container \" + (isFaded ? ' faded' : '') },\n      ___EmotionJSX(ChartRenderer, this.props)))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;const _default =\n\nChart;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(BLANK, \"BLANK\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(Chart, \"Chart\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/chart/Chart.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}