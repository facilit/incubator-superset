{"ast":null,"code":"import \"core-js/modules/es.promise\";import \"core-js/modules/web.dom-collections.iterator\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _valuesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/values\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col, Button, Modal, FormControl } from 'react-bootstrap';\nimport Dialog from 'react-bootstrap-dialog';\nimport { AsyncSelect } from 'src/components/Select';\nimport AceEditor from 'react-ace';\nimport rison from 'rison';\nimport { t } from '@superset-ui/translation';\nimport { SupersetClient } from '@superset-ui/connection';\nimport '../stylesheets/buttons.less';\n\nimport getClientErrorObject from '../../utils/getClientErrorObject';\nimport withToasts from '../../messageToasts/enhancers/withToasts';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  dashboardId: PropTypes.number.isRequired,\n  show: PropTypes.bool.isRequired,\n  onHide: PropTypes.func,\n  onDashboardSave: PropTypes.func,\n  addSuccessToast: PropTypes.func.isRequired };\n\n\nconst defaultProps = {\n  onHide: () => {},\n  onDashboardSave: () => {},\n  show: false };\n\n\nclass PropertiesModal extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7;\n    super(props);\n    this.state = {\n      errors: [],\n      values: {\n        dashboard_title: '',\n        slug: '',\n        owners: [],\n        json_metadata: '' },\n\n      isDashboardLoaded: false,\n      isAdvancedOpen: false };\n\n    this.onChange = _bindInstanceProperty(_context = this.onChange).call(_context, this);\n    this.onMetadataChange = _bindInstanceProperty(_context2 = this.onMetadataChange).call(_context2, this);\n    this.onOwnersChange = _bindInstanceProperty(_context3 = this.onOwnersChange).call(_context3, this);\n    this.save = _bindInstanceProperty(_context4 = this.save).call(_context4, this);\n    this.toggleAdvanced = _bindInstanceProperty(_context5 = this.toggleAdvanced).call(_context5, this);\n    this.loadOwnerOptions = _bindInstanceProperty(_context6 = this.loadOwnerOptions).call(_context6, this);\n    this.handleErrorResponse = _bindInstanceProperty(_context7 = this.handleErrorResponse).call(_context7, this);\n  }\n\n  componentDidMount() {\n    this.fetchDashboardDetails();\n  }\n\n  onOwnersChange(value) {\n    this.updateFormState('owners', value);\n  }\n\n  onMetadataChange(metadata) {\n    this.updateFormState('json_metadata', metadata);\n  }\n\n  onChange(e) {\n    const { name, value } = e.target;\n    this.updateFormState(name, value);\n  }\n\n  fetchDashboardDetails() {\n    // We fetch the dashboard details because not all code\n    // that renders this component have all the values we need.\n    // At some point when we have a more consistent frontend\n    // datamodel, the dashboard could probably just be passed as a prop.\n    SupersetClient.get({\n      endpoint: \"/api/v1/dashboard/\" + this.props.dashboardId }).\n    then(response => {var _context8;\n      const dashboard = response.json.result;\n      this.setState(state => ({\n        isDashboardLoaded: true,\n        values: _Object$assign({}, _valuesInstanceProperty(\n        state), {\n          dashboard_title: dashboard.dashboard_title || '',\n          slug: dashboard.slug || '',\n          json_metadata: dashboard.json_metadata || '' }) }));\n\n\n      const initialSelectedOwners = _mapInstanceProperty(_context8 = dashboard.owners).call(_context8, owner => ({\n        value: owner.id,\n        label: owner.first_name + \" \" + owner.last_name }));\n\n      this.onOwnersChange(initialSelectedOwners);\n    }, this.handleErrorResponse);\n  }\n\n  loadOwnerOptions(input = '') {\n    const query = rison.encode({ filter: input });\n    return SupersetClient.get({\n      endpoint: \"/api/v1/dashboard/related/owners?q=\" + query }).\n    then(\n    response => {var _context9;\n      return _mapInstanceProperty(_context9 = response.json.result).call(_context9, item => ({\n        value: item.value,\n        label: item.text }));\n\n    },\n    badResponse => {\n      this.handleErrorResponse(badResponse);\n      return [];\n    });\n\n  }\n\n  updateFormState(name, value) {\n    this.setState(state => ({\n      values: _Object$assign({}, _valuesInstanceProperty(\n      state), {\n        [name]: value }) }));\n\n\n  }\n\n  toggleAdvanced() {\n    this.setState(state => ({\n      isAdvancedOpen: !state.isAdvancedOpen }));\n\n  }\n\n  async handleErrorResponse(response) {\n    const { error, statusText } = await getClientErrorObject(response);\n    this.dialog.show({\n      title: 'Error',\n      bsSize: 'medium',\n      bsStyle: 'danger',\n      actions: [Dialog.DefaultAction('Ok', () => {}, 'btn-danger')],\n      body: error || statusText || t('An error has occurred') });\n\n  }\n\n  save(e) {var _context10;\n    e.preventDefault();\n    e.stopPropagation();\n    const { values } = this.state;\n    const owners = _mapInstanceProperty(_context10 = values.owners).call(_context10, o => o.value);\n\n    SupersetClient.put({\n      endpoint: \"/api/v1/dashboard/\" + this.props.dashboardId,\n      headers: { 'Content-Type': 'application/json' },\n      body: _JSON$stringify({\n        dashboard_title: values.dashboard_title,\n        slug: values.slug || null,\n        json_metadata: values.json_metadata || null,\n        owners }) }).\n\n    then(({ json }) => {\n      this.props.addSuccessToast(t('The dashboard has been saved'));\n      this.props.onDashboardSave({\n        id: this.props.dashboardId,\n        title: json.result.dashboard_title,\n        slug: json.result.slug,\n        jsonMetadata: json.result.json_metadata,\n        ownerIds: json.result.owners });\n\n      this.props.onHide();\n    }, this.handleErrorResponse);\n  }\n\n  render() {\n    const { values, isDashboardLoaded, isAdvancedOpen } = this.state;\n    return (\n      ___EmotionJSX(Modal, { show: this.props.show, onHide: this.props.onHide, bsSize: \"lg\" },\n      ___EmotionJSX(\"form\", { onSubmit: this.save },\n      ___EmotionJSX(Modal.Header, { closeButton: true },\n      ___EmotionJSX(Modal.Title, null,\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(\"span\", { className: \"float-left\" }, t('Dashboard Properties'))))),\n\n\n\n      ___EmotionJSX(Modal.Body, null,\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 12 },\n      ___EmotionJSX(\"h3\", null, t('Basic Information')))),\n\n\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 6 },\n      ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"embed-height\" },\n      t('Title')),\n\n      ___EmotionJSX(FormControl, {\n        name: \"dashboard_title\",\n        type: \"text\",\n        bsSize: \"sm\",\n        value: values.dashboard_title,\n        onChange: this.onChange,\n        disabled: !isDashboardLoaded })),\n\n\n      ___EmotionJSX(Col, { md: 6 },\n      ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"embed-height\" },\n      t('URL Slug')),\n\n      ___EmotionJSX(FormControl, {\n        name: \"slug\",\n        type: \"text\",\n        bsSize: \"sm\",\n        value: values.slug || '',\n        onChange: this.onChange,\n        disabled: !isDashboardLoaded }),\n\n      ___EmotionJSX(\"p\", { className: \"help-block\" },\n      t('A readable URL for your dashboard')))),\n\n\n\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 6 },\n      ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Access')),\n      ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"owners\" },\n      t('Owners')),\n\n      ___EmotionJSX(AsyncSelect, {\n        name: \"owners\",\n        isMulti: true,\n        value: values.owners,\n        loadOptions: this.loadOwnerOptions,\n        defaultOptions: true // load options on render\n        , cacheOptions: true,\n        onChange: this.onOwnersChange,\n        disabled: !isDashboardLoaded,\n        filterOption: null // options are filtered at the api\n      }),\n      ___EmotionJSX(\"p\", { className: \"help-block\" },\n      t(\n      'Owners is a list of users who can alter the dashboard. Searchable by name or username.')))),\n\n\n\n\n      ___EmotionJSX(Row, null,\n      ___EmotionJSX(Col, { md: 12 },\n      ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } },\n      ___EmotionJSX(\"button\", {\n        type: \"button\",\n        className: \"text-button\",\n        onClick: this.toggleAdvanced },\n\n      ___EmotionJSX(\"i\", {\n        className: \"fa fa-angle-\" + (\n        isAdvancedOpen ? 'down' : 'right'),\n\n        style: { minWidth: '1em' } }),\n\n      t('Advanced'))),\n\n\n      isAdvancedOpen &&\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"label\", { className: \"control-label\", htmlFor: \"json_metadata\" },\n      t('JSON Metadata')),\n\n      ___EmotionJSX(AceEditor, {\n        mode: \"json\",\n        name: \"json_metadata\",\n        defaultValue: this.defaultMetadataValue,\n        value: values.json_metadata,\n        onChange: this.onMetadataChange,\n        theme: \"textmate\",\n        tabSize: 2,\n        width: \"100%\",\n        height: \"200px\" }),\n\n      ___EmotionJSX(\"p\", { className: \"help-block\" },\n      t(\n      'This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.')))))),\n\n\n\n\n\n\n\n      ___EmotionJSX(Modal.Footer, null,\n      ___EmotionJSX(\"span\", { className: \"float-right\" },\n      ___EmotionJSX(Button, {\n        type: \"submit\",\n        bsSize: \"sm\",\n        bsStyle: \"primary\",\n        className: \"m-r-5\",\n        disabled: this.state.errors.length > 0 },\n\n      t('Save')),\n\n      ___EmotionJSX(Button, { type: \"button\", bsSize: \"sm\", onClick: this.props.onHide },\n      t('Cancel')),\n\n      ___EmotionJSX(Dialog, {\n        ref: _ref => {\n          this.dialog = _ref;\n        } }))))));\n\n\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nPropertiesModal.propTypes = propTypes;\nPropertiesModal.defaultProps = defaultProps;const _default =\n\nwithToasts(PropertiesModal);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/PropertiesModal.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/PropertiesModal.jsx\");reactHotLoader.register(PropertiesModal, \"PropertiesModal\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/PropertiesModal.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/PropertiesModal.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}