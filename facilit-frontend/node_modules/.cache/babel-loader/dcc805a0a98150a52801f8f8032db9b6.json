{"ast":null,"code":"import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _setInterval from \"@babel/runtime-corejs3/core-js-stable/set-interval\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { SupersetClient } from '@superset-ui/connection';\n\nimport * as Actions from '../actions/sqlLab';\n\nconst QUERY_UPDATE_FREQ = 2000;\nconst QUERY_UPDATE_BUFFER_MS = 5000;\nconst MAX_QUERY_AGE_TO_POLL = 21600000;\nconst QUERY_TIMEOUT_LIMIT = 10000;\n\nclass QueryAutoRefresh extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      offline: props.offline };\n\n  }\n  UNSAFE_componentWillMount() {\n    this.startTimer();\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.offline !== this.state.offline) {\n      this.props.actions.setUserOffline(this.state.offline);\n    }\n  }\n  componentWillUnmount() {\n    this.stopTimer();\n  }\n  shouldCheckForQueries() {var _context2;\n    // if there are started or running queries, this method should return true\n    const { queries } = this.props;\n    const now = new Date().getTime();\n    const isQueryRunning = q => {var _context;return (\n        _indexOfInstanceProperty(_context = ['running', 'started', 'pending', 'fetching']).call(_context, q.state) >= 0);};\n\n    return _someInstanceProperty(_context2 = _Object$values(queries)).call(_context2,\n    q => isQueryRunning(q) && now - q.startDttm < MAX_QUERY_AGE_TO_POLL);\n\n  }\n  startTimer() {\n    if (!this.timer) {var _context3;\n      this.timer = _setInterval(_bindInstanceProperty(_context3 = this.stopwatch).call(_context3, this), QUERY_UPDATE_FREQ);\n    }\n  }\n  stopTimer() {\n    clearInterval(this.timer);\n    this.timer = null;\n  }\n  stopwatch() {\n    // only poll /superset/queries/ if there are started or running queries\n    if (this.shouldCheckForQueries()) {\n      SupersetClient.get({\n        endpoint: \"/superset/queries/\" + (\n        this.props.queriesLastUpdate - QUERY_UPDATE_BUFFER_MS),\n\n        timeout: QUERY_TIMEOUT_LIMIT }).\n\n      then(({ json }) => {\n        if (_Object$keys(json).length > 0) {\n          this.props.actions.refreshQueries(json);\n        }\n        this.setState({ offline: false });\n      }).\n      catch(() => {\n        this.setState({ offline: true });\n      });\n    } else {\n      this.setState({ offline: false });\n    }\n  }\n  render() {\n    return null;\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}QueryAutoRefresh.propTypes = {\n  offline: PropTypes.bool.isRequired,\n  queries: PropTypes.object.isRequired,\n  actions: PropTypes.object.isRequired,\n  queriesLastUpdate: PropTypes.number.isRequired };\n\n\nfunction mapStateToProps({ sqlLab }) {\n  return {\n    offline: sqlLab.offline,\n    queries: sqlLab.queries,\n    queriesLastUpdate: sqlLab.queriesLastUpdate };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(Actions, dispatch) };\n\n}const _default =\n\nconnect(mapStateToProps, mapDispatchToProps)(QueryAutoRefresh);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(QUERY_UPDATE_FREQ, \"QUERY_UPDATE_FREQ\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(QUERY_UPDATE_BUFFER_MS, \"QUERY_UPDATE_BUFFER_MS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(MAX_QUERY_AGE_TO_POLL, \"MAX_QUERY_AGE_TO_POLL\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(QUERY_TIMEOUT_LIMIT, \"QUERY_TIMEOUT_LIMIT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(QueryAutoRefresh, \"QueryAutoRefresh\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/QueryAutoRefresh.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}