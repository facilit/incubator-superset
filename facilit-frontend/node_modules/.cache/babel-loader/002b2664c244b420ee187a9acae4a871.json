{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { SupersetClient } from '@superset-ui/connection';\nimport { DropdownButton, MenuItem } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport CssEditor from './CssEditor';\nimport RefreshIntervalModal from './RefreshIntervalModal';\nimport SaveModal from './SaveModal';\nimport injectCustomCss from '../util/injectCustomCss';\nimport { SAVE_TYPE_NEWDASHBOARD } from '../util/constants';\nimport URLShortLinkModal from '../../components/URLShortLinkModal';\nimport downloadAsImage from '../util/downloadAsImage';\nimport getDashboardUrl from '../util/getDashboardUrl';\nimport { getActiveFilters } from '../util/activeDashboardFilters';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  hasUnsavedChanges: PropTypes.bool.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  onChange: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  forceRefreshAllCharts: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  startPeriodicRender: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  userCanEdit: PropTypes.bool.isRequired,\n  userCanSave: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  onSave: PropTypes.func.isRequired,\n  showPropertiesModal: PropTypes.func.isRequired,\n  refreshLimit: PropTypes.number,\n  refreshWarning: PropTypes.string };\n\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined,\n  refreshLimit: 0,\n  refreshWarning: null };\n\n\nclass HeaderActionsDropdown extends React.PureComponent {\n  static discardChanges() {\n    window.location.reload();\n  }\n\n  constructor(props) {var _context, _context2;\n    super(props);\n    this.state = {\n      css: props.customCss,\n      cssTemplates: [] };\n\n\n    this.changeCss = _bindInstanceProperty(_context = this.changeCss).call(_context, this);\n    this.changeRefreshInterval = _bindInstanceProperty(_context2 = this.changeRefreshInterval).call(_context2, this);\n  }\n\n  UNSAFE_componentWillMount() {\n    injectCustomCss(this.state.css);\n\n    SupersetClient.get({ endpoint: '/csstemplateasyncmodelview/api/read' }).\n    then(({ json }) => {var _context3;\n      const cssTemplates = _mapInstanceProperty(_context3 = json.result).call(_context3, row => ({\n        value: row.template_name,\n        css: row.css,\n        label: row.template_name }));\n\n      this.setState({ cssTemplates });\n    }).\n    catch(() => {\n      this.props.addDangerToast(\n      t('An error occurred while fetching available CSS templates'));\n\n    });\n  }\n\n  changeCss(css) {\n    this.setState({ css }, () => {\n      injectCustomCss(css);\n    });\n    this.props.onChange();\n    this.props.updateCss(css);\n  }\n\n  changeRefreshInterval(refreshInterval, isPersistent) {\n    this.props.setRefreshFrequency(refreshInterval, isPersistent);\n    this.props.startPeriodicRender(refreshInterval * 1000);\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      dashboardId,\n      dashboardInfo,\n      forceRefreshAllCharts,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      editMode,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      hasUnsavedChanges,\n      layout,\n      expandedSlices,\n      onSave,\n      userCanEdit,\n      userCanSave,\n      isLoading,\n      refreshLimit,\n      refreshWarning } =\n    this.props;\n\n    const emailTitle = t('Superset Dashboard');\n    const emailSubject = emailTitle + \" \" + dashboardTitle;\n    const emailBody = t('Check out this dashboard: ');\n\n    return (\n      ___EmotionJSX(DropdownButton, {\n        title: \"\",\n        id: \"save-dash-split-button\",\n        bsStyle: hasUnsavedChanges ? 'primary' : undefined,\n        bsSize: \"small\",\n        pullRight: true, __source: { fileName: _jsxFileName, lineNumber: 147 }, __self: this },\n\n      userCanSave &&\n      ___EmotionJSX(SaveModal, {\n        addSuccessToast: this.props.addSuccessToast,\n        addDangerToast: this.props.addDangerToast,\n        dashboardId: dashboardId,\n        dashboardTitle: dashboardTitle,\n        dashboardInfo: dashboardInfo,\n        saveType: SAVE_TYPE_NEWDASHBOARD,\n        layout: layout,\n        expandedSlices: expandedSlices,\n        refreshFrequency: refreshFrequency,\n        shouldPersistRefreshFrequency: shouldPersistRefreshFrequency,\n        customCss: customCss,\n        colorNamespace: colorNamespace,\n        colorScheme: colorScheme,\n        onSave: onSave,\n        isMenuItem: true,\n        triggerNode: ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 171 }, __self: this }, t('Save as')),\n        canOverwrite: userCanEdit, __source: { fileName: _jsxFileName, lineNumber: 155 }, __self: this }),\n\n\n\n      hasUnsavedChanges && userCanSave &&\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 177 }, __self: this },\n      ___EmotionJSX(MenuItem, {\n        eventKey: \"discard\",\n        onSelect: HeaderActionsDropdown.discardChanges, __source: { fileName: _jsxFileName, lineNumber: 178 }, __self: this },\n\n      t('Discard changes'))),\n\n\n\n\n      userCanSave && ___EmotionJSX(MenuItem, { divider: true, __source: { fileName: _jsxFileName, lineNumber: 187 }, __self: this }),\n\n      ___EmotionJSX(MenuItem, { onClick: forceRefreshAllCharts, disabled: isLoading, __source: { fileName: _jsxFileName, lineNumber: 189 }, __self: this },\n      t('Force refresh dashboard')),\n\n\n      ___EmotionJSX(RefreshIntervalModal, {\n        refreshFrequency: refreshFrequency,\n        refreshLimit: refreshLimit,\n        refreshWarning: refreshWarning,\n        onChange: this.changeRefreshInterval,\n        editMode: editMode,\n        triggerNode:\n        ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 200 }, __self: this },\n        editMode ?\n        t('Set auto-refresh interval') :\n        t('Auto-refresh dashboard')), __source: { fileName: _jsxFileName, lineNumber: 193 }, __self: this }),\n\n\n\n\n      editMode &&\n      ___EmotionJSX(MenuItem, { onClick: this.props.showPropertiesModal, __source: { fileName: _jsxFileName, lineNumber: 209 }, __self: this },\n      t('Edit dashboard properties')),\n\n\n\n      ___EmotionJSX(URLShortLinkModal, {\n        url: getDashboardUrl(\n        window.location.pathname,\n        getActiveFilters(),\n        window.location.hash),\n\n        emailSubject: emailSubject,\n        emailContent: emailBody,\n        addDangerToast: this.props.addDangerToast,\n        isMenuItem: true,\n        triggerNode: ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 224 }, __self: this }, t('Share dashboard')), __source: { fileName: _jsxFileName, lineNumber: 214 }, __self: this }),\n\n\n      editMode &&\n      ___EmotionJSX(CssEditor, {\n        triggerNode: ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 229 }, __self: this }, t('Edit CSS')),\n        initialCss: this.state.css,\n        templates: this.state.cssTemplates,\n        onChange: this.changeCss, __source: { fileName: _jsxFileName, lineNumber: 228 }, __self: this }),\n\n\n\n      !editMode &&\n      ___EmotionJSX(MenuItem, { onClick: downloadAsImage('.dashboard', dashboardTitle), __source: { fileName: _jsxFileName, lineNumber: 237 }, __self: this },\n      t('Download as image'))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nHeaderActionsDropdown.propTypes = propTypes;\nHeaderActionsDropdown.defaultProps = defaultProps;const _default =\n\nHeaderActionsDropdown;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");reactHotLoader.register(HeaderActionsDropdown, \"HeaderActionsDropdown\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/HeaderActionsDropdown.jsx"],"names":["React","PropTypes","SupersetClient","DropdownButton","MenuItem","t","CssEditor","RefreshIntervalModal","SaveModal","injectCustomCss","SAVE_TYPE_NEWDASHBOARD","URLShortLinkModal","downloadAsImage","getDashboardUrl","getActiveFilters","propTypes","addSuccessToast","func","isRequired","addDangerToast","dashboardInfo","object","dashboardId","number","dashboardTitle","string","hasUnsavedChanges","bool","customCss","colorNamespace","colorScheme","onChange","updateCss","forceRefreshAllCharts","refreshFrequency","shouldPersistRefreshFrequency","setRefreshFrequency","startPeriodicRender","editMode","userCanEdit","userCanSave","isLoading","layout","expandedSlices","onSave","showPropertiesModal","refreshLimit","refreshWarning","defaultProps","undefined","HeaderActionsDropdown","PureComponent","discardChanges","window","location","reload","constructor","props","state","css","cssTemplates","changeCss","changeRefreshInterval","UNSAFE_componentWillMount","get","endpoint","then","json","result","row","value","template_name","label","setState","catch","refreshInterval","isPersistent","render","emailTitle","emailSubject","emailBody","pathname","hash"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { SupersetClient } from '@superset-ui/connection';\nimport { DropdownButton, MenuItem } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport CssEditor from './CssEditor';\nimport RefreshIntervalModal from './RefreshIntervalModal';\nimport SaveModal from './SaveModal';\nimport injectCustomCss from '../util/injectCustomCss';\nimport { SAVE_TYPE_NEWDASHBOARD } from '../util/constants';\nimport URLShortLinkModal from '../../components/URLShortLinkModal';\nimport downloadAsImage from '../util/downloadAsImage';\nimport getDashboardUrl from '../util/getDashboardUrl';\nimport { getActiveFilters } from '../util/activeDashboardFilters';\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  hasUnsavedChanges: PropTypes.bool.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  onChange: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  forceRefreshAllCharts: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  startPeriodicRender: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  userCanEdit: PropTypes.bool.isRequired,\n  userCanSave: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  onSave: PropTypes.func.isRequired,\n  showPropertiesModal: PropTypes.func.isRequired,\n  refreshLimit: PropTypes.number,\n  refreshWarning: PropTypes.string,\n};\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined,\n  refreshLimit: 0,\n  refreshWarning: null,\n};\n\nclass HeaderActionsDropdown extends React.PureComponent {\n  static discardChanges() {\n    window.location.reload();\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      css: props.customCss,\n      cssTemplates: [],\n    };\n\n    this.changeCss = this.changeCss.bind(this);\n    this.changeRefreshInterval = this.changeRefreshInterval.bind(this);\n  }\n\n  UNSAFE_componentWillMount() {\n    injectCustomCss(this.state.css);\n\n    SupersetClient.get({ endpoint: '/csstemplateasyncmodelview/api/read' })\n      .then(({ json }) => {\n        const cssTemplates = json.result.map(row => ({\n          value: row.template_name,\n          css: row.css,\n          label: row.template_name,\n        }));\n        this.setState({ cssTemplates });\n      })\n      .catch(() => {\n        this.props.addDangerToast(\n          t('An error occurred while fetching available CSS templates'),\n        );\n      });\n  }\n\n  changeCss(css) {\n    this.setState({ css }, () => {\n      injectCustomCss(css);\n    });\n    this.props.onChange();\n    this.props.updateCss(css);\n  }\n\n  changeRefreshInterval(refreshInterval, isPersistent) {\n    this.props.setRefreshFrequency(refreshInterval, isPersistent);\n    this.props.startPeriodicRender(refreshInterval * 1000);\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      dashboardId,\n      dashboardInfo,\n      forceRefreshAllCharts,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      editMode,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      hasUnsavedChanges,\n      layout,\n      expandedSlices,\n      onSave,\n      userCanEdit,\n      userCanSave,\n      isLoading,\n      refreshLimit,\n      refreshWarning,\n    } = this.props;\n\n    const emailTitle = t('Superset Dashboard');\n    const emailSubject = `${emailTitle} ${dashboardTitle}`;\n    const emailBody = t('Check out this dashboard: ');\n\n    return (\n      <DropdownButton\n        title=\"\"\n        id=\"save-dash-split-button\"\n        bsStyle={hasUnsavedChanges ? 'primary' : undefined}\n        bsSize=\"small\"\n        pullRight\n      >\n        {userCanSave && (\n          <SaveModal\n            addSuccessToast={this.props.addSuccessToast}\n            addDangerToast={this.props.addDangerToast}\n            dashboardId={dashboardId}\n            dashboardTitle={dashboardTitle}\n            dashboardInfo={dashboardInfo}\n            saveType={SAVE_TYPE_NEWDASHBOARD}\n            layout={layout}\n            expandedSlices={expandedSlices}\n            refreshFrequency={refreshFrequency}\n            shouldPersistRefreshFrequency={shouldPersistRefreshFrequency}\n            customCss={customCss}\n            colorNamespace={colorNamespace}\n            colorScheme={colorScheme}\n            onSave={onSave}\n            isMenuItem\n            triggerNode={<span>{t('Save as')}</span>}\n            canOverwrite={userCanEdit}\n          />\n        )}\n\n        {hasUnsavedChanges && userCanSave && (\n          <div>\n            <MenuItem\n              eventKey=\"discard\"\n              onSelect={HeaderActionsDropdown.discardChanges}\n            >\n              {t('Discard changes')}\n            </MenuItem>\n          </div>\n        )}\n\n        {userCanSave && <MenuItem divider />}\n\n        <MenuItem onClick={forceRefreshAllCharts} disabled={isLoading}>\n          {t('Force refresh dashboard')}\n        </MenuItem>\n\n        <RefreshIntervalModal\n          refreshFrequency={refreshFrequency}\n          refreshLimit={refreshLimit}\n          refreshWarning={refreshWarning}\n          onChange={this.changeRefreshInterval}\n          editMode={editMode}\n          triggerNode={\n            <span>\n              {editMode\n                ? t('Set auto-refresh interval')\n                : t('Auto-refresh dashboard')}\n            </span>\n          }\n        />\n\n        {editMode && (\n          <MenuItem onClick={this.props.showPropertiesModal}>\n            {t('Edit dashboard properties')}\n          </MenuItem>\n        )}\n\n        <URLShortLinkModal\n          url={getDashboardUrl(\n            window.location.pathname,\n            getActiveFilters(),\n            window.location.hash,\n          )}\n          emailSubject={emailSubject}\n          emailContent={emailBody}\n          addDangerToast={this.props.addDangerToast}\n          isMenuItem\n          triggerNode={<span>{t('Share dashboard')}</span>}\n        />\n\n        {editMode && (\n          <CssEditor\n            triggerNode={<span>{t('Edit CSS')}</span>}\n            initialCss={this.state.css}\n            templates={this.state.cssTemplates}\n            onChange={this.changeCss}\n          />\n        )}\n\n        {!editMode && (\n          <MenuItem onClick={downloadAsImage('.dashboard', dashboardTitle)}>\n            {t('Download as image')}\n          </MenuItem>\n        )}\n      </DropdownButton>\n    );\n  }\n}\n\nHeaderActionsDropdown.propTypes = propTypes;\nHeaderActionsDropdown.defaultProps = defaultProps;\n\nexport default HeaderActionsDropdown;\n"]},"metadata":{},"sourceType":"module"}